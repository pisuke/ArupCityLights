Echelon.DateObject=function(b,c,a){switch(arguments.length){case 0:this.m_date=new Date();break;case 1:this.m_date=new Date(b);break;case 3:this.m_date=new Date(b,c,a);break;default:throw new Error("Invalid constructor call of DateObject by:\n\n"+arguments.caller)}this.m_ilonTimezoneOffset=-this.m_date.getTimezoneOffset()};Echelon.DateObject.getInstance=function(b,c,a){switch(arguments.length){case 0:return new Echelon.DateObject();break;case 1:return new Echelon.DateObject(b);break;case 3:return new Echelon.DateObject(b,c,a);break;default:throw new Error("Invalid constructor call of DateObject by:\n\n"+arguments.caller)}};Echelon.TimeObject=function(a,c,d,b){switch(arguments.length){case 0:this.m_date=new Date();break;case 1:this.m_date=new Date(a);break;case 3:this.m_date=new Date(0,0,0,a,c,d);break;case 4:this.m_date=new Date(0,0,0,a,c,d,b);break;default:throw new Error("Invalid constructor call of TimeObject by:\n\n"+arguments.caller)}this.m_ilonTimezoneOffset=0};Echelon.TimeObject.getInstance=function(a,c,d,b){switch(arguments.length){case 0:return new Echelon.TimeObject();break;case 1:return new Echelon.TimeObject(a);break;case 3:return new Echelon.TimeObject(a,c,d);break;case 4:return new Echelon.TimeObject(a,c,d,b);break;default:throw new Error("Invalid constructor call of TimeObject by:\n\n"+arguments.caller)}this.m_ilonTimezoneOffset=0};Echelon.DateTimeObject=function(g,f,b,a,d,e,c){switch(arguments.length){case 0:this.m_date=new Date();break;case 1:this.m_date=new Date(g);break;case 3:this.m_date=new Date(g,f,b);break;case 6:this.m_date=new Date(g,f,b,a,d,e);break;case 7:this.m_date=new Date(g,f,b,a,d,e,c);break;default:throw new Error("Invalid constructor call of DateTimeObject by:\n\n"+arguments.caller)}this.m_ilonTimezoneOffset=0};Echelon.DateTimeObject.getInstance=function(g,f,b,a,d,e,c){switch(arguments.length){case 0:return new Echelon.DateTimeObject();break;case 1:return new Echelon.DateTimeObject(g);break;case 3:return new Echelon.DateTimeObject(g,f,b);break;case 6:return new Echelon.DateTimeObject(g,f,b,a,d,e);break;case 7:return new Echelon.DateTimeObject(g,f,b,a,d,e,c);break;default:throw new Error("Invalid constructor call of DateTimeObject by:\n\n"+arguments.caller)}};Echelon.DateTimeObjectMethods={getWrapper:function(b){var a=(b=="Year")?"FullYear":b;this.get=function(){this.m_chkOffset(arguments);return new Date(this.getTime()+this.m_ilonTimezoneOffset*60000)["getUTC"+a]()}},getTime:function(){this.m_chkOffset(arguments);return this.m_data.getTime()+this.m_ilonTimezoneOffset*60000},genericWrapper:function(b){var a=b;this.func=function(){switch(arguments.length){case 0:return this.m_date[a]();case 1:return this.m_date[a](arguments[0]);case 2:return this.m_date[a](arguments[0],arguments[1]);case 3:return this.m_date[a](arguments[0],arguments[1],arguments[2]);case 4:return this.m_date[a](arguments[0],arguments[1],arguments[2],arguments[3])}}},setDateWrapper:function(d){var b=d;var a;var c=function(e,f){a=e-f["get"+b]();if((a>26)&&(a<31)){a=-1}if((a<-26)&&(a>-31)){a=1}if((a>6)||(a<-6)){throw new Error("Echelon.Date object does not support setting Dates/Months out of valid range, use addDay/addMonth methods.")}if(a){a=(((a==-1)||(a>1))?-1:1)}return a!=0};this.set=function(e){this.m_date["set"+b](e);while(c(e,this)){this.addDays(a)}return this.getTime()}},iniClass:function(f,b,a){var e={getUTC:1,set:1,setUTC:1};for(var d in b){if((d!="Milliseconds")&&(d!="Seconds")){f.prototype["get"+d]=new Echelon.DateTimeObjectMethods.getWrapper(d).get}else{f.prototype["get"+d]=new Echelon.DateTimeObjectMethods.genericWrapper("get"+d).func}for(var c in e){f.prototype[c+d]=new Echelon.DateTimeObjectMethods.genericWrapper(c+d).func}if((d!="FullYear")&&(a=="Date")){f.prototype["set"+d]=new Echelon.DateTimeObjectMethods.setDateWrapper(d).set}}for(var d in Echelon.DateTimeObjectMethods.common){f.prototype[d]=Echelon.DateTimeObjectMethods.common[d]}for(var d in Echelon.DateTimeObjectMethods[a]){f.prototype[d]=Echelon.DateTimeObjectMethods[a][d]}f.prototype.getTime=new Echelon.DateTimeObjectMethods.genericWrapper("getTime").func;f.prototype.setTime=new Echelon.DateTimeObjectMethods.genericWrapper("setTime").func;f.prototype.m_constructor=f},classParseIso:function(a){var b=a;this.parse=function(c){return new b().parseIso(c).getTime()}},init:function(){Echelon.DateTimeObjectMethods.iniClass(Echelon.DateObject,{Date:1,Day:1,FullYear:1,Month:1,Year:1},"Date");Echelon.DateTimeObjectMethods.iniClass(Echelon.TimeObject,{Hours:1,Milliseconds:1,Minutes:1,Seconds:1},"Time");elon.copyPrototype(Echelon.DateTimeObject,Echelon.DateObject);elon.copyPrototype(Echelon.DateTimeObject,Echelon.TimeObject);Echelon.DateTimeObject.prototype.m_constructor=Echelon.DateTimeObject;for(var a in Echelon.DateTimeObjectMethods.DateTime){Echelon.DateTimeObject.prototype[a]=Echelon.DateTimeObjectMethods.DateTime[a]}Echelon.DateObject.parseIso=new Echelon.DateTimeObjectMethods.classParseIso(Echelon.DateObject).parse;Echelon.TimeObject.parseIso=new Echelon.DateTimeObjectMethods.classParseIso(Echelon.TimeObject).parse;Echelon.DateTimeObject.parseIso=new Echelon.DateTimeObjectMethods.classParseIso(Echelon.DateTimeObject).parse;Echelon.DateObject.isoFormat="%f-%2M-%2d";Echelon.DateObject.isoUtcFormat="%uf-%u2M-%u2d";Echelon.TimeObject.isoFormat="%2h:%2m:%2s";Echelon.TimeObject.isoUtcFormat="%u2h:%u2m:%2sZ";Echelon.TimeObject.isoMsFormat="%2h:%2m:%2s.%3S%+%o2h:%o2m";Echelon.TimeObject.isoUtcMsFormat="%u2h:%u2m:%2s.%3SZ";Echelon.DateTimeObject.isoFormat=Echelon.DateObject.isoFormat+"T"+Echelon.TimeObject.isoMsFormat;Echelon.DateTimeObject.isoUtcFormat=Echelon.DateObject.isoUtcFormat+"T"+Echelon.TimeObject.isoUtcMsFormat;Echelon.DateTimeObject.isoMsFormat=Echelon.DateObject.isoFormat+"T"+Echelon.TimeObject.isoMsFormat;Echelon.DateTimeObject.isoUtcMsFormat=Echelon.DateObject.isoUtcFormat+"T"+Echelon.TimeObject.isoUtcMsFormat;Echelon.DateObject.ONE_WEEK=604800000;Echelon.DateObject.ONE_DAY=86400000;Echelon.DateObject.ONE_HOUR=3600000;Echelon.DateObject.ONE_MIN=60000;Echelon.DateObject.ONE_SEC=1000;Echelon.TimeObject.ONE_WEEK=604800000;Echelon.TimeObject.ONE_DAY=86400000;Echelon.TimeObject.ONE_HOUR=3600000;Echelon.TimeObject.ONE_MIN=60000;Echelon.TimeObject.ONE_SEC=1000},common:{m_chkOffset:function(a){if(this.m_ilonTimezoneOffset==null){throw new Error('Unable to process method "'+a.callee+'" because the iLon timezone offset is not initialized. This happens when a Soap-Message from the iLon uses UTC and does not mention the iLon timezone offset. To fix this you should ask the embedded guys to send the iLon timezone offset along. The caller method that caused this exception was:\n\n'+a.caller)}},m_addMs:function(a){this.m_date.setTime(this.m_date.getTime()+a);return this},clone:function(){return new this.m_constructor().copy(this)},copy:function(a){if(a==null){throw new Error("Invalid argument NaN in ExtendedDateObject.copy. Caller is:\n\n"+arguments.caller)}if(this.setTimezoneOffset){this.setTimezoneOffset(a.getTimezoneOffset())}this.setTime(a.getTime());return this},toFormattedString:function(g){var e={d:"Date",D:"Day",f:"FullYear",h:"Hours",m:"Minutes",M:"Month",s:"Seconds",S:"Milliseconds",y:"Year"};if(g==null){g=this.m_constructor.isoFormat}var h=g.match(new RegExp("(^|[^\\\\])%[uo]?\\d*[dDfhmMsSy]","g"));var b=new String(g);while(b.match(/(^|[^\\])%\+/)!=null){b=b.replace(/(^|[^\\])%\+/,RegExp.$1+((this.m_ilonTimezoneOffset>=0)?"+":""))}for(var c=0;c<h.length;c++){var d=h[c].match(new RegExp("%(u|o)?(\\d+)?([dDfhmMsSy])"));if(d[1]=="o"){var a=this.m_ilonTimezoneOffset;switch(d[3]){case"h":a/=60;break;case"m":a%=60;break;case"M":break;case"s":a*=60;break;case"S":a*=60000;break;default:continue}}else{var a=this["get"+(d[1]?"UTC":"")+e[d[3]]]();if(d[3]=="M"){a++}}if(d[2]){a=elon.UtilObject.getInstance().addLeadingZeros(a,d[2],10)}b=b.replace(d[0],a)}return b}},Date:{parseIso:function(c,b){var a=c.replace(/-/g,"");if((a.length!=8)||(a.search(/[^\d]/)!=-1)){throw new Error('Unsupported date format "'+c+'" in DateObject.parse. Only ISO dates aresupported without the week notation. Caller is:\n\n'+arguments.caller)}if(!b){this.m_ilonTimezoneOffset=-this.m_date.getTimezoneOffset()}this.setYear(parseInt(a.slice(0,4),10));this.setDate(2);this.setMonth(parseInt(a.slice(4,6),10)-1);this.setDate(parseInt(a.slice(6),10));return this},addDays:function(a){return this.m_addMs(a*Echelon.DateObject.ONE_DAY)},addWeeks:function(a){return this.m_addMs(a*Echelon.DateObject.ONE_WEEK)},addMonths:function(a){this.m_date.setUTCMonth(this.m_date.getUTCMonth()+parseInt(a,10));return this},addYear:function(a){this.m_date.setUTCFullYear(this.m_date.getUTCFullYear()+a);return this}},Time:{addMilliseconds:function(a){return this.m_addMs(a)},addSeconds:function(a){return this.m_addMs(a*Echelon.TimeObject.ONE_SEC)},addMinutes:function(a){return this.m_addMs(a*Echelon.TimeObject.ONE_MIN)},addHours:function(a){return this.m_addMs(a*Echelon.TimeObject.ONE_HOUR)},setHours:function(a){this.m_chkOffset(arguments);return this.m_date.setUTCHours(a-this.m_ilonTimezoneOffset/60)},setMinutes:function(a){this.m_chkOffset(arguments);return this.m_date.setUTCMinutes(a-this.m_ilonTimezoneOffset%60)},getTimezoneOffset:function(){return this.m_ilonTimezoneOffset},setTimezoneOffset:function(a){if((a==null)||isNaN(a)){throw new Error("Invalid argument NaN in ExtendedDateObject.setTimezoneOffset. Caller is:\n\n"+arguments.caller)}this.m_ilonTimezoneOffset=a},parseIso:function(c){var a=c.match(/^(\d\d)\:?(\d\d)?\:?(\d\d)?\.?(\d+)?([\+\-])?(\d\d)?\:?(\d\d)?([Z])?$/);if(a==null){throw new Error('Unsupported time format "'+c+'" in TimeObject.parse. Only ISO time aresupported. Caller is:\n\n'+arguments.caller)}this.setUTCHours(a[1]);if(a[2]){this.setUTCMinutes(a[2])}else{this.setUTCMinutes(0)}if(a[3]){this.setUTCSeconds(a[3])}else{this.setUTCSeconds(0)}if(a[4]){this.setUTCMilliseconds(a[4].slice(0,3))}else{this.setUTCMilliseconds(0)}this.m_ilonTimezoneOffset=0;if(a[5]){var b=(a[5]=="+")?1:-1}if(a[6]){this.m_ilonTimezoneOffset=b*60*a[6]}if(a[7]){this.m_ilonTimezoneOffset+=b*a[7]}if(a[8]){this.m_ilonTimezoneOffset+=null}if((this.m_ilonTimezoneOffset)&&(this.m_ilonTimezoneOffset!=0)){this.setTime(this.getTime()-this.m_ilonTimezoneOffset*60000)}return this}},DateTime:{parseIso:function(b){var a=b.split("T");Echelon.DateTimeObjectMethods.Date.parseIso.call(this,a[0],true);if(a.length>1){Echelon.DateTimeObjectMethods.Time.parseIso.call(this,a[1])}return this},toLocaleString:function(){return new Date(this.m_date.getTime()-60000*this.m_date.getTimezoneOffset+60000*this.m_ilonTimezoneOffset).toLocaleString()},toUTCString:function(){return this.m_date.toUTCString()}}};Echelon.DateTimeObjectMethods.init();Echelon.SoapDenCoders={localName:elon.browser.IE?"baseName":"localName",parseXmlSimple:function(c,d,b,e,a){d[b]=new a.create(e,((c.nodeValue||c.textContent)!=null)?(c.nodeValue||c.textContent):(((c.childNodes.length==1)&&(c.firstChild.nodeName=="#text"))?c.firstChild.nodeValue:""));return c.nextSibling},parseXmlExtended:function(c,e,b,f,a){e[b]=new a.create(f,((c.nodeValue||c.textContent)!=null)?(c.nodeValue||c.textContent):(((c.childNodes.length==1)&&(c.firstChild.nodeName=="#text"))?c.firstChild.nodeValue:""));for(var d in e[b].m_proxy_options.attributes){e[b][d]=new e[b].m_proxy_options.attributes[d].create(f,c.getAttribute(d))}return c.nextSibling},parseXmlArray:function(e,h,a,j,f,i,b,d,c){var g=h[a]=new f.init(j);while(true){e=f.elementParser(e,g,g.length,j,f,i,b,d,c);g.length++;while((e!=null)&&(e.nodeType!=1)){e=e.nextSibling}if((e==null)||(e[Echelon.SoapDenCoders.localName]!=a)){return e}}},parseXmlComplex:function(k,m,a,o,g,n,b,d,c){var l=k.getAttribute("xsi:type");if(l){l=l.replace(/^.*:/,"")}var j=m[a]=(g.Item&&n)?Echelon.SoapFactoryObject.instance.decode(k,b,l,g,d,c):(l?new (Echelon.SoapFactoryObject.instance.getConstructor(l))(o):new g.create(o));if(b){j.r_proxy_url=b}if(j.m_proxy_dont_parse){delete j.m_proxy_dont_parse;return k.nextSibling}o=j.m_proxy_isItem?j:o;if(j.m_proxy_isItem){j.m_proxy_xml=k}for(var h in j.m_proxy_options.attributes){j[h]=new j.m_proxy_options.attributes[h].create(o,k.getAttribute(h))}var f=k.firstChild;for(var h in j.m_proxy_options.content){while((f!=null)&&(f.nodeType!=1)){f=f.nextSibling}var e=j.m_proxy_options.content[h];if(f==null){if(e.init){j[h]=new e.init(o,null)}continue}if(f[Echelon.SoapDenCoders.localName]==h){f=e.parser(f,j,h,o,e,n,b,d,c)}else{if(e.init){j[h]=new e.init(o,null)}else{delete j[h]}}}return k.nextSibling},nsName:function(b,a){return(!b||!b.ns||(b.ns=="ilon"))?a:(b.ns+":"+a)},enAttributes:function(b,d){var a=[];if(d&&(this.r_proxy_type!="anonymous")&&(this.r_proxy_type!=d)&&(this.type!=d)){a.push('xsi:type="'+((this.m_proxy_ns!="ilon")?(this.m_proxy_ns+":"):"")+this.r_proxy_type+'"')}for(var c in this.m_proxy_options.attributes){var e=c;if(this[c].m_value!=null){a.push(this[c].m_proxy_encodeAtt(e))}else{if(this.m_proxy_options.attributes[c].required){this.m_proxy_error('Tried to send soap with missing required attribute "'+c+'" in tag "'+b+'"(Echelon.SoapDenCoders.enComplex)')}}}return["<"+b+((a.length!=0)?" ":"")+a.join(" ")+">"]},enComplex:function(b,d){var a=Echelon.SoapDenCoders.enAttributes.call(this,b,d);for(var c in this.m_proxy_options.content){var e=Echelon.SoapDenCoders.nsName(this.m_proxy_options.content[c],c);if(this[c].m_value!=null){a.push(this[c].m_proxy_encode(e,this.m_proxy_options.content[c].type))}else{if(!this[c].fromStr&&this[c].m_proxy_encode){a.push(this[c].m_proxy_encode(e,this.m_proxy_options.content[c].type))}else{if(this.m_proxy_options.content[c].required){this.m_proxy_error('Tried to send soap with missing required element "'+c+'" (Echelon.SoapDenCoders.enProp)')}}}}return a.join("")+"</"+b+">"},enExtended:function(a,b,c){return(this.m_value!=null)?(Echelon.SoapDenCoders.enAttributes.call(this,a,b).join("")+((this.r_proxy_type=="string")?Echelon.SoapDenCoders.enStr(this.m_value):this.m_value)+"</"+a+">"):""},deBoolean:function(b,a){switch(b.toLowerCase()){case"":case"false":case"0":case"null":case"nil":return false;case"1":case"true":return true}this.m_proxy_error('Invalid value "'+b+'" in deBoolean',a)},deFloat:function(c,a){var b=parseFloat(c);if(isNaN(b)){this.m_proxy_error("Error while converting number from string in deFloat",a)}return b},deInt:function(c,a){var b=parseInt(c,10);if(isNaN(b)){this.m_proxy_error("Error while converting number from string in deInt",a)}return b},enTag:function(a,b){return"<"+a+">"+b+"</"+a+">"},enStr:function(a){return a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\r/g,"&#13;").replace(/\n/g,"&#10;")},enBuiltInAtt:function(a){return a+'="'+Echelon.SoapDenCoders.enStr(this.m_value.toString())+'"'},enBuiltInTag:function(a){return Echelon.SoapDenCoders.enTag(a,Echelon.SoapDenCoders.enStr(this.m_value.toString()))},enDT:function(a){return Echelon.SoapDenCoders.enTag(a,((typeof(this.m_value)=="string")?this.m_value:this.m_value.toFormattedString()))}};Echelon.SoapBuiltInTypes={classMethods:{"boolean":{fromStr:Echelon.SoapDenCoders.deBoolean,type:"boolean",r_proxy_type:"boolean"},"float":{fromStr:Echelon.SoapDenCoders.deFloat,type:"float",r_proxy_type:"number"},"int":{fromStr:Echelon.SoapDenCoders.deInt,type:"int",r_proxy_type:"number"},unsignedInt:{fromStr:Echelon.SoapDenCoders.deInt,type:"unsignedInt",r_proxy_type:"number"},string:{fromStr:function(a){return a},type:"string",r_proxy_type:"string"}},initialize:function(){var c=function(){};for(var b in Echelon.SoapBuiltInTypes){if((b!="initialize")&&(b!="classMethods")){c.prototype[b]=Echelon.SoapBuiltInTypes[b]}}for(var b in Echelon.SoapBuiltInTypes.classMethods){Echelon.SoapBuiltInTypes[b]=function(d,e){this.m_value=e;this.m_proxy_item=d},elon.copyPrototype(Echelon.SoapBuiltInTypes[b],c,"base");for(var a in Echelon.SoapBuiltInTypes.classMethods[b]){Echelon.SoapBuiltInTypes[b].prototype[a]=Echelon.SoapBuiltInTypes.classMethods[b][a]}}Echelon.SoapBuiltInTypes.UCPTname=function(d,e){this.m_value=e;this.m_proxy_item=d},elon.copyPrototype(Echelon.SoapBuiltInTypes.UCPTname,Echelon.SoapBuiltInTypes.string,"string");Echelon.SoapBuiltInTypes.UCPTname.prototype.m_readOnly=true;Echelon.SoapBuiltInTypes.anyURI=Echelon.SoapBuiltInTypes.string;Echelon.SoapBuiltInTypes.any=Echelon.SoapBuiltInTypes.string;Echelon.SoapBuiltInTypes["double"]=Echelon.SoapBuiltInTypes["float"];Echelon.SoapBuiltInTypes.hexBinary=Echelon.SoapBuiltInTypes.string;Echelon.SoapBuiltInTypes["long"]=Echelon.SoapBuiltInTypes["int"];Echelon.SoapBuiltInTypes["short"]=Echelon.SoapBuiltInTypes["int"];Echelon.SoapBuiltInTypes.unsignedShort=Echelon.SoapBuiltInTypes["int"]},m_proxy_encode:Echelon.SoapDenCoders.enBuiltInTag,m_proxy_encodeAtt:Echelon.SoapDenCoders.enBuiltInAtt,m_proxy_error:function(b,a){throw new Error(b+'\n\nThis error occured in SoapBuiltInType of type "'+this.r_proxy_type+'" in Item "'+this.m_proxy_item.UCPTname.get()+'" of type "'+this.m_proxy_item.r_proxy_type+'"'+(a?("\n\nThe operation causing the error was called by method:\n\n"+a):""))},m_proxy_convertFromSimple:function(a,b){this.set(a,b)},m_proxy_convertToSimple:function(){return this.m_value},m_proxy_equals:function(a){return a.m_value==this.m_value},y_proxy_copy:function(a,c,b){if(b&&(this.m_value!=null)){return}if(this.m_readOnly){return}if(a.type==this.type){if(this.m_value!=a.m_value){this.m_value=a.m_value;if(this.m_proxy_item){this.m_proxy_item.m_proxy_notify(null,null,c)}}}else{if(this.m_value!=a.get()){this.set(a.get(),c);if(this.m_proxy_item){this.m_proxy_item.m_proxy_notify(null,null,c)}}}},get:function(){if(this.m_value==null){return null}if(typeof(this.m_value)!=this.r_proxy_type){this.m_value=this.fromStr(this.m_value,arguments.caller)}return this.m_value},set:function(a,c){if(a==null){if(this.m_value!=null){this.m_proxy_chkReadOnly();if(this.m_proxy_item){this.m_proxy_item.m_proxy_notify(null,null,c)}}this.m_value=null;return this}if(isNaN(a)||(typeof(a)!=this.r_proxy_type)){try{if(this.r_proxy_type=="string"){a=a.toString()}else{if(typeof(a)!="string"){throw new Error()}a=this.fromStr(a,arguments.caller)}}catch(b){throw new Error('Typemismatch in Echelon.SoapBuiltInTypes.base.set. Expected type "'+this.r_proxy_type+'" got "'+(isNaN(a)?"NaN":typeof(a))+'". Called by function:\n'+arguments.caller)}}if(this.m_restriction!=null){this.m_restriction(a,arguments.caller)}if(this.m_value!=a){this.m_proxy_chkReadOnly();this.m_value=a;if(this.m_proxy_item){this.m_proxy_item.m_proxy_notify(null,null,c)}}return this},m_proxy_chkReadOnly:function(){if(this.m_readOnly){throw new Error("The following function attempted to write readOnly value in Echelon.SoapBuiltInTypes.base.set:\n"+arguments.caller)}}};Echelon.SoapBuiltInTypes.initialize();Echelon.SoapDateTimeTypes={m_dtIni:function(a,b){if(typeof(this.m_value)=="string"){this.m_value=new this.m_constructor().parseIso(this.m_value)}else{if(this.m_value==null){this.m_value=new this.m_constructor()}}return this.m_value},y_proxy_copy:function(a,c,b){if(b&&(this.m_value!=null)){return}if(this.m_readOnly||(this.m_value==a.m_value)||(this.m_value&&a.m_value&&this.m_value.m_date&&a.m_value.m_date&&(this.m_value.m_date.getTime()==a.m_value.m_date.getTime()))){return}else{this.copy(a,c)}},m_proxy_equals:function(a){return a.getTime&&(this.getTime()==a.getTime())},clear:function(a){this.m_value=null;if(this.m_proxy_item){this.m_proxy_item.m_proxy_notify(null,null,a)}},get:function(b){var a=b;this.func=function(c){return this.m_dtIni(arguments,"get")[a](c)}},set:function(b){var a=b;this.func=function(c,d){if(this.m_proxy_item){this.m_proxy_item.m_proxy_notify(null,null,d)}return this.m_dtIni(arguments,"set")[a](c)}},overwrite:function(b){var a=b;this.func=function(c,d){this.m_value=new this.m_constructor();if(this.m_proxy_item){this.m_proxy_item.m_proxy_notify(null,null,d)}return this.m_value[a](c)}},m_proxy_convertFromSimple:function(a,b){this.m_value=a;if(this.m_proxy_item){this.m_proxy_item.m_proxy_notify(null,null,b)}},fromStr:function(a){this.parseIso(a)},isInitialized:function(){return this.m_value!=null},iniClass:function(c,a){Echelon.SoapBuiltInTypes[a]=function(d,e){this.m_value=e;this.m_proxy_item=d};for(var b in c.prototype){if(b.indexOf("m_")==0){continue}if(b.indexOf("set")==0){Echelon.SoapBuiltInTypes[a].prototype[b]=new Echelon.SoapDateTimeTypes.set(b).func}else{if(b=="copy"){Echelon.SoapBuiltInTypes[a].prototype[b]=new Echelon.SoapDateTimeTypes.overwrite(b).func}else{if(b=="parseIso"){Echelon.SoapBuiltInTypes[a].prototype[b]=new Echelon.SoapDateTimeTypes.overwrite(b).func}else{Echelon.SoapBuiltInTypes[a].prototype[b]=new Echelon.SoapDateTimeTypes.get(b).func}}}}Echelon.SoapBuiltInTypes[a].prototype.type=a;Echelon.SoapBuiltInTypes[a].prototype.fromStr=Echelon.SoapDateTimeTypes.fromStr;Echelon.SoapBuiltInTypes[a].prototype.y_proxy_copy=Echelon.SoapDateTimeTypes.y_proxy_copy;Echelon.SoapBuiltInTypes[a].prototype.m_proxy_equals=Echelon.SoapDateTimeTypes.m_proxy_equals;Echelon.SoapBuiltInTypes[a].prototype.r_proxy_type="object";Echelon.SoapBuiltInTypes[a].prototype.m_dtIni=Echelon.SoapDateTimeTypes.m_dtIni;Echelon.SoapBuiltInTypes[a].prototype.clear=Echelon.SoapDateTimeTypes.clear;Echelon.SoapBuiltInTypes[a].prototype.isInitialized=Echelon.SoapDateTimeTypes.isInitialized;Echelon.SoapBuiltInTypes[a].prototype.m_constructor=c;Echelon.SoapBuiltInTypes[a].prototype.m_proxy_error=Echelon.SoapBuiltInTypes.m_proxy_error;Echelon.SoapBuiltInTypes[a].prototype.m_proxy_encode=Echelon.SoapDenCoders.enDT;Echelon.SoapBuiltInTypes[a].prototype.m_proxy_convertFromSimple=Echelon.SoapDateTimeTypes.m_proxy_convertFromSimple;Echelon.SoapBuiltInTypes[a].prototype.m_proxy_convertToSimple=Echelon.SoapBuiltInTypes[a].prototype.toIsoString},init:function(){Echelon.SoapDateTimeTypes.iniClass(Echelon.DateObject,"date");Echelon.SoapDateTimeTypes.iniClass(Echelon.TimeObject,"time");Echelon.SoapDateTimeTypes.iniClass(Echelon.DateTimeObject,"dateTime")}};Echelon.SoapDateTimeTypes.init();Echelon.SoapArrayObject={m_proxy_error:function(b,a){throw new Error(b+'\n\nThis error occured in Echelon.SoapArrayObject of type "'+this.r_proxy_type+'" named "'+this.m_name+'" in Item "'+this.m_proxy_item.UCPTname.get()+'" of type "'+this.m_proxy_item.r_proxy_type+'"'+(a?("\n\nThe operation causing the error was called by method:\n\n"+a):""))},m_proxy_encode:function(c,a){var b=new Array(this.length);for(var d=0;d<this.length;d++){var e=((!c.match(/:/)&&this[d].m_proxy_ns&&(this[d].m_proxy_ns!="ilon")&&(c!="Item"))?(this[d].m_proxy_ns+":"):"")+c;b[d]=this[d].m_proxy_encode(e,this.r_proxy_type)}return b.join("")},encodeRequired:function(b,a){if((this.length<this.m_min)||(this.length>this.m_max)){this.m_proxy_error("Tried to send SoaoArrayObject with wrong number of elements. Array has "+this.length+" elements and should have between "+this.m_min+" and "+this.m_max+"elements.")}return Echelon.SoapArrayObject.m_proxy_encode.call(this,b,a)},m_proxy_notify:function(a){if(this.m_proxy_item){this.m_proxy_item.m_proxy_notify(null,null,a)}},clear:function(b){if((this.length!=0)&&this.m_proxy_item&&this.m_proxy_item.m_proxy_notify){this.m_proxy_notify(b)}for(var a=0;a<this.length;a++){delete this[a]}this.length=0},remove:function(b,d){b=parseInt(b,10);if(isNaN(b)||b>(this.length-1)){return null}var a=this[b];for(var c=b;c<(this.length-1);c++){this[c]=this[c+1]}delete this[this.length-1];this.length--;this.m_proxy_notify(d);return a},m_proxy_equals:function(a,c){if(this.length!=a.length){return false}for(var b=0;b<a.length;b++){if(!this[b].m_proxy_equals(a[b],c)){return false}}return true},m_proxy_fixLength:function(b,c){if(b!=this.length){this.m_proxy_notify(c)}for(var a=this.length;a<b;a++){this.push(null,c)}for(var a=b;a<this.length;a++){delete this[a]}this.length=b},y_proxy_copy:function(b,d,c){if(c&&this.length){return}if(this.m_proxy_equals(b)){return}this.m_proxy_fixLength(0,d);for(var a=0;a<b.length;a++){this.push(b[a],d)}},m_proxy_convertFromSimple:function(b,c){if(b.length==null){this.m_proxy_fixLength(1,c);this[0].m_proxy_convertFromSimple(b,c)}else{this.m_proxy_fixLength(b.length,c);for(var a=0;a<b.length;a++){this[a].m_proxy_convertFromSimple(b[a],c)}}this.m_proxy_notify(c)},m_proxy_convertToSimple:function(){var a=[];for(var b=0;b<this.length;b++){a[b]=this[b].m_proxy_convertToSimple()}return a},y_proxy_set:function(a,c){this.m_proxy_fixLength(a.length,c);for(var b=0;b<a.length;b++){this[b].set?this[b].set(a[b],c):this[b].y_proxy_set(a[b],c)}},push:function(c,d,a){this.length++;this.m_proxy_notify(d);if(c&&c.m_proxy_isItem){var b=c}else{if(c&&c.r_proxy_type&&(c.r_proxy_type!=this.r_proxy_type)&&(c.type!=this.r_proxy_type)&&(c.r_proxy_type!="anonymous")){var b=new (Echelon.SoapFactoryObject.getInstance().getConstructor(c.r_proxy_type))(this.m_proxy_item)}else{b=new this.m_constructor(this.m_proxy_item)}if(b.m_proxy_initAll){b.m_proxy_initAll((c&&c.UCPTname)?(c.UCPTname.get?c.UCPTname.get():c.UCPTname):null)}if(c!=null){if(c.r_proxy_url){b.r_proxy_url=c.r_proxy_url}if(c.y_proxy_copy){b.y_proxy_copy(c,d)}else{if(b.set!=null){b.set(c,d)}else{b.m_proxy_convertFromSimple(c,d)}}}}return this[this.length-1]=b},insert:function(e,b,f){var d=this.push(e,f,arguments.caller);var a=[d];for(var c=b;a.length<(this.length-b);c++){a.push(this[c])}for(var c=b;c<this.length;c++){this[c]=a[c-b]}return d},pushMax:function(a,b){if(this.length==this.m_max){this.m_proxy_error("Tried to exceed maximal length ("+this.m_max+") as defined in WSDL). ",arguments.caller)}return Echelon.SoapArrayObject.push.call(this,a,b,arguments.caller)},bSort:function(d,c){return(d.get()==c.get())?0:(d.get()?1:-1)},dSort:function(d,c){return d.get().getTime()-c.get().getTime()},nSort:function(d,c){return d.get()-c.get()},sSort:function(d,c){return(d.m_value>c.m_value)?1:((d.m_value<c.m_value)?-1:0)},tSort:function(d,c){if(d.getHours()>c.getHours()){return 1}if(d.getHours()<c.getHours()){return -1}if(d.getMinutes()>c.getMinutes()){return 1}if(d.getMinutes()<c.getMinutes()){return -1}return 0},propSort:function(d,b){var a=d;var c=b;this.sort=function(f,e){return(((f[a].m_value==null)&&(e[a].m_value!=null))?1:(((f[a].m_value!=null)&&(e[a].m_value==null))?-1:c(f[a],e[a])))}},sort:function(j,h,b){if(this.length<2){return this}var a=new Array();var d;if(typeof(j)=="function"){d=j}else{var f=j?this[0][j]:this[0];switch(f.type){case"boolean":d=Echelon.SoapArrayObject.bSort;break;case"date":case"dateTime":d=Echelon.SoapArrayObject.dSort;break;case"time":d=Echelon.SoapArrayObject.tSort;break;case"float":case"int":case"E_UniqueKey":d=Echelon.SoapArrayObject.nSort;break;case"string":d=Echelon.SoapArrayObject.sSort;break;default:this.m_proxy_error('Cannot sort type "'+f.r_proxy_type,arguments.caller)}if(j){d=new Echelon.SoapArrayObject.propSort(j,d).sort}}for(var c=0;c<this.length;c++){a.push(this[c])}try{a.sort(d)}catch(g){this.m_proxy_error("An exception occured while sorting:\n"+g,arguments.caller)}if(b){for(var c=0;c<this.length;c++){this[this.length-(c+1)]=a[c]}}else{for(var c=0;c<this.length;c++){this[c]=a[c]}}return this},swap:function(d,b,c){var a=this[d];this[d]=this[b];this[b]=a;this.m_proxy_notify(c)},create:function(b){var a=function(d){this.length=0;this.m_proxy_item=d};for(var c in {m_proxy_error:1,m_proxy_encode:1,m_proxy_fixLength:1,m_proxy_equals:1,y_proxy_copy:1,m_proxy_convertFromSimple:1,m_proxy_convertToSimple:1,y_proxy_set:1,m_proxy_notify:1,push:1,insert:1,clear:1,remove:1,sort:1,swap:1}){a.prototype[c]=Echelon.SoapArrayObject[c]}for(var c in b){a.prototype[c]=b[c]}return a}};Echelon.SoapComplexAndExtendedMethods={y_proxy_delete:function(b,a){if(this.m_proxy_options.content&&this.m_proxy_options.content[b]&&!this.m_proxy_options.content[b].init){delete this[b]}else{if(this[b].clear){this[b].clear(a)}else{this[b].set(null,a)}}},m_proxy_initAll:function(a){for(var b in this.m_proxy_init){this.m_proxy_init[b].call(this,a)}return this}};Echelon.SoapExtendedMethods={m_proxy_encode:Echelon.SoapDenCoders.enExtended,y_proxy_copy:function(a,c,b){Echelon.SoapBuiltInTypes.y_proxy_copy.call(this,a,c,b);Echelon.SoapComplexMethods.y_proxy_copy.call(this,a,c,b)},m_proxy_convertFromSimple:function(b,c){if(b==null){return}if(b.y_proxy_value!=null){this.set(b.y_proxy_value,c);for(var a in b){if(a!="y_proxy_value"){this[a].m_proxy_convertFromSimple(b[a],c)}}}else{this.set(b,c)}}};Echelon.SoapComplexMethods={m_proxy_error:function(b,a){throw new Error(b+'\n\nThis error occured in SoapComplexObject of type "'+this.r_proxy_type+(this.m_proxy_item?('" in Item "'+this.m_proxy_item.UCPTname.get()+'" of type "'+this.m_proxy_item.r_proxy_type):"")+'"'+(a?("\n\nThe operation causing the error was called by method:\n\n"+a):""))},m_proxy_equals:function(c,d){for(var b in this.m_proxy_options){for(var a in this.m_proxy_options[b]){if(!c[a]){return}if(!this[a].m_proxy_equals){if(typeof(c[a])=="function"){continue}return false}if(!this[a].m_proxy_equals(c[a],d&&d[a])&&(!d||(d[a]!=true))){return false}}}return true},y_proxy_equals:function(a,b){return this.m_proxy_equals(a,b)},y_proxy_copy:function(c,e,d){for(var b in this.m_proxy_options){for(var a in this.m_proxy_options[b]){if((c[a]!=null)&&c[a].y_proxy_copy){if(!this[a].y_proxy_copy){this[a](e)}this[a].y_proxy_copy(c[a],e,d)}else{this.y_proxy_delete(a,e)}}}return this},y_proxy_clear:function(b){var a=Echelon.SoapFactoryObject.getInstance().createObj(this.r_proxy_type,this.UCPTname?this.UCPTname.get():null,this.m_proxy_item);this.y_proxy_copy(a,b);this.m_proxy_item.m_proxy_notify(null,null,b)},y_proxy_set:function(b,c){for(var a in b){this[a].set?this[a].set(b[a],c):this[a].y_proxy_set(b[a],c)}},y_proxy_deepGet:function(c){if(c.search(".")==-1){return this[c].get()}c=c.split(".");var a=this;for(var b=0;b<c.length;b++){a=a?a[c[b]]:null}return a?a.get():null},y_proxy_deepSet:function(e,d,f){if(e.search(".")==-1){return this[e].set(d,f)}e=e.split(".");var b=this;for(var c=0;c<e.length;c++){if(b[e[c]]==null){if(d==null){return null}var a=parseInt(e[c],10);if(isNaN(a)||!b.push){this.m_proxy_error('Invalid field "'+e.join(".")+'" in y_proxy_deepSet',arguments.caller)}while(b.length<(a+1)){b.push()}}else{if(b[e[c]].r_proxy_type==null){if(d==null){return}b[e[c]]()}}b=b[e[c]]}return b.set(d,f)},y_proxy_each:function(b,c){for(var a in this.m_proxy_options.attributes){b.call(c,this[a],a)}for(var a in this.m_proxy_options.content){b.call(c,this[a],a)}},y_proxy_eachDeep:function(c,d,b,a){this.y_proxy_each(function(f,e){if(b&&(f.r_proxy_type==null)){this[e](a||d);f=this[e]}c.call(d,f,e);if(f.y_proxy_eachDeep){f.y_proxy_eachDeep(function(g,h){c.call(d,g,e+"."+h)},this,b,a||d)}},this)},y_proxy_xSelect:function(a){return Echelon.Xselect.getInstance(a).select(this)},m_proxy_encode:Echelon.SoapDenCoders.enComplex,m_proxy_convertFromSimple:function(c,d,b){if(b&&this.y_proxy_mute){this.y_proxy_mute()}for(var a in c){if(this[a]==null){this.m_proxy_error('Invalid property "'+a+'" in convertFromSimple',arguments.caller)}else{if(typeof(this[a])=="function"){this[a](d)}}this[a].m_proxy_convertFromSimple(c[a],d)}return this},m_proxy_convertToSimple:function(c){var b={};for(var a in this){if(this[a].m_proxy_convertToSimple!=null){if(a=="m_proxy_item"){continue}b[a]=this[a].m_proxy_convertToSimple(b,a)}}return b}};Echelon.Webbinding=function(b,a){this.m_targetItem=a;this.m_bindings=[];this.addBinding(b);elon.SoapServerObject.getInstance(b.source.url||a.r_proxy_url,b.id).subscribe({type:b.source.type,Item:b.source.Item,subscriptionId:a,noInitialCallback:(b.noInitialCallback==false)?false:true,id:b.id,callback:new elon.CallbackHandler(this,this.m_handler).method})};Echelon.Webbinding.id=function(a){if(a.m_proxy_isItem){return"m_proxy_binding_"+a.r_proxy_url+a.r_proxy_type+":"+a.UCPTname.get()}return"m_proxy_binding_"+a.url+a.source.type+":"+a.source.Item};Echelon.WebbindingMethods={addBinding:function(b){for(var a=0;a<this.m_bindings.length;a++){if((this.m_bindings[a].sourceField==b.source.field)&&(this.m_bindings[a].targetField==b.target.field)){if((this.m_bindings[a].filterOrig!=b.filter)||(this.m_bindings[a].conditionalOrig!=b.conditional)){this.m_targetItem.m_proxy_error("Tried to overwrite Webbinding with different filter and/or conditional")}return}}this.m_bindings.push({sourceField:b.source.field,targetField:b.target.field});this.m_initFilter(b,"filter");this.m_initFilter(b,"conditional");if(b.noInitialCallback==false){this.m_handler(elon.SoapServerObject.getInstance(b.url,b.id).getItem({type:b.source.type,Item:b.source.Item}))}},m_initFilter:function(d,c){if(d[c]){if(typeof(d[c])=="string"){var b=d[c].split(",");this.m_bindings[this.m_bindings.length-1][c]=[];this.m_bindings[this.m_bindings.length-1][c+"Orig"]=d[c];for(var a=0;a<b.length;a++){this.m_bindings[this.m_bindings.length-1][c].push(elon.filter[b[a]])}}else{this.m_bindings[this.m_bindings.length-1][c]=[d[c]]}}},m_handler:function(c){for(var a=0;a<this.m_bindings.length;a++){var b=c.y_proxy_deepGet(this.m_bindings[a].sourceField);if((this.m_bindings[a].conditional!=null)&&!this.m_filter(this.m_bindings[a].conditional,b,a)){continue}if(this.m_bindings[a].filter){b=this.m_filter(this.m_bindings[a].filter,b,a)}this.m_targetItem.y_proxy_deepSet(this.m_bindings[a].targetField,b,c)}},m_filter:function(d,b,e){var a=this.m_targetItem.y_proxy_deepGet(this.m_bindings[e].targetField);for(var c=0;c<d.length;c++){b=d[c](b,a)}return b}};elon.initPrototype(Echelon.Webbinding,Echelon.WebbindingMethods);Echelon.SoapItemMethods={y_proxy_addBinding:function(a){if(this[Echelon.Webbinding.id(a)]){this[Echelon.Webbinding.id(a)].addBinding(a)}else{this[Echelon.Webbinding.id(a)]=new Echelon.Webbinding(a,this)}},m_proxy_removeBinding:function(a){if(this[Echelon.Webbinding.id(a)]){delete this[Echelon.Webbinding.id(a)]}},m_proxy_collectGarbage:function(){if(!this.m_proxy_subscribers){return}for(var a=0;a<this.m_proxy_subscribers.length;a++){if(this.m_proxy_subscribers[a][1]&&this.m_proxy_subscribers[a][1].m_proxy_isItem){this.m_proxy_subscribers[a][1].m_proxy_removeBinding(this)}}},m_proxy_errMsg:function(b,a){return b+'\n\nThis error occured in SoapItem of type "'+this.r_proxy_type+'" in Item "'+this.UCPTname.get()+'"'+(a?("\n\nThe operation causing the error was called by method:\n\n"+a):"")},m_proxy_error:function(b,a){throw new Error(this.m_proxy_errMsg(b,a))},y_proxy_clone:function(b){var a=(new (Echelon.SoapFactoryObject.getInstance().getConstructor(this.r_proxy_type))()).m_proxy_initAll(this.UCPTname.get());a.m_proxy_noSubmitOnce=true;a.y_proxy_copy(this,b);a.r_proxy_url=this.r_proxy_url;return a},y_proxy_clear:function(b){var a=Echelon.SoapFactoryObject.getInstance().createObj(this.r_proxy_type,this.UCPTname.get(),this);this.y_proxy_copy(a,b);this.m_proxy_notify(null,null,b)},y_proxy_setMsg:function(a){this.m_proxy_msg=a},y_proxy_getMsg:function(a){return this.m_proxy_msg},y_proxy_age:function(a){if(!a&&!this.UCPTlastUpdate.isInitialized()){return null}var b=Echelon.SoapServerObject.getInstance(this.r_proxy_url).ilonTime();if(b==null){return null}return Math.ceil((b.getTime()-(a||this.UCPTlastUpdate).getTime())/1000)},y_proxy_upToDate:function(a,b){return(a==null)?false:((this.y_proxy_age(b)&&(this.y_proxy_age(b)<a))?true:false)},y_proxy_getNameType:function(){return["Network","Channel","Device","Fb","Dp"][this.UCPTname.get().split("/").length-1]},y_proxy_subscribe:function(e,d,c){if(this.m_proxy_subscribers==null){this.m_proxy_subscribers=[]}var b=false;for(var a=0;a<this.m_proxy_subscribers.length;a++){if((this.m_proxy_subscribers[a][0]==e)&&(this.m_proxy_subscribers[a][1]==d)){b=true;if(c&&(this.m_proxy_subscribers[a].length==2)){this.m_proxy_subscribers[a].push(c)}break}}if(!b){this.m_proxy_subscribers.push([e,d]);if(c){this.m_proxy_subscribers[this.m_proxy_subscribers.length-1].push(c)}}},y_proxy_unsubscribe:function(f,d){if(this.m_proxy_callingSubscribers){if(!this.m_proxy_queuedUnsubscribe){this.m_proxy_queuedUnsubscribe=[]}this.m_proxy_queuedUnsubscribe.push([f,d]);return}if(this.m_proxy_subscribers==null){return}var b=[];for(var a=0;a<this.m_proxy_subscribers.length;a++){try{if(((f==null)||(this.m_proxy_subscribers[a][0]==f))&&((d==null)||(this.m_proxy_subscribers[a][1]==d))){continue}}catch(c){continue}b.push(this.m_proxy_subscribers[a])}if(b.length){this.m_proxy_subscribers=b}else{delete this.m_proxy_subscribers}},y_proxy_touch:function(a){elon.UtilObject.getInstance().fireQuickCallback(this.m_proxy_notify,this,null,null,a)},m_proxy_isItem:true,y_proxy_mute:function(){this.m_proxy_muted=true},y_proxy_unmute:function(){delete this.m_proxy_muted},y_proxy_setState:function(b){for(var a in b){this["r_proxy_"+a]=b[a]}},m_proxy_notify:function(a,d,c){if(((this.m_proxy_subscribers==null)&&(!Echelon.SoapSubmitQueueObject.instance||(a||d)))||this.m_proxy_muted){return}if(this.m_proxy_notifying){var b=d||a;if((!c&&!b)||(!b&&(c!=this.m_proxy_notifyId))||(b&&(this.m_proxy_notifyId!="remote"))){this.m_proxy_notifyId=true}return}this.m_proxy_notifying=true;this.m_proxy_notifyId=c?c:((a||d)?"remote":false);elon.UtilObject.getInstance().fireQuickCallback(this.m_proxy_notifyCB,this,a,d)},m_proxy_notifyCB:function(a,f){delete this.m_proxy_notifying;var b=false;var d;try{if(this.m_proxy_notifyId=="remote"){b=true}d=this.m_proxy_notifyId}catch(c){}if(!b&&Echelon.SoapSubmitQueueObject.instance){Echelon.SoapSubmitQueueObject.instance.changeCB(this)}if(this.m_proxy_subscribers==null){return}delete this.m_proxy_notifyId;this.y_proxy_callSubscribers(a,f,d)},y_proxy_callSubscribers:function(a,f,e){if(!this.m_proxy_subscribers){return}var d=[];var c=elon.ExceptionHandler();this.m_proxy_callingSubscribers=true;for(var b=0;b<this.m_proxy_subscribers.length;b++){if(this.m_proxy_subscribers[b][1]&&this.m_proxy_subscribers[b][1].domObj&&!elon.util.isAlive(this.m_proxy_subscribers[b][1].domObj)){continue}if(!(!e||(e!=this.m_proxy_subscribers[b][1]))||c.call(this.m_proxy_subscribers[b][0],[this,a,f])){d[d.length]=this.m_proxy_subscribers[b]}}if(d.length>0){this.m_proxy_subscribers=d}else{delete this.m_proxy_subscribers}delete this.m_proxy_callingSubscribers;if(this.m_proxy_queuedUnsubscribe){for(var b=0;b<this.m_proxy_queuedUnsubscribe.length;b++){this.y_proxy_unsubscribe(this.m_proxy_queuedUnsubscribe[b][0],this.m_proxy_queuedUnsubscribe[b][1])}}}};Echelon.SoapTemplateObject={Instantiator:function(c,a){var d=c;var b=a;this.instantiator=function(e){this[b]=new d(this.m_proxy_isItem?this:this.m_proxy_item);this[b].m_proxy_initAll(a);if(this.m_proxy_notify){this.m_proxy_notify(null,null,e)}else{if(this.m_proxy_item){this.m_proxy_item.m_proxy_notify(null,null,e)}}return this[b]}},extendedInit:function(a){var b=a;this.init=function(c,d){var e=new b(c,d);e.m_proxy_initAll();return e}},createInstantiatorOptions:function(f,a,c){var d={};for(var g=0;g<a.length;g++){var e=a[g];var j=(typeof(e.type)=="string")?(elon.WSDLComplexTypes[e.type]&&elon.WSDLComplexTypes[e.type].baseClass):e.type.baseClass;var o=Echelon.SoapTemplateObject.isExtendedBuiltIn(j);var b=(Echelon.SoapBuiltInTypes[e.type]||elon.WSDLSimpleTypes[e.type]||o)?true:false;var n=typeof(e.type)=="string";if(n){var m=Echelon.SoapFactoryObject.getInstance().getConstructor(e.type)}else{var m=Echelon.SoapTemplateObject.createComplexConstructor(e.type,o)}if(c=="content"){var h=e.max!="1";var l=!(e.min=="0")}else{var h=false;var l=e.use=="required"}d[e.name]={type:e.type};if(e.ns){d[e.name].ns=e.ns}if(h){var p={r_proxy_type:e.type,m_constructor:m,m_name:e.name};if(l||(e.max!="unbounded")){p.m_proxy_encode=Echelon.SoapArrayObject.encodeRequired;if(e.max!="unbounded"){p.push=Echelon.SoapArrayObject.pushMax}p.m_min=parseInt(e.min,10);p.m_max=parseInt(e.max,10)}d[e.name].init=Echelon.SoapArrayObject.create(p);d[e.name].create=m;d[e.name].elementParser=o?Echelon.SoapDenCoders.parseXmlExtended:(b?Echelon.SoapDenCoders.parseXmlSimple:Echelon.SoapDenCoders.parseXmlComplex);d[e.name].parser=Echelon.SoapDenCoders.parseXmlArray}else{if(!b){d[e.name].instantiator=new Echelon.SoapTemplateObject.Instantiator(m,e.name).instantiator;d[e.name].create=m;d[e.name].parser=Echelon.SoapDenCoders.parseXmlComplex}else{d[e.name].parser=o?Echelon.SoapDenCoders.parseXmlExtended:Echelon.SoapDenCoders.parseXmlSimple;if(n){var k=Echelon.SoapFactoryObject.getInstance().getConstructor(e.type)}else{k=Echelon.SoapTemplateObject.createComplexConstructor(e.type,o)}if(e.defaultVal!=null){d[e.name].defaultVal=e.defaultVal}d[e.name].init=o?new Echelon.SoapTemplateObject.extendedInit(k).init:k;d[e.name].create=k}}if(l){d[e.name].required=true}if(Echelon.SoapTemplateObject.isInherited(e,"Item")){d[e.name].Item=true}}if(f[c]){for(var g in d){f[c][g]=d[g]}}else{f[c]=d}},process:function(d,a){if(a.baseClass){var b=a.baseClass;var c=elon.WSDLComplexTypes[b];if(c){Echelon.SoapTemplateObject.process(d,c)}else{if(elon.WSDLSimpleTypes[b]){throw new Error("Inheriting complex objects ("+(a.type?a.type:"anonymous")+") from simple objects ("+b+") is currently not supported in Echelon.SoapTemplateObject.process")}else{if(!Echelon.SoapBuiltInTypes[b]){throw new Error('Unknown type "'+b+'" in Echelon.SoapTemplateObject.process')}}}}for(var e in {attributes:0,content:0}){if(a[e]){Echelon.SoapTemplateObject.createInstantiatorOptions(d,a[e],e)}}},isExtendedBuiltIn:function(a){return Echelon.SoapBuiltInTypes[a]?a:((elon.WSDLComplexTypes[a]&&elon.WSDLComplexTypes[a].baseClass)?Echelon.SoapTemplateObject.isExtendedBuiltIn(elon.WSDLComplexTypes[a].baseClass):false)},isInherited:function(a,b){return !a?false:((a.type==b)?true:((elon.WSDLComplexTypes[a.type]&&elon.WSDLComplexTypes[a.type].baseClass)?Echelon.SoapTemplateObject.isInherited(elon.WSDLComplexTypes[elon.WSDLComplexTypes[a.type].baseClass],b):false))},isItem:function(a){return Echelon.SoapTemplateObject.isInherited(a,"Item")},initProps:function(){for(var c in this.m_proxy_options){for(var a in this.m_proxy_options[c]){if(this.m_proxy_options[c][a].init){var b=this[a]=new this.m_proxy_options[c][a].init(this.m_proxy_isItem?this:this.m_proxy_item,this.m_proxy_options[c][a].defaultVal)}}}},createComplexConstructor:function(a,g){var e=a.type?a.type:"anonymous";if(a.type&&Echelon.SoapTemplateObject.constructorStack[e]){return Echelon.SoapTemplateObject.constructorStack[e]}var d;var f=Echelon.SoapTemplateObject.isInherited(a,"Item");if(f){d=function(h){}}else{if(g){d=function(h,i){this[this.m_proxy_base](h,i)}}else{d=function(h){if(h){this.m_proxy_item=h}}}}if(a.type){Echelon.SoapTemplateObject.constructorStack[a.type]=d}var b={};Echelon.SoapTemplateObject.process(b,a);if(a.ns){d.prototype.m_proxy_ns=a.ns}d.prototype.r_proxy_type=e;d.prototype.m_proxy_options=b;d.prototype.m_proxy_init={props:Echelon.SoapTemplateObject.initProps};for(var c in Echelon.SoapComplexAndExtendedMethods){d.prototype[c]=Echelon.SoapComplexAndExtendedMethods[c]}if(g){elon.copyPrototype(d,Echelon.SoapBuiltInTypes[g],g);d.prototype.m_proxy_base=g;d.prototype.type=a.type;elon.initPrototype(d,Echelon.SoapExtendedMethods)}else{for(var c in Echelon.SoapComplexMethods){d.prototype[c]=Echelon.SoapComplexMethods[c]}}if(f){d.prototype.m_proxy_options.content.UCPTname.create=Echelon.SoapBuiltInTypes.UCPTname;d.prototype.m_proxy_options.content.UCPTname.init=Echelon.SoapBuiltInTypes.UCPTname;elon.initPrototype(d,Echelon.SoapItemMethods);d.prototype.m_proxy_init.name=function(h){if(h==null){this.m_proxy_error("Cannot initialize named Item without name",arguments.caller)}this.UCPTname.m_value=h}}for(var c in b.content){if(b.content[c].instantiator!=null){d.prototype[c]=b.content[c].instantiator}}if(a.type){delete Echelon.SoapTemplateObject.constructorStack[a.type]}return d},constructorStack:{},createSimpleConstructor:function(a){var b=function(c,d){this[a.baseClass](c,d)};elon.copyPrototype(b,Echelon.SoapBuiltInTypes[a.baseClass],a.baseClass);if(a.ns){b.prototype.m_proxy_ns=a.ns}if(a.values){b.prototype.m_values=a.values;b.prototype.m_restriction=function(d,c){if(elon.UtilObject.getInstance().arrIndex(this.m_values,d)==null){this.m_proxy_error('Tried to set invalid value "'+d+'"',c)}}}else{if(a.minInclusive&&a.maxInclusive){b.prototype.m_minInclusive=a.minInclusive;b.prototype.m_maxInclusive=a.maxInclusive;b.prototype.m_restriction=function(d,c){if((d<this.m_minInclusive)||(d>this.m_maxInclusive)){this.m_proxy_error('Tried to set invalid value "'+d+'"',c)}}}else{b.prototype.m_restriction=function(d,c){}}}return b}};Echelon.SoapObjCache=function(){this.m_cache={}};Echelon.SoapObjCacheMethods={init:function(){for(var a in Echelon.SoapObjCacheMethods){if(a!="init"){Echelon.SoapObjCache.prototype[a]=Echelon.SoapObjCacheMethods[a]}}},add:function(d,c,a){if(!d.m_proxy_isItem){return}if(this.m_cache[d.r_proxy_url]==null){this.m_cache[d.r_proxy_url]={}}var b=this.m_cache[d.r_proxy_url][d.r_proxy_type];if(b==null){b=this.m_cache[d.r_proxy_url][d.r_proxy_type]={}}b=b[a||d.UCPTname.get()]={obj:d};if(c){b.data=c}},get:function(c,d,b){var a=this.getWithData(c,d,b);return a&&a.obj},cached:function(a){return(this.get(a.r_proxy_url,a.r_proxy_type,a.UCPTname.get())==null)?false:true},getData:function(b){var a=this.getWithData(b.r_proxy_url,b.r_proxy_type,b.UCPTname.get());return a&&a.data},set:function(b,d,a,f,e){if(this.m_cache[b]==null){this.m_cache[b]={}}var c=this.m_cache[b][d];if(c==null){c=this.m_cache[b][d]={}}c=c[a]={obj:f};c.data=e},getWithData:function(b,c,a){return this.m_cache[b]&&this.m_cache[b][c]&&this.m_cache[b][c][a]},clear:function(){this.m_cache={}},del:function(d,c){var b=this.m_cache[d.r_proxy_url]&&this.m_cache[d.r_proxy_url][d.r_proxy_type];if(b){var a=b[c||d.UCPTname.get()];delete b[c||d.UCPTname.get()];return a}},purge:function(d){var c=this.m_cache[d.r_proxy_url];var a=d.UCPTname.get();for(var b in c){delete c[b][a]}},each:function(f,g){for(var d in this.m_cache){var b=this.m_cache[d];for(var c in b){var e=b[c];for(var a in e){var h=e[a];f.call(g,h.obj,h.data)}}}},isEmpty:function(){return this.length()==0},length:function(){var a=0;this.each(function(){a++});return a},m_xSelRegExp:/\[([^=\(]+)(?:(?:(?:=|\()('|")([^'"]+)\2)|\(([^,]+),('|")([^'"]+)\5\))\]/,List:function(b,l){var f=l.match(this.m_xSelRegExp);var g=[];var a=this.m_cache[b];if(!f||!a){return g}var k=f[1];var c=f[3];switch(k){case"@xsi:type":a=a[c];for(var e in a){g.push(a[e].obj)}break;case"UCPTname":for(var e in a){for(var d in a[e]){if(a[e][d].obj.UCPTname&&(a[e][d].obj.UCPTname.get()==c)){g.push(a[e][d].obj)}}}break;case"starts-with":var h=f[4];c=new RegExp("^"+elon.UtilObject.getInstance().escapeRegExp(f[6]));for(var e in a){for(var d in a[e]){if(a[e][d].obj[h]&&(a[e][d].obj[h].get().match(c))){g.push(a[e][d].obj)}}}break}return g},Get:function(d,g){var f=elon.Xselect(g);var c=[];var a=this.m_cache[d];for(var e in a){for(var b in a[e]){if(f.match(a[e][b].obj)){c.push(a[e][b].obj)}}}return c},m_list:function(d,g){var f=elon.Xselect(g);var c=[];var a=this.m_cache[d];for(var e in a){for(var b in a[e]){if(f.match(a[e][b].obj)){if(a.Item[a[e][b].obj.UCPTname.get()]){c.push(a.Item[a[e][b].obj.UCPTname.get()].obj)}}}}return c}};Echelon.SoapObjCacheMethods.init();Echelon.SoapObjCache.getInstance=function(){var a=new Echelon.SoapObjCache();return a};Echelon.SoapFactoryObject=function(){var b=this;var e=Echelon.SoapObjCache.getInstance();var g=Echelon.SoapObjCache.getInstance();this.m_redirectsCache=Echelon.SoapObjCache.getInstance();this.m_syncCache=Echelon.SoapObjCache.getInstance();var h={};this.get=function(n,l,k,o,p){if(k&&(!p||(p.domObj==null))){alert("Invalid id")}if(k&&(!p||(p.domObj==null))){throw new Error("Invalid id")}if(n=="generalFb"){n=this.m_getGeneralFbType(l,n,k)}var m=e.getWithData(l,n,k);if(m){this.m_addGarbage(m,p.domObj);if((m.obj.r_proxy_type!=n)&&(n!=null)){throw new Error("Type mismatch in Echelon.SoapFactoryObject.get")}return m.obj}else{m=b.createObj(n,k,o);if(elon.filter.webDp(k)){m.m_proxy_noSubmit=true}m.r_proxy_url=l;if(m.m_proxy_isItem){e.add(m,[p.domObj])}return m}};this.List=function(k,l){return(e.List(k,l))};this.Get=function(k,l){return(e.Get(k,l))};this.decode=function(o,n,q,k,r,m){if(!r||(r.domObj==null)){throw new Error("Invalid id")}var l=a(o,"UCPTname");var p=e.getWithData(n,q||k.type,l);if(!p){p=q?new (b.getConstructor(q))():new k.create();p.r_proxy_url=n;e.add(p,[r.domObj],l);p.m_proxy_lastUpdate=m;return p}this.m_addGarbage(p,r.domObj);if(p.obj.r_proxy_tainted){return j(o,p.obj,(q?b.getConstructor(q):k.create),m)}else{p.obj.m_proxy_lastUpdate=m}return p.obj};this.getConstructor=function(k){var l=null;l=h[k];if(l){return l}l=Echelon.SoapBuiltInTypes[k];if(l){return h[k]=l}l=elon.WSDLComplexTypes[k];if(l){return h[k]=Echelon.SoapTemplateObject.createComplexConstructor(l,Echelon.SoapTemplateObject.isExtendedBuiltIn(l.baseClass))}l=elon.WSDLSimpleTypes[k];if(l){return h[k]=Echelon.SoapTemplateObject.createSimpleConstructor(l)}throw new Error('Unknown type "'+k+'" in Echelon.SoapFactoryObject.getConstructor')};this.convertFromSimple=function(n,p,m,q,o){if(p.UCPTname==null){return(b.createObj(n)).m_proxy_convertFromSimple(p,q,o)}var l=p.UCPTname;delete p.UCPTname;var k=(b.get(n,m,l,null,q)).m_proxy_convertFromSimple(p,q,o);p.UCPTname=l;return k};this.rename=function(v,s,l,r,k){if(e.get(v.r_proxy_url,v.r_proxy_type,s)){throw new Error('SoapFactory object cannot rename "'+v.UCPTname.get()+'" to "'+s+'": "'+s+'" already exists')}var p=e.getData(v);e.del(v);var m=(k&&k.ol)||new RegExp("^"+elon.UtilObject.getInstance().escapeRegExp(v.UCPTname.m_value)+"/");var u=v.UCPTname.m_value;var t=v.y_proxy_clone();if(v.r_proxy_fromIlon){this.m_redirectsCache.add(t,{obj:v});if(!this.m_redirectsCache.getWithData(t.r_proxy_url,"Item",t.UCPTname.get())){this.m_redirectsCache.set(t.r_proxy_url,"Item",t.UCPTname.get(),t,{obj:v})}}v.UCPTname.m_value=s;if(v.DataPoint&&(v.DataPoint.r_proxy_type=="E_DpRef")){this.m_fixDpRefs(v,m,k&&k.nu)}e.add(v,p);this.m_addGarbage({data:p,obj:v},l.domObj);if(!r){v.m_proxy_notify(null,null,l);v.m_proxy_clearRedirect=this.m_ClearRedirectSubmit(t,this);var n=elon.elon.getTopLevelSSO();n.addSubmitCallback(this.m_ClearRedirectUnsubmit(t,this))}if(!k){var q=e.List(v.r_proxy_url,'//Item[UCPTname="'+u+'"]');for(var o=0;o<q.length;o++){this.rename(q[o],s,l,true,{ol:m,nu:s})}var q=e.List(v.r_proxy_url,'//Item[starts-with(UCPTname,"'+u+'/")]');for(var o=0;o<q.length;o++){this.rename(q[o],q[o].UCPTname.m_value.replace(m,s+"/"),l,true,{ol:m,nu:s})}}if(Echelon.SoapSubmitQueueObject.instance){Echelon.SoapSubmitQueueObject.instance.rename(v,u)}};this.m_fixDpRefs=function(n,m,k){for(var l=0;l<n.DataPoint.length;l++){n.DataPoint[l].UCPTname.m_value=n.DataPoint[l].UCPTname.get().replace(m,(k||n.UCPTname.get())+"/")}};this.markDeleted=function(n,p,m){if(!n.r_proxy_fromIlon&&!p){return}this.m_redirectsCache.add(n,{obj:n,del:true});n.m_proxy_clearRedirect=this.m_ClearRedirectDel(n,this);var q=elon.elon.getTopLevelSSO();q.addSubmitCallback(this.m_ClearRedirectUndel(n,this));if(m){return}var k=n.UCPTname.get();if(!this.m_redirectsCache.getWithData(n.r_proxy_url,"Item",k)){this.m_redirectsCache.set(n.r_proxy_url,"Item",k,n,{obj:n})}var o=e.List(n.r_proxy_url,'//Item[starts-with(UCPTname,"'+k+'/")]');for(var l=0;l<o.length;l++){if(!this.m_redirectsCache.cached(o[l])){this.markDeleted(o[l],p,true)}}};this.handleRedirects=function(k,m,q){var p;for(var n=0;n<k.length;n++){if((p=this.m_redirectsCache.getData(k[n]))&&(!k[n].UCPTitemStatus||(k[n].UCPTitemStatus.get()!="IS_DELETED"))){if(p.del){this.m_redirectsCache.add(k[n],{obj:p.obj,error:m,header:q,del:true});if(k[n].r_proxy_type=="Item"){var o=e.List(k[n].r_proxy_url,'//Item[UCPTname="'+k[n].UCPTname.get()+'"]');for(var l=0;l<o.length;l++){if(o[l].r_proxy_type!="Item"){e.del(o[l])}}var o=this.m_redirectsCache.List(k[n].r_proxy_url,'//Item[UCPTname="'+k[n].UCPTname.get()+'"]');for(var l=0;l<o.length;l++){if(o[l].r_proxy_type!="Item"){this.m_redirectsCache.del(o[l])}}}}else{if((!k[n].UCPTlastUpdate||(k[n].UCPTlastUpdate.getTime()>p.obj.UCPTlastUpdate.getTime()))&&Echelon.SoapSubmitQueueObject.instance){Echelon.SoapSubmitQueueObject.instance.addUpdate(p.obj,k[n])}}k.remove(n);n--}}};this.clearRedirect=function(l){var k=this.m_redirectsCache.getWithData(l.r_proxy_url,l.r_proxy_type,l.UCPTname.get());if(!k){return}this.m_clearRedirectsTree(l);if(!k.data.error&&!k.data.header){return}if(k.data.obj){k.data.obj.y_proxy_copy(k.obj)}};this.m_clearRedirectsTree=function(m){var k=this.m_redirectsCache.List(m.r_proxy_url,'//Item[starts-with(UCPTname,"'+m.UCPTname.get()+'/")]');for(var l=0;l<k.length;l++){this.m_redirectsCache.del(k[l])}this.m_redirectsCache.purge(m)};this.m_ClearRedirectUnsubmit=elon.Class({constructor:["m_item","parent"],closure:function(k){if(!k){this.parent.clearRedirect(this.m_item)}}});this.m_ClearRedirectSubmit=elon.Class({constructor:["m_item","parent"],closure:function(k){this.parent.clearRedirect(this.m_item)}});this.m_ClearRedirectDel=elon.Class({constructor:["m_item","parent"],closure:function(k){this.parent.m_clearRedirectsTree(this.m_item)}});this.m_ClearRedirectUndel=elon.Class({constructor:["m_item","parent"],closure:function(k){if(!k){this.parent.clearRedirect(this.m_item)}}});this.m_getGeneralFbType=function(l,n,k){var o=e.List(l,'//Item[UCPTname="'+k+'"]');for(var m=0;m<o.length;m++){if(!o[m].r_proxy_type.match(/^(?:(?:[a-zA-Z]+_)?Fb_Cfg)|(?:(?:[a-zA-Z]+_)?_Data)|Item$/)){return o[m].r_proxy_type}}return"Fb_Cfg"};this.collectGarbage=function(){g.each(function(s){if(!c(s)){e.del(s);g.del(s)}});var l=[];var o=new Date().getTime();var q=0;var k={};var r=[];e.each(function(u,t){if(i(u,t)){l.push(u)}else{var s=u.m_proxy_lastUpdate||Number.MAX_VALUE;if(!k[s]){k[s]=[];r.push(s)}k[s].push(u);q++}});r.sort();for(var p=q;p>elon.globals.itemCacheSize;){var n=k[r.shift()];if(!n){break}for(var m=0;m<n.length;m++){if(d(n[m])){e.del(n[m]);p--}}}for(var p=0;p<l.length;p++){l[p].m_proxy_collectGarbage();e.del(l[p])}};this.delFromCache=function(k){e.del(k)};this.purgeFromCache=function(k){e.purge(k)};this.sync=function(k,u,q,m){var l={};var t={};var v={};this.m_syncCache.each(function(x){this.m_syncCache.del(x);this.m_prepareItemSync(t,l,v,x)},this);if(k){for(var p=0;p<k.Item.length;p++){if(k.Item[p].UCPTitemStatus.get()=="IS_DELETED"){var s=elon.filter.annotationType(k.Item[p].UCPTannotation.get());if(elon.filter.driverType(s)){var r=e.List(k.Item[p].r_proxy_url,'//Item[UCPTname="'+k.Item[p].UCPTname.get()+'"]');for(var o=0;o<r.length;o++){if(c(r[o])){this.m_QueueDeletion()(r[o])}else{e.del(r[o])}}if(!s.match(/^[^_]+_Dp_/)){var r=e.List(k.Item[p].r_proxy_url,'//Item[starts-with(UCPTname,"'+k.Item[p].UCPTname.get()+'/")]');var n=false;for(var o=0;o<r.length;o++){if(c(r[o])&&r[o].r_proxy_type.match(new RegExp("_Cfg$"))&&(!r[o].UCPTaliasName||(r[o].UCPTaliasName.get()!="i.LON System SoftwareVersion"))){n=r[o]}Echelon.SoapSubmitQueueObject.getInstance().remove([r[o]])}if(n){elon.elon.followLink({elon_url:elon.htmUrl("")+this.m_determinLang(n,true)+"ParentDeleted.htm",elon_target:"appFrame"});elon.elon.setErrMsg('Deleted parent item of "'+n.UCPTname.get()+'": "'+k.Item[p].UCPTname.get()+'"')}e.purge(k.Item[p])}}else{var w=e.get(k.Item[p].r_proxy_url,s,k.Item[p].UCPTname.get());if(!w){continue}else{if(c(w)){this.m_QueueDeletion()(w)}else{e.del(w)}}}continue}var r=e.List(k.Item[p].r_proxy_url,'//Item[UCPTname="'+k.Item[p].UCPTname.get()+'"]');for(var o=0;o<r.length;o++){this.m_prepareItemSync(t,l,v,r[o],k.Item[p])}}}for(var o in t){elon.elon.getTopLevelSSO().distribute({xSelect:'//Item[@xsi:type="'+(v[o]?(v[o]+":"):"")+o+'"]',elon_no_aggregation:true,noErrMsg:true,type:"Item",returnMissing:true,Item:t[o],callback:this.m_FinishSync(m,o,l[o],t[o].length),id:"volatile",namespace:(v[o]&&[v[o]])},"Get")}};this.m_QueueDeletion=elon.Class({instantiator:"singleton",closure:function(k){this.m_lang=elon.SoapFactoryObject.getInstance().m_determinLang(k);g.add(k);if(this.m_name){if(!this.m_name[k.UCPTname.get()]){this.m_name.push(k.UCPTname.get());this.m_name[k.UCPTname.get()]=true}}else{this.m_name=[k.UCPTname.get()];this.m_name[this.m_name[0]]=true;elon.util.fireQuickCallback(this.m_popup,this)}},"private":{m_popup:function(){elon.elon.followLink({elon_url:elon.htmUrl("Alert.htm"),elon_target:"popup",elon_popup_width:400,elon_args_obj:{elon_lang:this.m_lang,elon_nls_title:"ITEM_DELETED_TITLE",elon_nls_msg:"ITEM_DELETED_MSG",elon_align:"left",elon_placeholder_name:this.m_name.join(", ")}});delete this.m_name}}});this.m_determinLang=function(m,l){var o="";if(m.m_proxy_subscribers){for(var k=0;k<m.m_proxy_subscribers.length;k++){try{o=m.m_proxy_subscribers[k][1].argObj.elon_lang||o;break}catch(n){continue}}}if(l&&o){o+="/"}return o};this.m_prepareItemSync=function(p,l,k,q,o){var n=q.r_proxy_type;if(Echelon.WSDLInternalTypes[n]){return}var m=q.m_proxy_ns;if(d(q)){e.del(q)}else{if((n!="Item")&&(!l[n]||!l[n][q.UCPTname.get()])&&(!o||!o.UCPTitemStatus||(o.UCPTitemStatus.get()!="IS_NOTSYNCED"))){if(!q.r_proxy_fromIlon&&q.r_proxy_tainted){this.m_syncCache.add(q);return}if(!n.match(new RegExp("_Data$"))){if(!o){o=this.get("Item",q.r_proxy_url,q.UCPTname.get(),null,{domObj:false})}q.r_proxy_retrieving=true;if(!p[n]){p[n]=[]}p[n].push(o);if(m!="ilon"){k[n]=m}if(!l[n]){l[n]={}}l[n][q.UCPTname.get()]=true}}}};this.m_FinishSync=elon.Class({constructor:["m_url","m_type","m_items","m_total"],closure:function(n){var l;var o;if(n&&(n.Item.length==this.m_total)){for(var k=0;k<n.Item.length;k++){if(this.m_items[n.Item[k].UCPTname.get()]&&(n.Item[k].r_proxy_url==this.m_url)&&n.Item[k].fault&&n.Item[k].fault.faultcode&&{"14":1,"6":1}[n.Item[k].fault.faultcode.get()]){delete e.getWithData(this.m_url,this.m_type,n.Item[k].UCPTname.get()).obj.r_proxy_retrieving;delete this.m_items[n.Item[k].UCPTname.get()];o=true}else{if(this.m_items[n.Item[k].UCPTname.get()]&&(n.Item[k].r_proxy_type==this.m_type)&&(n.Item[k].r_proxy_url==this.m_url)){delete this.m_items[n.Item[k].UCPTname.get()]}else{l=n.Item[k].UCPTname.get();break}}}}else{for(var m in this.m_items){var p=e.getWithData(this.m_url,this.m_type,m).obj;if(!p.r_proxy_silentDefault){l=m}delete p.r_proxy_retrieving}}if(l&&!elon.elon.getTopLevelSSO().isAdmin()){elon.elon.setErrMsg('Failed to synchronize "'+l+'" with the SmartServer. Please press <F5>.')}if(o){if(Echelon.SoapPollerObject.instances[this.m_url]){Echelon.SoapPollerObject.instances[this.m_url].triggerPoll()}}}});var f=function(k){return Echelon.SoapSubmitQueueObject.instance&&Echelon.SoapSubmitQueueObject.instance.queued(k)};this.visible=function(m){var l=e.List(m.r_proxy_url,'//Item[UCPTname="'+m.UCPTname.get()+'"]');for(var k=0;k<l.length;k++){if(c(l[k])){return true}}return false};var c=function(q,o){if(!o){o=e.getData(q)}if(!o){return false}var n=0;var k=false;for(var l=0;l<o.length;l++){var m=false;try{if(o[l]==true){k=true;continue}if(o[l]==false){n++}else{m=!elon.util.isAlive(o[l])}}catch(p){m=true}if(m){o.splice(l,1);l--}}return k||(n!=o.length)};var d=function(l,k){return !f(l)&&!c(l,k)};var i=function(l,k){return d(l,k)&&(l.r_proxy_tainted||!l.m_proxy_lastUpdate)};this.unregister=function(l,o){var m=e.getData(l);if(!m){return}for(var k=0;k<m.length;k++){try{if(o==m[k]){m.splice(k,1);break}}catch(n){}}};this.m_addGarbage=function(l,o){if(!l.data){return}var m=false;for(var k=0;k<l.data.length;k++){try{if(o==l.data[k]){m=true;break}}catch(n){}}if(!m){l.data.push(o)}};var j=function(l,n,m,k){var p=a(l,"UCPTlastUpdate");if(p){p=Echelon.DateTimeObject.parseIso(p)}if(p&&(p>n.UCPTlastUpdate.getTime())){var o=new m();if(Echelon.SoapSubmitQueueObject.instance&&!Echelon.SoapSubmitQueueObject.instance.deleted(n)){Echelon.SoapSubmitQueueObject.instance.addUpdate(n,o)}else{return n}return o}else{n.m_proxy_dont_parse=true;return n}};this.createObj=function(l,k,m){return(new (b.getConstructor(l))(m)).m_proxy_initAll(k)};var a=function(k,m){var l=k.getElementsByTagName(m);if(!l.length&&k.prefix){l=k.getElementsByTagName(k.prefix+":"+m)}return l&&l[0]&&l[0].firstChild&&l[0].firstChild.nodeValue}};Echelon.SoapFactoryObject.getInstance=function(){if(Echelon.SoapFactoryObject.instance==null){Echelon.SoapFactoryObject.instance=new Echelon.SoapFactoryObject()}return Echelon.SoapFactoryObject.instance};Echelon.SoapFactoryObject.instance=null;Echelon.SoapVersionDiscoveryObject=function(){var e=this;var h=elon.ErrorTable.getInstance();var d=elon.UtilObject.getInstance();var f=elon.DateHelperObject.getInstance();var j=Echelon.SoapServerObject.getInstance();var l="/ilon100.disco";var i=30;var a=0;var c=elon.CacheObject.getInstance();this.discover=function(t,m,u,s){var n={callback:u};if(window.ActiveXObject){var r=b(t,m,l);if(r==""){return g(n,null,h.ERR_WSCLI_INVALID_ARG,1)}else{n.hostname=t;var p=new window.ActiveXObject("MSXML2.DOMDocument");p.async=true;s=(d.isSafe(s))?s*f.ONE_SEC:i*f.ONE_SEC;try{p.load(r);p.onreadystatechange=function(){k(a)};return g(n,p,h.ERR_WSCLI_TIMEOUT,s)}catch(o){var q=h.ERR_WSCLI_UNKNOWN_ERROR;if(o.description.indexOf("Access is denied")!=-1){q=h.ERR_WSCLI_ACCESS_DENIED}return g(n,null,q,1)}}}else{if(window.DOMParser){return g(n,null,h.ERR_WSCLI_BROWSER_UNSUPPORTED,1)}else{return g(n,null,h.ERR_WSCLI_BROWSER_UNSUPPORTED,1)}}};var g=function(m,p,o,n){a++;m.xmlObj=p;m.timerId=window.setTimeout("top.Echelon.SoapVersionDiscoveryObject.getInstance().abort("+a+","+o+");",n);c.addObj(m,a);return a};this.abort=function(o,m){var s=false;var q=c.getObj(o);var n="-1";if(d.isSafe(q)){s=true;m=(d.isSafe(m))?m:h.ERR_WSCLI_UNKNOWN_ERROR;var p=Error.getInstance(m);if(d.isSafe(q.xmlObj)){q.xmlObj.abort()}try{window.clearTimeout(q.timerId)}catch(r){}try{q.callback(q.hostname,p,n)}catch(r){if((r.number==null)||((r.number&65535)!=5011)){throw r}}c.removeObj(o)}return s};var k=function(w){var m=c.getObj(w);if((m==null)||m.xmlObj.readyState!=4){return}var v=null;if(m.xmlObj.parseError==0){var o=m.xmlObj.selectNodes("discovery/contractRef");var t=o.item(o.length-1);var r=t.attributes.getNamedItem("ref").text;var u={"WSDL/ILON100.WSDL":"1.0","WSDL/V1.1/ILON100.WSDL":"1.1","WSDL/V3.0/ILON100.WSDL":"3.0","WSDL/V4.0/ILON100.WSDL":"4.0"}[r.toUpperCase()]||"-1";if(u=="-1"){v=Error.getInstance(h.ERR_WSSRV_XML_LOAD_FAILED_FILE,{hostname:m.hostname})}try{m.callback(m.hostname,v,u)}catch(q){if((q.number==null)||((q.number&65535)!=5011)){throw q}}}else{if(d.isSafe(m.xmlObj.parseError)){var p={hostname:m.hostname};var n=m.xmlObj.parseError.errorCode;var s;if(n==(2148270085&4294967295)){s="_HOST"}else{if((n==(2148270088&4294967295))||(n==(3222069782&4294967295))){s="_IP"}else{if(n==(2148270086&4294967295)){s="_FILE"}else{s="";p.error=m.xmlObj.parseError.reason}}}v=Error.getInstance(h["ERR_WSSRV_XML_LOAD_FAILED"+s],p)}else{v=Error.getInstance(h.ERR_WSCLI_UNKNOWN_ERROR)}try{m.callback(m.hostname,v,u)}catch(q){if((q.number==null)||((q.number&65535)!=5011)){throw q}}}try{window.clearTimeout(m.timerId)}catch(q){}c.removeObj(w)};var b=function(n,m,p){var o="";if(n!=null){o+=elon.elon.httpS(n);if(d.isSafe(m)&&(m!="")){o+=":"+m}o+=p}return o}};Echelon.SoapVersionDiscoveryObject.instance;Echelon.SoapVersionDiscoveryObject.getInstance=function(){if(Echelon.SoapVersionDiscoveryObject.instance==null){Echelon.SoapVersionDiscoveryObject.instance=new Echelon.SoapVersionDiscoveryObject()}return Echelon.SoapVersionDiscoveryObject.instance};Echelon.Xselect=elon.Class({constructor:function(g){g=g.replace(" and ","][");this.m_subNode=g.match(/^\/\/(\w+)/)[1];var f=g.match(this.m_listExp);if(f.length==0){elon.elon.setDbgMsg('Unsupported xslect "'+g+'"');return}this.expressions={attributes:{},content:{}};for(var c=0;c<f.length;c++){var d=f[c].match(this.m_compExp)||f[c].match(this.m_funcExp);if(!d){elon.elon.setDbgMsg('Invalid expression "'+f[c]+'" in xSelect "'+g+'"');continue}if(d[3]=="UCPTformatDescription"){d[5]="/";d[6]="^"+elon.util.escapeRegExp(d[4])+"(#\\w+)?$"}if(d[1]){if(this.m_func[d[1]]){var a=this.m_func[d[1]](d[6])}else{elon.elon.setDbgMsg('xSelect function "'+d[1]+'" not implemented')}}else{if(d[5]=="/"){a=this.m_Match(d[7]?new RegExp(elon.util.escapeRegExp(d[6]),d[7]):new RegExp(elon.util.escapeRegExp(d[6])))}else{if(d[4]=="="){a=this.m_Eql(d[6])}else{if(d[4]=="!="){a=this.m_UnEql(d[6])}else{elon.elon.setDbgMsg('Unknown xSelect comparator "'+d[4]+'" in expression "'+f[c]+'" in xSelect "'+g+'"');continue}}}}var b=d[2]?"attributes":"content";this.expressions[b][d[3]]=this.expressions[b][d[3]]?this.m_And(this.expressions[b][d[3]],a):a}},"public":{match:function(d){for(var c in this.expressions){for(var b in this.expressions[c]){var a=b=="xsi:type";if(!a&&(!d.m_proxy_options[c]||!d.m_proxy_options[c][b])){return false}var e=a?d.r_proxy_type:d[b].get();if(!this.expressions[c][b](e)){return false}}}return true},filter:function(c){var a=this.select(c);if(a.length!=c[this.m_subNode].length){if(c[this.m_subNode].clear){c[this.m_subNode].clear()}else{c[this.m_subNode]=new Array()}for(var b=0;b<a.length;b++){c[this.m_subNode][b]=a[b]}c[this.m_subNode].length=a.length}return c[this.m_subNode]},remove:function(c){if(!this.expressions){return c[this.m_subNode]}var a=[];for(var b=0;b<c[this.m_subNode].length;b++){if(this.match(c[this.m_subNode][b])){c[this.m_subNode].remove(b)}}return a},select:function(c){if(!this.expressions){return c[this.m_subNode]}var a=[];for(var b=0;b<c[this.m_subNode].length;b++){if(this.match(c[this.m_subNode][b])){a.push(c[this.m_subNode][b])}}return a}},"private":{m_listExp:new RegExp("\\[(@?)([^!=\\(/]+)(?:(?:[\\t ]*(?:!=|=|\\()[\\t ]*('|\"|/)((?:.(?:\\\\\\3|(?!\\3)))*.)\\3([gim]{0,3}))|\\((@?)([^,]+)[\\t ]*,[\\t ]*('|\"|/)((?:.(?!\\8))+.)\\8([gim]{0,3})[\\t ]*\\))[\\t ]*\\]","g"),m_compExp:new RegExp("()\\[(@?)([^!=\\(\\/\\n,]+)[\\t ]*(?:(!=|=)[\\t ]*('|\"|\\/)((?:.(?:\\\\\\5|(?!\\5)))*.)\\5([gim]{0,3}))[\\t ]*\\]"),m_funcExp:new RegExp("\\[([^\\(\\n=]+)\\([\\t ]*(@?)([^,\\s]+)[\\t ]*,[\\t ]*()('|\"|\\/)((?:.(?:\\\\\\5|(?!\\5)))*.)\\5([gim]{0,3})[\\t ]*\\)\\]"),m_func:{"ends-with":elon.Class({constructor:function(a){this.m_match=new RegExp(elon.util.escapeRegExp(a)+"$")},closure:function(a){return this.m_match.test(a)}}),matches:elon.Class({constructor:function(a){this.m_match=new RegExp(a)},closure:function(a){return this.m_match.test(a)}}),"starts-with":elon.Class({constructor:function(a){this.m_match=new RegExp("^"+elon.util.escapeRegExp(a))},closure:function(a){return this.m_match.test(a)}})},m_Match:elon.Class({constructor:["m_exp"],closure:function(a){return this.m_exp.test(a)}}),m_UnEql:elon.Class({constructor:["m_val"],closure:function(a){return a!=this.m_val}}),m_And:elon.Class({constructor:["m_exp1","m_exp2"],closure:function(a){return this.m_exp1(a)&&this.m_exp2(a)}}),m_Eql:elon.Class({constructor:["m_val"],closure:function(a){return a==this.m_val}})}});Echelon.DefaultItem={Channel_Cfg:{UCPTannotation:"IP",UCPThidden:0},Device_Cfg:{UCPTannotation:"App",UCPThidden:0},Dp_Cfg:{UCPTannotation:"Dp_In",UCPThidden:0,UCPTformatDescription:"RAW_HEX",UCPTlength:1,UCPTdirection:{LonFormat:"UCPTdirection",y_proxy_value:"DIR_IN"}},Dp_Ref:{UCPTannotation:"Dp_In_WebBinding",UCPThidden:0},Fb_Cfg:{UCPTannotation:"defaultFb",UCPThidden:0},IP_Channel_Cfg:{UCPTannotation:"LAN",UCPThidden:0,UCPTprotocol:"IPv4"},Item:{},LNS_DB_Cfg:{UCPTannotation:"LNS",UCPThidden:0},LON_Channel_Cfg:{UCPTchannelType:{LonFormat:"UCPTchannelType",y_proxy_value:"CT_LON"},UCPTtransceiverId:{LonFormat:"UCPTtransceiverId",y_proxy_value:"TP_FT_10"},UCPTretryCount:3,UCPTchannelMode:{LonFormat:"UCPTchannelMode",y_proxy_value:"AM_ONLINE"}},LON_Channel_Timing:{IP_10L:{UCPTdelay:50,UCPTtransmitTimer:"TT_64",UCPTretryCount:3},IP_10W:{UCPTdelay:500,UCPTtransmitTimer:"TT_64",UCPTretryCount:3},TP_FT_10:{UCPTdelay:14,UCPTtransmitTimer:"TT_96",UCPTretryCount:3},TP_XF_1250:{UCPTdelay:4,UCPTtransmitTimer:"TT_64",UCPTretryCount:3},TP_XF_78:{UCPTdelay:10,UCPTtransmitTimer:"TT_96",UCPTretryCount:3},PL_20C:{UCPTdelay:190,UCPTtransmitTimer:"TT_512",UCPTretryCount:5},PL_20N:{UCPTdelay:190,UCPTtransmitTimer:"TT_512",UCPTretryCount:5},PL_20C_LOW:{UCPTdelay:190,UCPTtransmitTimer:"TT_512",UCPTretryCount:5},PL_20A:{UCPTdelay:313,UCPTtransmitTimer:"TT_512",UCPTretryCount:5},PL_20A_LOW:{UCPTdelay:313,UCPTtransmitTimer:"TT_512",UCPTretryCount:5},TP_RS485_39:{UCPTdelay:16,UCPTtransmitTimer:"TT_256",UCPTretryCount:3},TP_RS485_78:{UCPTdelay:10,UCPTtransmitTimer:"TT_96",UCPTretryCount:3},TP_RS485_625:{UCPTdelay:6,UCPTtransmitTimer:"TT_64",UCPTretryCount:3},TP_RS485_1250:{UCPTdelay:4,UCPTtransmitTimer:"TT_64",UCPTretryCount:3},RF_10:{UCPTdelay:116,UCPTtransmitTimer:"TT_512",UCPTretryCount:3},CUSTOM:{UCPTdelay:100,UCPTtransmitTimer:"TT_512",UCPTretryCount:3}},LON_Device_Cfg:{UCPTannotation:"App",UCPThidden:0,UCPTapplicationStatus:{LonFormat:"UCPTapplicationStatus",y_proxy_value:"APP_RUNNING"},UCPTcommissionStatus:{LonFormat:"UCPTcommissionStatus",y_proxy_value:"COMSTATE_NUL"}},LON_Device_Router_Cfg:{UCPTannotation:"Router",UCPThidden:0,UCPTuri:"LON_Device_Router_Cfg.htm",UCPTapplicationStatus:{LonFormat:"UCPTapplicationStatus",y_proxy_value:"APP_RUNNING"},UCPTcommissionStatus:{LonFormat:"UCPTcommissionStatus",y_proxy_value:"COMSTATE_NUL"},UCPTrouterClass:{LonFormat:"UCPTrouterClass",y_proxy_value:"LCA_REPEATER"}},LON_Device_RNI_Cfg:{UCPTannotation:"RNI",UCPThidden:0,UCPTuri:"LON_Device_NetworkInterface_Cfg.htm",UCPTapplicationStatus:{LonFormat:"UCPTapplicationStatus",y_proxy_value:"APP_RUNNING"},UCPTcommissionStatus:{LonFormat:"UCPTcommissionStatus",y_proxy_value:"COMSTATE_NUL"},UCPTusage:{LonFormat:"UCPTusage",y_proxy_value:"USAGE_LNS_PROXY"}},LON_Device_NetworkInterface_Cfg:{UCPTannotation:"NetworkInterface",UCPThidden:0,UCPTuri:"LON_Device_NetworkInterface_Cfg.htm",UCPTapplicationStatus:{LonFormat:"UCPTapplicationStatus",y_proxy_value:"APP_RUNNING"},UCPTcommissionStatus:{LonFormat:"UCPTcommissionStatus",y_proxy_value:"COMSTATE_NUL"},UCPTusage:{LonFormat:"UCPTusage",y_proxy_value:"USAGE_LNS_PROXY"}},LON_Dp_Cfg:{UCPTannotation:"Dp_In",UCPThidden:0,UCPTdirection:{LonFormat:"UCPTdirection",y_proxy_value:"DIR_IN"}},LON_Fb_Cfg:{UCPTannotation:"VirtualFunctionBlock",UCPThidden:0},LON_Network_Cfg:{UCPTannotation:"LNS",UCPThidden:0},MBS_Channel_Cfg:{UCPTannotation:"RS232",UCPThidden:0,UCPTchannelType:{LonFormat:"UCPTchannelType",y_proxy_value:"CT_RS232_MASTER"},InterfaceOptions:{UCPTspeed:{LonFormat:"UCPTspeed",y_proxy_value:"MS_2400"},UCPTsize:{LonFormat:"UCPTsize",y_proxy_value:"CS_8"},UCPTparity:{LonFormat:"UCPTparity",y_proxy_value:"P_EVEN"},UCPTstopBits:{LonFormat:"UCPTstopBits",y_proxy_value:"SB_1"}}},MBS_Device_Cfg:{UCPTannotation:"App",UCPThidden:0,UCPTspeed:{LonFormat:"UCPTspeed",y_proxy_value:"MS_2400"},Address:{UCPTmbusAddressTyp:{LonFormat:"UCPTmbusAddressTyp",y_proxy_value:"AT_SECONDARY"},UCPTmbusPrimaryAddress:"0",UCPTmbusSecondaryAddress:"00000000"}},MBS_Fb_Cfg:{UCPTannotation:"VirtualFunctionBlock",UCPThidden:0},MBS_Dp_Cfg:{UCPTannotation:"Dp_In",UCPThidden:0,UCPTpollRate:"10.0",UCPTformatDescription:"RAW_HEX",UCPTlength:1,UCPTdirection:{LonFormat:"UCPTdirection",y_proxy_value:"DIR_IN"}},MOD_Channel_Cfg:{UCPTannotation:"RS485",UCPThidden:0,UCPTchannelType:{LonFormat:"UCPTchannelType",y_proxy_value:"CT_RS485_MASTER"},InterfaceOptions:{UCPTspeed:{LonFormat:"UCPTspeed",y_proxy_value:"MS_9600"},UCPTsize:{LonFormat:"UCPTsize",y_proxy_value:"CS_8"},UCPTparity:{LonFormat:"UCPTparity",y_proxy_value:"P_NONE"},UCPTstopBits:{LonFormat:"UCPTstopBits",y_proxy_value:"SB_1"}},UCPTserialMode:{LonFormat:"UCPTserialMode",y_proxy_value:"SM_RTU"}},MOD_Device_Cfg:{UCPTannotation:"App",UCPThidden:0,UCPTmaxElements:255,Address:{UCPTaddress:1,UCPTipAddress:"0.0.0.0"}},MOD_Fb_Cfg:{UCPTannotation:"VirtualFunctionBlock",UCPThidden:0},MOD_Dp_Cfg:{UCPTannotation:"Dp_In",UCPThidden:0,UCPTdirection:{LonFormat:"UCPTdirection",y_proxy_value:"DIR_IN"},UCPTunit:"",UCPTpollRate:0,UCPTbaseType:{LonFormat:"UCPTbaseType",y_proxy_value:"BT_UNSIGNED_LONG"},UCPTformatDescription:"#8000010128000000[4].UNVT_signed_quad",UCPTmodbusTable:{LonFormat:"UCPTmodbusTable",y_proxy_value:"MTT_HR"},UCPTstartAddress:0,UCPTstartBit:0,UCPTlength:32,UCPTdataOrdering:{LonFormat:"UCPTdataOrdering",y_proxy_value:"DO_BIG_ENDIAN"}},Network_Cfg:{UCPTannotation:"Lns",UCPThidden:0},Peer_Cfg:{UCPTannotation:"ilonhw",UCPThidden:0},Project_Cfg:{UCPTannotation:"Folder",UCPThidden:0},Ftp_Server_Cfg:{UCPTannotation:"FTP",UCPTport:"21",UCPTcredentials:[{UCPTuserName:"ilon",UCPTpassword:"ilon"}]},SmartServicePeer_Cfg:{UCPTannotation:"ilonhw",UCPThidden:0},Telnet_Server_Cfg:{UCPTannotation:"Telnet",UCPTport:"23",UCPTcredentials:[{UCPTuserName:"ilon",UCPTpassword:"ilon"}],UCPTdisplayName:"iLON100"},Web_Server_Cfg:{UCPTannotation:"iLonNS",UCPTport:"80",UCPTcredentials:{UCPTuserName:"ilon",UCPTpassword:"ilon"},UCPTprotocol:"http",UCPTsoapPath:"/WSDL/iLON100.WSDL",UCPTserviceNamespace:"http://wsdl.echelon.com/web_services_ns/ilon100/v4.0/message/"},WebBinderTargetService_Client_Cfg:{UCPTretryTime:120,UCPTvalueFormat:{LonFormat:"UCPTvalueFormat",y_proxy_value:"VF_DP_FORMAT"}},UFPTalarmGenerator_Cfg:{UCPTannotation:"8000010128000000[4].UFPTalarmGenerator",UCPThidden:0,UCPTalrmIhbD:0,UCPTalarmPriority:{LonFormat:"UCPTalarmPriority",y_proxy_value:"PR_LEVEL_1"},UCPTpollOnResetDelay:0,UCPTpollRate:0,UCPTalarm2Description:"",UCPTcompFunction:{LonFormat:"UCPTcompFunction",y_proxy_value:"FN_EQ"},UCPTalarmSetTimeD:0,UCPTalarmClrTimeD:0,UCPThighLimit2Offset:{LonFormat:"UNVT_float",y_proxy_value:""},UCPThighLimit1Offset:{LonFormat:"UNVT_float",y_proxy_value:""},UCPTlowLimit1Offset:{LonFormat:"UNVT_float",y_proxy_value:""},UCPTlowLimit2Offset:{LonFormat:"UNVT_float",y_proxy_value:""},SCPThystHigh2:{LonFormat:"UNVT_float",y_proxy_value:""},SCPThystHigh1:{LonFormat:"UNVT_float",y_proxy_value:""},SCPThystLow1:{LonFormat:"UNVT_float",y_proxy_value:""},SCPThystLow2:{LonFormat:"UNVT_float",y_proxy_value:""}},UFPTalarmNotifier_Cfg:{UCPTannotation:"8000010128000000[4].UFPTalarmNotifier",UCPThidden:0,SCPTdelayTime:0,UCPTsumLogSize:50,UCPThistLogSize:100,UCPTlogFormat:{LonFormat:"UCPTlogFormat",y_proxy_value:"LF_BINARY"},UCPTsumLogFileName:"???",UCPThistLogFileName:"???",UCPTemailAggregTime:0,ActiveAlarm:[{UCPTindex:0,UCPTlevel:255,UCPTalarmText:"Offline",UCPTalarmCondition:[{LonFormat:"UCPTalarmCondition",y_proxy_value:"AL_OFFLINE"}]},{UCPTindex:1,UCPTlevel:250,UCPTalarmText:"High Warning",UCPTalarmCondition:[{LonFormat:"UCPTalarmCondition",y_proxy_value:"AL_HIGH_LMT_ALM_1"}]},{UCPTindex:2,UCPTlevel:250,UCPTalarmText:"Low Warning",UCPTalarmCondition:[{LonFormat:"UCPTalarmCondition",y_proxy_value:"AL_LOW_LMT_ALM_1"}]},{UCPTindex:3,UCPTlevel:240,UCPTalarmText:"High Alarm",UCPTalarmCondition:[{LonFormat:"UCPTalarmCondition",y_proxy_value:"AL_HIGH_LMT_ALM_2"}]},{UCPTindex:4,UCPTlevel:240,UCPTalarmText:"Low Alarm",UCPTalarmCondition:[{LonFormat:"UCPTalarmCondition",y_proxy_value:"AL_LOW_LMT_ALM_2"}]},{UCPTindex:5,UCPTlevel:240,UCPTalarmText:"Alarm",UCPTalarmCondition:[{LonFormat:"UCPTalarmCondition",y_proxy_value:"AL_ALM_CONDITION"}]}],PassiveAlarm:[{UCPTindex:0,UCPTlevel:255,UCPTalarmText:"Online",UCPTalarmCondition:[{LonFormat:"UCPTalarmCondition",y_proxy_value:"AL_NO_CONDITION"}]}],AlarmDest:[{UCPTindex:0,ActiveDest:{UCPTminLevel:"255",UCPTmaxLevel:"0",UCPTnackDelay:"0"},PassiveDest:{UCPTminLevel:"255",UCPTmaxLevel:"0",UCPTnackDelay:"0"}}]},UFPTanalogFunctionBlock_Cfg:{UCPTannotation:"8000010128000000[4].UFPTanalogFunctionBlock",UCPThidden:0,UCPTcompFunction:{LonFormat:"UCPTcompFunction",y_proxy_value:"FN_NUL"},UCPTmajorityValue:100,UCPToutputFunction:{LonFormat:"UCPToutputFunction",y_proxy_value:"FN_INVALID"},SCPTminRnge:{LonFormat:"UNVT_float",y_proxy_value:"0"},SCPTmaxRnge:{LonFormat:"UNVT_float",y_proxy_value:"0"},UCPTcalculationInterval:0,UCPTcalculationMatrix:1,SCPTovrBehave:{LonFormat:"SCPTovrBehave",y_proxy_value:"OV_RETAIN"},SCPTovrValue:{LonFormat:"SCPTovrValue",y_proxy_value:""},UCPTpollOnResetDelay:0},UFPTcalendar_Cfg:{UCPTannotation:"8000010128000000[4].UFPTcalendar",UCPThidden:0,ScheduleEffectivePeriod:{StartDate:"2000-01-01",EndDate:"2037-12-31"}},UFPTdataLogger_Cfg:{UCPTannotation:"8000010128000000[4].UFPTdataLogger",UCPThidden:0,UCPTlogType:{LonFormat:"UCPTlogType",y_proxy_value:"LT_HISTORICAL"},UCPTlogSize:100,UCPTlogFormat:{LonFormat:"UCPTlogFormat",y_proxy_value:"LF_TEXT"},UCPTlogLevelAlarm:50,UCPTlogFileName:"???"},UFPTdigitalInput_Cfg:{UCPTannotation:"8000010128000000[4].UFPTdigitalInput",UCPThidden:0},UFPTdigitalOutput_Cfg:{UCPTannotation:"8000010128000000[4].UFPTdigitalOutput",UCPThidden:0},UFPTrealTimeClock_Cfg:{UCPTannotation:"8000010128000000[4].UFPTrealTimeClock",UCPThidden:0,UCPTdegLongitude:0,UCPTdegLatitude:0},UFPTscheduler_Cfg:{UCPTannotation:"8000010128000000[4].UFPTscheduler",UCPThidden:0,ScheduleEffectivePeriod:{StartDate:"2000-01-01",EndDate:"2037-12-31"},DayBased:[{UCPTindex:0,UCPTdescription:"daily",UCPTpriority:255,Event:[{UCPTindex:0,UCPTtime:"00:00",UCPTeventType:{LonFormat:"UCPTeventType",y_proxy_value:"ET_LOCK"}}],Weekdays:{UCPTsunday:0,UCPTmonday:1,UCPTtuesday:1,UCPTwednesday:1,UCPTthursday:1,UCPTfriday:1,UCPTsaturday:0}},{UCPTindex:1,UCPTdescription:"weekend",UCPTpriority:255,Event:[{UCPTindex:0,UCPTtime:"00:00",UCPTeventType:{LonFormat:"UCPTeventType",y_proxy_value:"ET_LOCK"}}],Weekdays:{UCPTsunday:1,UCPTmonday:0,UCPTtuesday:0,UCPTwednesday:0,UCPTthursday:0,UCPTfriday:0,UCPTsaturday:1}}]},UFPTnodeObject_Cfg:{UCPTannotation:"8000010128000000[4].UFPTnodeObject",UCPThidden:0},UFPTpulseCounter_Cfg:{UCPTannotation:"8000010128000000[4].UFPTpulseCounter",UCPThidden:0},UFPTtypeTranslator_Cfg:{UCPTannotation:"8000010128000000[4].UFPTtypeTranslator",UCPThidden:0,SCPTdelayTime:0},Virtual_Channel_Cfg:{UCPTannotation:"VirtualChannel",UCPThidden:0,UCPTchannelType:"Virtual"},Virtual_Device_Cfg:{UCPTannotation:"VirtualDevice",UCPThidden:0},Virtual_Dp_Cfg:{UCPTannotation:"VirtualDataPoint",UCPThidden:0,UCPTdirection:{LonFormat:"UCPTdirection",y_proxy_value:"DIR_IN"}},Virtual_Fb_Cfg:{UCPTannotation:"VirtualFunctionBlock",UCPThidden:0}};Echelon.SoapServerObject=elon.Class({constructor:function(a,c){if(typeof(a)=="string"){var b=a;var d=c}else{var b=elon.getSoapUrl(a.argObj,a.getWindow());var d=a}this.m_url=b;this.m_id=d;if(this.isIlon()||this.isAdmin()){this.m_syncPoll(b,d)}if((b==null)&&elon.elon.getVal("BoolItem","debugWebUi")()){alert("Undefined soap url!")}},extraClassInit:function(b){b.m_factory=Echelon.SoapFactoryObject.getInstance();var a=function(h){var f=h;var g=Echelon.WSDLSoapCalls[h].requestType;var e=function(l){var j=elon.elon.httpS(l.url||this.m_url);var m=Echelon.SoapServerObject.m_globals.soapQueue;var i=Echelon.SoapServerObject.m_globals.clearingSoapQueue;if(!this.m_queue){this.m_queue=Echelon.XmlHttp.Queue(j)}m[j]--;if(!l.elon_no_aggregation&&!elon.dom.getAttr(EchelonTop.document.body,"elon_no_aggregation")&&!l.isAggregate&&(this.m_queue.delaying(m[j]+1)||i[j])){this.m_delaySoapCall(f,l);if(m[j]){i[j]=true}else{if(i[j]){delete i[j];this.m_queue.callCbs()}}return}if(!Echelon.SoapServerObject.m_globals.time[this.m_url]){this.syncTime(l)}var k=this.m_toColl(l,g,arguments.caller);l=this.m_cpReqObj(l,{Item:k,method:f,callback:this.m_CbHandler(l,{Delete:1,Set:1,Write:1}[f]?k:null,f)});if({Set:1,InvokeCmd:1,Clear:1}[f]){l.unmanaged=true}if(this.isLnsProxy()){this.m_chkDB(l)}this.soapCall(l)};this.call=function(j){var i=elon.elon.httpS(j.url||this.m_url);var k=Echelon.SoapServerObject.m_globals.soapQueue;if(!k[i]){k[i]=0}k[i]++;elon.util.fireQuickCallback(e,this,j)}};var d={Clear:0,Delete:0,InvokeCmd:0,Get:0,Read:0,Set:0,Write:0,List:0};for(var c in d){b[c]=new a(c).call}b.m_topUrl=elon.getSoapUrl(elon.elon.getHrefParams(elon.window).args,elon.window)},"private":{m_cpReqObj:function(d,b){var a={url:this.m_url,id:this.m_id};for(var c in d){a[c]=d[c]}if(!a.translator&&(typeof(a.id)=="string")){a.translator=this.m_id}if(a.id=="persistent"){a.id={domObj:true}}if(a.id=="volatile"){a.id={domObj:false}}for(var c in b){a[c]=b[c]}return a},m_error:function(b,c,a){throw new Error(b+" in SoapServerObject."+c+". Called by:\n"+a)},m_toColl:function(g,f,b){var e=this.m_factory.get(f);var d=null;var a=this.m_toItemArr(g,g.reqType||false);if(e.Item){for(var c=0;c<a.length;c++){if(a[c].fault){delete a[c].fault}e.Item[c]=a[c]}if(a.length){e.Item.length=a.length}}d=g.xSelect;if(d){e.xSelect.set(d)}if(!(a.length||g.xSelect)){this.m_error("Item AND/OR xSelect required","m_toColl",b)}if(g.callback==null){this.m_error("Callback required","m_toColl",b)}return e},"nest:m_CbHandler":elon.Class({constructor:["m_reqObj","m_clearTainted","m_method"],closure:function(c,b,d){if((b==null)&&(this.m_reqObj.retType!=null)){b=this.m_chkRetTypes(c,b,d)}if(this.m_reqObj.m_retrieving){for(var a=0;a<this.m_reqObj.m_retrieving.length;a++){delete this.m_reqObj.m_retrieving[a].r_proxy_retrieving}}if(this.m_clearTainted){this.m_clearTaintedItems(this.m_clearTainted.Item)}if(c&&c.Item){if(this.m_stopDbPoll&&(this.m_method=="Delete")&&c.Item[0]&&this.parent.isLnsProxyItem({Item:c.Item[0]})&&!c.Item[0].UCPTname.get().match(/\//)){for(var a=0;a<c.Item.length;a++){this.m_stopDbPoll(c.Item[a].UCPTname.get())}}this.m_markIlon(c.Item);this.parent.m_factory.handleRedirects(c.Item,b,d)}if(this.m_reqObj.includeLocal){c=this.m_includeLocal(c)}if(d&&((this.m_reqObj.url==null)||(this.m_reqObj.url==this.parent.m_url))){Echelon.SoapServerObject.m_globals.header[this.parent.m_url]=d}this.m_reqObj.callback(c,b,d)},"private":{m_clearTaintedItems:function(d,b){var e={};this.parent.unsubmit({Item:d});for(var c=0;c<d.length;c++){if(d[c].r_proxy_tainted){delete d[c].r_proxy_tainted}if(d[c].r_proxy_fromScratch){delete d[c].r_proxy_fromScratch}if(d[c].r_proxy_silentDefault){delete d[c].r_proxy_silentDefault}if(d[c].m_proxy_clearRedirect){d[c].m_proxy_clearRedirect()}var a=d[c].r_proxy_url;if(d[c].r_proxy_type!="Item"){this.m_clearTaintedItems([this.parent.getItem({url:a,type:"Item",Item:d[c].UCPTname.get(),id:"volatile"})],true)}if(!b&&!e[a]&&Echelon.SoapPollerObject.instances[a]&&!this.m_reqObj.noSync){e[a]=true;Echelon.SoapPollerObject.instances[a].triggerPoll()}}},m_markIlon:function(a){for(var b=0;b<a.length;b++){if((this.m_method=="Get")&&!this.m_reqObj.returnMissing&&a[b].fault&&a[b].fault.faultcode&&{"14":1,"6":1}[a[b].fault.faultcode.get()]){this.parent.m_factory.delFromCache(a[b]);a.remove(b);b--}else{delete a[b].r_proxy_retrieving;a[b].r_proxy_fromIlon=true}}},m_chkRetTypes:function(f,d,g){d=null;for(var c=0;c<f.Item.length;c++){if((f.Item[c].r_proxy_type!=this.m_reqObj.retType)&&(!this.m_reqObj.acceptInherited||!(elon.SoapTemplateObject.isInherited({type:f.Item[c].r_proxy_type},this.m_reqObj.retType)))&&(!this.m_reqObj.acceptBase||!(elon.SoapTemplateObject.isInherited({type:this.m_reqObj.retType},f.Item[c].r_proxy_type)))){if((this.m_method=="Get")&&f.Item[c].fault&&f.Item[c].fault.faultcode&&{"14":1,"6":1}[f.Item[c].fault.faultcode.get()]){var e=this.parent.m_factory.List(f.Item[c].r_proxy_url,'//Item[UCPTname="'+f.Item[c].UCPTname.get()+'"]');for(var b=0;b<e.length;b++){if(e[b].r_proxy_type==this.m_reqObj.retType){delete e[b].r_proxy_retrieving}}this.parent.m_factory.delFromCache(f.Item[c])}f.Item.remove(c);c--;d=d||elon.Error.getInstance(elon.ErrorTable.getInstance().ERR_WSCLI_OBJECT_TYPE_NOT_FOUND)}else{if((f.Item[c].r_proxy_type!=this.m_reqObj.retType)&&((this.m_reqObj.acceptInherited&&elon.SoapTemplateObject.isInherited({type:f.Item[c].r_proxy_type},this.m_reqObj.retType))||(this.m_reqObj.acceptBase&&elon.SoapTemplateObject.isInherited({type:this.m_reqObj.retType},f.Item[c].r_proxy_type)))){var a=this.parent.m_get(this.m_reqObj.retType,f.Item[c].UCPTname.get(),this.m_reqObj);if(a.m_proxy_subscribers){for(var b=0;b<a.m_proxy_subscribers.length;b++){if((this.m_reqObj.acceptInherited&&(a.m_proxy_subscribers[c][2]=="children"))||(this.m_reqObj.acceptBase&&(a.m_proxy_subscribers[c][2]=="ancestors"))){a.m_proxy_subscribers[c][0](f.Item[c],d,g)}}}}}}return d},m_includeLocal:function(c){var b=this.parent.m_factory[this.m_method](this.m_reqObj.url||this.parent.m_url,this.m_reqObj.xSelect);if(!c){c=this.parent.getItem({type:Echelon.WSDLSoapCalls[this.m_method].responseType})}for(var a=0;a<b.length;a++){if(b[a].r_proxy_fromScratch){c.Item.push(b[a])}}return c}}}),m_delaySoapCall:function(e,c){var d=this;var b=elon.elon.httpS(c.url||this.m_url);var a=Echelon.SoapServerObject.m_globals.delayedSoapCalls;if(!a[b]){a[b]=[]}if(!a[b].length){this.m_queue.addCB(this.m_DelayedSoapCall(b))}a[b].push({method:e,reqObj:c,sso:this})},m_DelayedSoapCall:elon.Class({constructor:function(a){this.m_delayed=Echelon.SoapServerObject.m_globals.delayedSoapCalls[a]},closure:function(){var b=this.m_delayed;var c=b.shift();this.m_sso=c.sso;if(c.reqObj.xSelect&&c.reqObj.xSelect.match(/@xsi:type="UFPT(dataLogger|alarmNotifier|scheduler)_Data"/)){this.m_requeue();return this.m_sso[c.method](c.reqObj)}if(!c.reqObj.Item){var a=c.reqObj.xSelect&&c.reqObj.xSelect.match(this.m_aliasExp);if(a){this.m_aggregateAlias(c,b,a)}else{this.m_requeue();return this.m_sso[c.method](c.reqObj)}}else{this.m_aggregateItems(c,b)}},"private":{m_aliasExp:/\/\/Item\[@xsi:type=(["'])([^'"]+)\1\]\[UCPTaliasName=(['"])([^'"]+)\3\]/,m_requeue:function(){if(this.m_delayed.length){this.m_sso.m_queue.addCB(this.m_elonClassClosure)}},m_aggregateAlias:function(h,f,e){var g='//Item[@xsi:type="'+e[2]+'"][UCPTaliasName="'+e[4]+'"';var c={};c[e[4]]=[h.reqObj];for(var b=0;b<f.length;b++){var a=this.m_aliasAggregatable(e[2],h,f[b]);if(a){g+=' or UCPTaliasName="'+a[4]+'"';if(c[a[4]]){c[a[4]].push(f[b].reqObj)}else{c[a[4]]=[f[b].reqObj]}f.splice(b,1);b--}}this.m_requeue();this.m_sso[h.method](this.m_sso.m_cpReqObj(h.reqObj,{callback:this.m_DistributeAliasCB(c),xSelect:g+"]"}))},m_aggregateItems:function(k,h){if({Get:1,Read:1}[k.method]){var f=k.reqType||false}else{f=k.reqObj.reqType||this.m_getType(k.reqObj)||false}var g=this.m_sso.m_toItemArr(k.reqObj,f);var e=[k.reqObj];for(var c=0;c<h.length;c++){if(this.m_aggregatable(k,h[c])){var a=this.m_sso.m_toItemArr(h[c].reqObj,f);e.push(h[c].reqObj);for(var b=0;b<a.length;b++){g.push(a[b])}h.splice(c,1);c--}}this.m_requeue();this.m_sso[k.method](this.m_sso.m_cpReqObj(k.reqObj,{callback:this.m_DistributeCB(e),Item:g,isAggregate:true}))},m_aliasAggregatable:function(c,d,a){var b=a.reqObj.xSelect&&a.reqObj.xSelect.match(this.m_aliasExp);if(b&&(c==b[2])&&(d.reqObj.unmanaged==a.reqObj.unmanaged)){return b}},m_getType:function(a){return a.type||a.Item.r_proxy_type||a.Item[0].r_proxy_type},m_aggregatable:function(b,a){if(b.reqObj.Item&&a.reqObj.Item&&(b.reqObj.unmanaged==a.reqObj.unmanaged)&&(this.m_getType(b.reqObj)==this.m_getType(a.reqObj))&&(b.reqObj.xSelect==a.reqObj.xSelect)){return true}},"nest:m_DistributeCB":elon.Class({constructor:["m_aggregate"],closure:function(f,d,h){if(!f){for(var g=0;g<this.m_aggregate.length;g++){this.m_aggregate[g].callback(f,d,h)}return}var l={};var m=[];for(var g=0;g<f.Item.length;g++){var b=f.Item[g].UCPTname.get();m.push(b);if(!l[b]){l[b]=[f.Item[g]]}else{l[b].push(f.Item[g])}}for(var g=0;g<this.m_aggregate.length;g++){var a=this.parent.m_sso.m_factory.get(f.r_proxy_type);var n=this.parent.m_sso.m_toItemArr(this.m_aggregate[g]);for(var e=0;e<n.length;e++){var o=l[n[e].UCPTname.get()];if(o){for(var c=0;c<o.length;c++){a.Item.push(o[c])}}}this.m_aggregate[g].callback(a,d,h)}}}),"nest:m_DistributeAliasCB":elon.Class({constructor:["m_aggregate"],closure:function(e,c,g){if(!e){for(var f in this.m_aggregate){this.m_aggregate[f].callback(e,c,g)}return}var h={};for(var f=0;f<e.Item.length;f++){var b=e.Item[f].UCPTaliasName.get();if(!h[b]){h[b]=[e.Item[f]]}else{h[b].push(e.Item[f])}}for(var f in this.m_aggregate){var a=this.parent.m_sso.m_factory.get(e.r_proxy_type);var k=h[f];if(k){for(var d=0;d<k.length;d++){a.Item.push(k[d])}}for(var d=0;d<this.m_aggregate[f].length;d++){this.m_aggregate[f][d].callback(a,c,g)}}}})}}),m_applyReqObj:function(a,b){if(a.fromScratch=="test"){if(!b.r_proxy_fromIlon){b.r_proxy_fromScratch=true}}else{if(a.fromScratch){b.r_proxy_fromScratch=true}}if(a.noSubmit){b.m_proxy_noSubmit=true}if(a.mute){b.y_proxy_mute(a.id)}if(a.clear){b.y_proxy_clear(a.id)}if(a.unmute){b.y_proxy_unmute(a.id)}return b},m_get:function(d,b,c){if(c&&(c.unmanaged||((d=="Item")&&(c.type!="Item")))){var a;a=(new (Echelon.SoapFactoryObject.getInstance().getConstructor(d))()).m_proxy_initAll(b);a.r_proxy_url=c.url||this.m_url;return this.m_applyReqObj(c,a)}else{c=this.m_cpReqObj(c,elon.filter.webDp(b)?{url:this.m_topUrl}:null);return this.m_applyReqObj(c,this.m_factory.get(d,c.url,b,null,c.id))}},m_toItemArr:function(e,d){var a=[];var c=null;if(d==null){d=e.type}if(d){d=this.preprocessType(d)}c=e.Item;if(c){if(typeof(c)=="string"){a.push(this.m_get(d||"Item",c,e))}else{if(c.r_proxy_type!=null){if(!d||(c.r_proxy_type==d)){if(c.length!=null){for(var b=0;b<c.length;b++){a.push(this.m_applyReqObj(e,c[b]))}}else{a.push(this.m_applyReqObj(e,c))}}else{if(c.length!=null){for(var b=0;b<c.length;b++){a.push(this.m_get(d,c[b].UCPTname.get(),e))}}else{a.push(this.m_get(d,c.UCPTname.get(),e))}}}else{for(var b=0;b<c.length;b++){if(typeof(c[b])=="string"){a.push(this.m_get(d||"Item",c[b],e))}else{if(!d||(c[b].r_proxy_type==d)){a.push(this.m_applyReqObj(e,c[b]))}else{a.push(this.m_get(d,c[b].UCPTname.get(),e))}}}}}}return a},m_toItem:function(c,b){var a=this.m_toItemArr(c);if(a.length!=1){this.m_error("Expected one and only one Item","m_toItem",b)}return a[0]},m_subscriptionId:function(a){if(a.subscriptionId&&!a.subscriptionId.domObj){a.subscriptionId.domObj=(a.id||this.m_id).domObj}return a.subscriptionId||a.id},"callback:m_syncTimeCB":function(f,d,g){if(!g){return}var h=new Date();var c=Echelon.SoapServerObject.m_globals.time;var b=c[this.m_url].m_ilonSyncStart;if(b==null){return}var i=(h.getTime()-b)/2;h.setTime(h.getTime()-i);delete c[this.m_url].m_ilonSyncStart;c[this.m_url].m_ilonTimeOffset=g.UCPTtimeStamp.getTime()-h.getTime();if(Math.abs(c[this.m_url].m_ilonTimeOffset/Echelon.DateObject.ONE_HOUR)>=1){var j=Echelon.DateTimeObject.getInstance(h.getTime());j.setTimezoneOffset(-h.getTimezoneOffset());var k="Date: %f-%2M-%2d Time: %2h:%2m:%2s Zone: GMT%+%o2h:%o2m";var e="Date: %uf-%u2M-%u2d Time: %u2h:%u2m:%u2s";var a={pcTime:j.toFormattedString(k),ilonTime:g.UCPTtimeStamp.toFormattedString(k),UtcPcTime:j.toFormattedString(e),UtcIlonTime:g.UCPTtimeStamp.toFormattedString(e)};alert(elon.Error.getInstance(elon.ErrorTable.getInstance().ERR_WSSRV_ILON_CLOCK_MISMATCH,a).faultString)}},m_pingAndRelaunch:function(){this.List({xSelect:'//Item[starts-with(UCPTname,"this/is/just/a/ping")]',callback:this.m_pingAndRelaunchCB,noErrMsg:true,noRetry:true});if(!this.m_abortPing){elon.UtilObject.getInstance().fireDelayedFunction(this.m_pingAndRelaunch,10000,this)}else{delete this.m_abortPing}},"callback:m_pingAndRelaunchCB":function(c,b,d){if(!b){if(this.m_origUrl==elon.elon.getTopLevelSSO().getUrl()){var a=elon.elon.httpS(this.getIp()+((this.getPort()==80)?"":(":"+this.getPort()))+elon.window.location.pathname);if(a==elon.window.location.href){elon.window.location.reload(true)}else{elon.elon.followLink({elon_url:a},"")}elon.elon.setInfMsg("Reloading ...")}else{elon.elon.setInfMsg("SmartServer at "+this.getIp()+" rebooted and is accessible again");this.m_abortPing=true}}else{elon.elon.setInfMsg("Please wait, SmartServer is still rebooting. "+new Date().toLocaleString())}},m_syncPoll:function(a,b){if(elon.elon.getTopLevelSSO()&&elon.elon.getTopLevelSSO().isAdmin()&&a&&a.match(/\/WSDL\/iLON100.WSDL$/)){return}if(!Echelon.SoapServerObject.m_globals.polls[a]&&!a.match(/0\.0\.0\.0/)){Echelon.SoapServerObject.m_globals.polls[a]=[];if(this.isIlon()||this.isAdmin()){elon.util.fireDelayedFunction(this.poll,5000,this,{xSelect:"//Item",emptyFetch:true,List:true,callback:this.m_pollCB,maxAge:"sync",translator:b,id:"persistent",unmanaged:true})}}},"callback:m_pollCB":function(c,a,f){this.m_factory.sync(c,a,f,this.getUrl());if(Echelon.SoapServerObject.m_globals.polls[this.m_url]){for(var b=0;b<Echelon.SoapServerObject.m_globals.polls[this.m_url].length;b++){try{Echelon.SoapServerObject.m_globals.polls[this.m_url][b](c,a,f)}catch(d){Echelon.SoapServerObject.m_globals.polls[this.m_url].splice(b,1);b--}}}},"nest:m_CpCB":elon.Class({constructor:["m_reqObj"],closure:function(c,b,e){if(this.m_reqObj.returnArray&&c){var d=this.parent.m_cpArr(this.m_reqObj,c,"unknown");if(this.m_reqObj.callback){this.m_reqObj.callback(d,b)}}else{if(c){this.parent.m_cpHelper(this.m_reqObj,c,"unknown")}else{if(this.m_reqObj.callback){if(typeof(this.m_reqObj.Item)=="string"){this.m_reqObj.callback(null,b,e)}else{for(var a=0;a<this.m_reqObj.Item.length;a++){this.m_reqObj.callback(null,b,e)}}}}}}}),m_primeKey:{LON_Fb_Cfg:"UCPTfbIndex",LON_Dp_Cfg:"UCPTnvIndex",LON_Cp_Dp_Cfg:"UCPTnvIndex"},m_cpObj:function(e,c,b){var f=e.Item?((typeof(e.Item)=="function")?e.Item(c.UCPTname.get()):e.Item):c.UCPTname.get();var d=e.type;if(!d||(d=="generalFb")){d=c.r_proxy_type}e=this.m_cpReqObj(e,{type:d,Item:f});var g=this.m_toItem(e,b||"unknown");g.y_proxy_copy(c,e.id);if(e.noPrimeKey){var a=this.m_primeKey[g.r_proxy_type]||"UCPThandle";if(g[a]){g[a].set(null)}if(g.r_proxy_type=="LON_Cp_Dp_Cfg"){g.UCPTnvIndex.set(null)}}if(e.postProcess){e.postProcess(g)}if(e.mute){this.unmute({Item:g})}return g},m_cpHelper:function(a,b){a=this.m_cpReqObj(a);var c=this.m_cpObj(this.m_cpReqObj(a.copy,{type:a.copy.type||b.r_proxy_type}),b);if(a.callback){a.callback(c)}},m_cpArr:function(d,a,b){var e=[];for(var c=0;c<a.length;c++){e.push(this.m_cpObj(d.copy,a[c],b))}return e},m_cpColl:function(b,a){var c=this.m_cpArr(b,this.m_toItemArr(b),a);if(b.callback){b.callback(c)}return c},"nest:m_GetRemocalSubscribeCB":elon.Class({constructor:["m_reqObj"],closure:function(c,a,d){if(c&&c.Item.length){for(var b=0;b<c.Item.length;b++){if(this.m_reqObj.type==c.Item[b].r_proxy_type){continue}if(this.m_reqObj.type&&(((this.m_reqObj.type!="Fb_Cfg")&&(c.Item[b].r_proxy_type=="Fb_Cfg"))||this.m_reqObj.acceptDefault)){if((this.m_reqObj.type!="Fb_Cfg")&&(c.Item[b].r_proxy_type=="Fb_Cfg")){this.parent.List({xSelect:'//Item[UCPTname="'+c.Item[b].UCPTname.get()+'"]',callback:this.m_ListCB(c.Item[b].UCPTname.get())})}else{this.m_reqObj.callback(this.parent.getDefaultItem({type:this.m_reqObj.type,Item:c.Item[b]}),a,d)}}}}else{if(this.m_reqObj.acceptDefault){this.m_reqObj.callback(this.parent.getDefaultItem({type:this.m_reqObj.type,Item:this.m_reqObj.Item}),a,d)}else{this.m_reqObj.callback(null,a,d)}}},"private":{"nest:m_ListCB":elon.Class({constructor:["m_name"],closure:function(e,a,f){var d;if(e){for(var c=0;c<e.Item.length;c++){var b=elon.filter.annotationType(e.Item[c].UCPTannotation.get());if({LON:1,MBS:1,MOD:1,VIRTUAL:1}[b.match(/^[^_]*/)[0]]){d=b;break}}}if(d){this.parent.parent.getRemocalItem({type:d,Item:this.m_name,callback:this.m_getCB})}else{this.m_returnDefault(null,a,f)}},"private":{m_returnDefault:function(b,a,c){elon.elon.setErrMsg(b||("Unable to determine function block type (no driver existing for this fb!)"));this.parent.m_reqObj.callback(this.parent.parent.getDefaultItem({type:this.parent.m_reqObj.type,Item:this.m_name}),a,c)},"callback:m_getCB":function(d,h,f){if(!d){this.m_returnDefault(null,h,f);return}var g=d.UCPTfptKey&&d.UCPTfptKey.get();if(g){g=this.parent.parent.preprocessType(g)}var a=d.UCPTname.get();var b=d.r_proxy_url;if(!g||!elon.WSDLComplexTypes[g]||(g!=this.parent.m_reqObj.type)){this.m_returnDefault("Driver does not match the requested Function Block type, please adjust driver or abort editing this Function Block",h,f);return}var k=this.parent.parent.getItem({type:g,Item:a,url:b,id:this.parent.m_reqObj.id});if(!k.r_proxy_fromScratch&&!k.r_proxy_fromIlon){k=this.parent.parent.getDefaultItem({type:g,Item:a,url:b,mute:true});for(var e=0;e<d.DataPoint.length;e++){var l=false;for(var c=0;c<k.DataPoint.length;c++){if(d.DataPoint[e].UCPTname.get()==k.DataPoint[c].UCPTname.get()){l=true;break}}if(!l){k.DataPoint.push(d.DataPoint[e])}}}this.parent.parent.unmute({Item:k});k.y_proxy_callSubscribers(h,f)}}})}}),"nest:m_GetRemocalSubscribeSingularCB":elon.Class({constructor:["m_reqObj"],closure:function(a){if(!a.cancelled||!a.cancelled.get()||this.m_reqObj.callOnCancel){this.m_reqObj.callback(a)}elon.UtilObject.getInstance().fireQuickCallback(this.parent.unsubscribe,this.parent,{Item:a,callback:this.m_elonClassClosure,id:this.parent.m_subscriptionId(this.m_reqObj)})}}),"nest:m_GetRemocalSyncCB":elon.Class({constructor:["m_reqObj"],closure:function(b,a,c){this.m_reqObj.callback({Item:[b]},a,c);elon.UtilObject.getInstance().fireQuickCallback(this.parent.unsubscribe,this.parent,{Item:b,callback:this.m_elonClassClosure,id:this.parent.m_subscriptionId(this.m_reqObj)})}}),m_GetRemocalCB:elon.Class({closure:function(c,a,d){if(c&&c.Item.length){for(var b=0;b<c.Item.length;b++){this.m_callback(c.Item[b])}}else{this.m_callback(null,a,d)}},constructor:["m_callback"]}),m_GetRemocalArrayCB:elon.Class({constructor:function(c,a,b){this.m_callback=c;this.m_len=a;this.m_expectedSoapLength=b?1:0;this.m_missing=0;this.m_item=[];this.m_cache=Echelon.SoapObjCache.getInstance()},"public":{"callback:callback":function(d,a,e){var c=0;if(d&&d.Item.length){for(var b=0;b<d.Item.length;b++){if(!this.m_cache.cached(d.Item[b])){this.m_cache.add(d.Item[b]);this.m_item.push(d.Item[b]);c++}}}if(a||e){this.m_missing+=this.m_expectedSoapLength-c}if((this.m_item.length+this.m_missing)==this.m_len){this.m_callback(this.m_item,this.m_missing)}},expectSoapLength:function(a){if(!this.m_expectedSoapLength){this.m_expectedSoapLength=a}}}}),m_GetRemocalXselect:elon.Class({constructor:function(b,a){this.m_reqObj=b;this.parent=a;this.parent.m_genericSoapCall(this.parent.m_cpReqObj(b,{callback:this.m_getCB,noErrMsg:true,xSelect:b.xSelect+'[@xsi:type="'+b.type+'"]'}),b.type)},"private":{"callback:m_getCB":function(c,a,d){if(c&&c.Item.length){for(var b=0;b<c.Item.length;b++){if(c.Item[b].UCPTname.get().search(this.TMP_SUFFIX)==-1){this.m_callBack(c.Item[b]);return}}}this.parent.Get(this.parent.m_cpReqObj(this.m_reqObj,{callback:this.m_listCB,noErrMsg:true,xSelect:this.m_reqObj.xSelect+'[@xsi:type="LON_Fb_Cfg"][UCPTfptKey="#8000010128000000[4].'+this.m_reqObj.type.match(new RegExp("(.*)_Cfg"))[1]+'"]'}))},"callback:m_listCB":function(c,b,d){if(c&&c.Item.length){var a=c.Item[0].UCPTname.get()}else{var a=this.m_reqObj.type.match(new RegExp("(.*)_Cfg"))[1]}this.m_callBack(this.parent.getDefaultItem({type:this.m_reqObj.type,Item:a,mute:true}))},m_callBack:function(a){this.parent.unmute({Item:a});if(this.m_reqObj.subscribe){a.y_proxy_subscribe(this.m_reqObj.callback,this.parent.m_subscriptionId(this.m_reqObj))}this.m_reqObj.callback(a)}}}),m_requiresXselect:{Dp_Ref:true,TemplateManager_Cfg:true,UFPTtypeTranslator_Rule_Cfg:true},m_genericSoapCall:function(d,c){if(c=="Item"){var a=this.m_toItemArr(d);for(var b=0;b<a.length;b++){this.List(this.m_cpReqObj(d,{xSelect:'//Item[UCPTname="'+a[b].UCPTname.get()+'"]'}))}}else{if(c=="generalFb"){var a=this.m_toItemArr(d);for(var b=0;b<a.length;b++){this.Get(this.m_cpReqObj(d,{type:"Fb_Cfg",Item:a[b],acceptInherited:true}))}}else{if(!d.xSelect&&(this.m_requiresXselect[c]||elon.filter.driverType(c))){d.xSelect='//Item[@xsi:type="'+c+'"]'}this[this.getSoapOp(c)](d)}}},m_xSelPathExp:new RegExp("\\[starts-with\\(UCPTname, *('|\")([^\\/]+)[^\\1]*\\1\\)]"),m_xSelTemplate:new RegExp("\\[@xsi:type=('|\")TemplateManager"),m_chkDB:function(b){if(b.xSelect&&b.xSelect.match(this.m_xSelTemplate)){return}var a;var c=b.xSelect&&b.xSelect.match(this.m_xSelPathExp);if(c){a=c[2]}else{if(b.Item.Item&&b.Item.Item.length&&(b.Item.Item[0].r_proxy_type=="LON_Interface_Cfg")){return}else{if(b.Item.Item&&b.Item.Item.length){a=b.Item.Item[0].UCPTname.get().match(/^[^\/]+/)[0]}}}if(a&&(a!=Echelon.SoapServerObject.m_globals.lns.db[this.m_url])){this.m_updateLnsDB(a)}},m_stopDbPoll:function(b){var c=Echelon.SoapServerObject.m_globals.lns;var a=c.db[this.m_url];if(a&&(!b||(b==a))){if(!c.lastUpdate[this.m_url]){c.lastUpdate[this.m_url]={}}c.lastUpdate[this.m_url][a]=Echelon.SoapPollerObject.getInstance(this.m_url,this).del('//Item[starts-with(UCPTname,"'+a+'/")]')}},m_updateLnsDB:function(a){if(elon.elon.getTopLevelSSO()&&elon.elon.getTopLevelSSO().isAdmin()){return}var d=Echelon.SoapServerObject.m_globals.lns;this.m_stopDbPoll();var c={xSelect:'//Item[starts-with(UCPTname,"'+a+'/")]',List:true,unmanaged:true,callback:this.m_pollCB,maxAge:"sync",id:"persistent"};if(d.lastUpdate[this.m_url]&&d.lastUpdate[this.m_url][a]){c.fetchLastUpdate=d.lastUpdate[this.m_url][a]}else{c.emptyFetch=true}d.db[this.m_url]=a;this.poll(c);for(var b in d.changeCB[this.m_url]){d.changeCB[this.m_url][b](a)}},"nest:m_SubmitPopupCB":elon.Class({constructor:["m_cb","m_postSubmitCB"],closure:function(a){if(a.value.get()){this.parent.submit(this.m_postSubmitCB)}else{this.parent.unsubmitAll();if(this.m_postSubmitCB){this.m_postSubmitCB()}}if(this.m_cb){this.m_cb(a.value.get())}}}),"nest:m_GetLonNetsCB":elon.Class({constructor:["m_reqObj"],closure:function(g){if(!g){return this.m_result(null)}this.m_offNet=[];for(var e=0;e<g.length;e++){var f=(g[e].UCPTmgmtMode.get()=="LCA_OFFNET")&&!this.m_reqObj.ignoreOffnet;var b=g[e].UCPTlnsSync.get()=="SYNC_STANDALONE";var a=typeof(g[e].LnsDatabase)!="function";if(f&&b){this.m_msg("Inf","The network is OffNet. Network management commands will be queued until it is set online","standAloneOffNet")}if((!b&&f)||((!b||this.m_reqObj.checkSync)&&!a)){this.m_offNet.push(g[e].UCPTname.get())}if((g[e].UCPTlnsSync.get()=="SYNC_LNS")&&a){elon.ConnectionManagerObject.getInstance(g[e].r_proxy_url).getLnsFromNet(g[e],this.m_LnsCB(g[e]))}}if(this.m_offNet.length&&!this.m_reqObj.noNav){var d="#Web/global/ssoPromptNavNet";var c={elon_symbol:elon.filter.qualifierToMediumIcon("App"),elon_title:this.parent.m_id.translate("NAVIGATE_NET_TITLE"),elon_msg:this.parent.m_id.translate("NAVIGATE_NET_CMD"),elon_name:d};this.parent.m_id.f_createPopup({elon_url:elon.htmUrl("Confirm.htm"),elon_args_obj:c});this.parent.subscribe({type:"BoolItem",Item:d,callback:this.m_confirmCB,noInitialCallback:true,mute:true,clear:true,unmute:true,singular:true});this.m_result(false)}else{this.m_result(this.m_offNet.length==0)}},"private":{"nest:m_LnsCB":elon.Class({constructor:["m_ilonNet"],closure:function(a){this.parent.parent.getRemocalItem({url:a,type:"LON_Network_Cfg",id:"volatile",Item:this.m_ilonNet.LnsDatabase.UCPTname.get(),callback:this.m_lnsDbCB})},"private":{"callback:m_lnsDbCB":function(a){if(!a){return this.parent.m_msg("Err",'The LNS database "'+this.m_ilonNet.UCPTname.get()+'" is unreachable. All network commands and synchronizing from the according iLON may fail.',"dbUnreachable")}if((this.m_ilonNet.UCPTitemStatus.get()!="IS_NOTSYNCED")&&!a.y_proxy_equals(this.m_ilonNet,{UCPTlastUpdate:true,UCPTdescription:true,Domain:true,"LnsDatabase.UCPTservicePath":true})){var b=this.parent.parent.getItem({type:"LON_Network_Command_Invoke",Item:this.m_ilonNet.UCPTname.get(),unmanaged:true,"volatile":true});b.Command.set("Syncronize");b.UCPTannotation.set('action="Sync";sync="restart"');this.parent.parent.InvokeCmd({Item:b,callback:function(){}})}if(a.UCPTlnsNetworkInterface.get()==null){this.parent.m_msg("Warn",'SmartServer network"'+a.UCPTname.get()+'" is set to sync with LNS but has no network interface assigned. Syncing will be one way!',"oneWaySync")}}}}),m_msg:function(b,c,a){if(!Echelon.SoapServerObject.m_globals.msgPrinted[a]){Echelon.SoapServerObject.m_globals.msgPrinted[a]=true;elon.elon["set"+b+"Msg"](c)}},"callback:m_confirmCB":function(d){if(!d.value.get()){return}var c=this.parent.getItem({type:"DpTree_Data",Item:"#Web/global/tree"});c.Item.clear();for(var a=0;a<this.m_offNet.length;a++){c.Item.push(this.parent.getItem({Item:this.m_offNet[a]}))}var b=this.parent.m_toItemArr(this.m_reqObj)[0];this.parent.m_id.f_followLink({elon_url:(this.parent.m_id.argObj.elon_system_dir||"")+"LON_Network_Cfg.htm",elon_args_obj:{elon_item:this.m_offNet[0],elon_name:this.m_offNet[0],elon_soap_url:b.r_proxy_url,elon_lang:this.parent.m_id.argObj.elon_lang,elon_system_dir:this.parent.m_id.argObj.elon_system_dir||""},elon_target:"appFrame"})},m_result:function(a){if(this.m_reqObj.callback){this.m_reqObj.callback(a)}}}}),"nest:m_ApplyDpTemplates":elon.Class({constructor:function(a){this.m_callback=a.callback;this.m_formatDesc=a.formatDesc},closure:function(f){this.m_driver={};var c={};var e=[];var b=[];for(var a=0;a<f.length;a++){if(f[a].UCPTformatDescription){var d=f[a].UCPTformatDescription.get()}else{var d=this.m_formatDesc}if(!c[d]){c[d]=true;e.push(d);b.push("/root/config/template/lonworks/Dp/"+d+".xml")}this.m_driver[f[a].UCPTname.get()]=f[a]}var g=elon.ReadyManager.getInstance();g.readyCB(["template","ressource","cfg"],this.m_ready);this.parent.getRemocalItem({type:"Dp_Cfg",Item:f,callback:g.createSimpleCB("cfg"),returnArray:true,id:"volatile"});this.parent.Get({xSelect:'//Item[@xsi:type="TemplateManager_Cfg"][UCPTfileType="TEMPLATE"][UCPTitemType="Dp_Cfg"]',Item:b,callback:g.createSimpleCB("template"),id:"volatile"});this.parent.Get({xSelect:'//Item[@xsi:type="TemplateManager_Cfg"][UCPTformatType="NVT"]',Item:e,callback:g.createSimpleCB("ressource"),id:"volatile"})},"private":{"callback:m_ready":function(e){if(!e.cfg.length){elon.elon.setErrMsg("Failed to adjust basetype and units for a data point, you should submit before editing further.");return this.m_callback()}var a={};for(var c=0;c<e.cfg.length;c++){var d=e.cfg[c].UCPTformatDescription.get();if(!a[d]){a[d]=[]}a[d].push(e.cfg[c])}var b={};if(e.template){for(var c=0;c<e.template.Item.length;c++){if(e.template.Item[c].EmbeddedItemColl&&e.template.Item[c].EmbeddedItemColl.Item&&e.template.Item[c].EmbeddedItemColl.Item.length){b[e.template.Item[c].EmbeddedItemColl.Item[0].UCPTname.get()]=e.template.Item[c].EmbeddedItemColl.Item[0]}}}var f={};if(e.ressource){for(var c=0;c<e.ressource.Item.length;c++){f[e.ressource.Item[c].UCPTname.get()]=e.ressource.Item[c]}}for(var c in a){this.m_apply(b[c],f[c],a[c])}this.m_callback()},m_apply:function(f,h,b){var g=[];if(!h){if(b[0].UCPTformatDescription.get()!="RAW_HEX"){elon.elon.setErrMsg('Failed to determine basetype and units for "'+b[0].UCPTformatDescription.get()+'", you should submit before editing further.')}var c="BT_UNKNOWN"}else{if(h.UCPTunit.length){g.push(h.UCPTunit[0].get())}if(typeof(h.struct_)!="function"){for(var e=0;e<h.struct_.Member.length;e++){if(h.struct_.Member[e].UCPTunit.length){g.push({field:h.struct_.Member[e].UCPTmemberName.get(),y_proxy_value:h.struct_.Member[e].UCPTunit[0].get()})}}}var c=this.m_bt(h);for(var e in {enum_:0,float_:0,scalar_:0,bitfield_:0}){if(typeof(h[e])!="function"){var d=h[e].UCPTminValue.get();var a=h[e].UCPTmaxValue.get()}}}for(var e=0;e<b.length;e++){if(f){b[e].y_proxy_copy(f,null,true)}if(!b[e].UCPTunit.length){b[e].UCPTunit.m_proxy_convertFromSimple(g)}if(c&&(b[e].UCPTbaseType.get()==null)){b[e].UCPTbaseType.set(c);b[e].UCPTbaseType.LonFormat.set("UCPTbaseType")}if(d&&(b[e].UCPTminValue.get()==null)){b[e].UCPTminValue.set(d);b[e].UCPTminValue.LonFormat.set(b[e].UCPTformatDescription.get())}if(a&&(b[e].UCPTmaxValue.get()==null)){b[e].UCPTmaxValue.set(a);b[e].UCPTmaxValue.LonFormat.set(b[e].UCPTformatDescription.get())}b[e].UCPTannotation.set(this.m_driver[b[e].UCPTname.get()].UCPTannotation.get());b[e].UCPTdirection.set(this.m_driver[b[e].UCPTname.get()].UCPTdirection.get());b[e].UCPTdirection.LonFormat.set("UCPTdirection")}},m_bt:function(a){if(typeof(a.enum_)!="function"){return"BT_ENUM"}else{if(typeof(a.float_)!="function"){return a.float_.UCPTbaseType.get()}else{if(typeof(a.struct_)!="function"){return"BT_STRUCT"}else{if(typeof(a.union_)!="function"){return"BT_UNION"}else{if(typeof(a.scalar_)!="function"){return a.scalar_.UCPTbaseType.get()}else{if(typeof(a.bitfield_)!="function"){return"BT_BITFIELD"}else{return"BT_UNKNOWN"}}}}}}}}})},"public":{syncTime:function(){if(!this.isIlon()){return Echelon.SoapServerObject.m_globals.time[this.m_url]={m_ilonTimeOffset:0}}Echelon.SoapServerObject.m_globals.time[this.m_url]={m_ilonSyncStart:new Date().getTime()};elon.ConnectionManagerObject.getInstance(this.m_url).readInfo("TIME",this.m_syncTimeCB)},ilonTime:function(){if(Echelon.SoapServerObject.m_globals.time[this.m_url].m_ilonTimeOffset==null){return null}var a=new Date();a.setTime(a.getTime()+Echelon.SoapServerObject.m_globals.time[this.m_url].m_ilonTimeOffset);return a},pingAndRelaunch:function(b){elon.elon.setVal("BoolItem","disablePoll",true);this.m_origUrl=this.m_url;var c=((this.getPort()!=80)?(":"+this.getPort()):"")+this.getPath();var a=elon.ValidationObject.getInstance();if(a.validateIPv4(this.m_url)==null){this.m_url=b.IPv4}else{if(a.validateIPv6(this.m_url)==null){this.m_url="["+b.IPv6+"]"}else{if(a.validateFullHostname(this.m_url)==null){this.m_url=b.Domain}else{this.m_url=b.IPv4}}}this.m_url+=c;if(this.getUrl()==elon.elon.getTopLevelSSO().getUrl()){elon.elon.setVal("BoolItem","disablePoll",true);elon.elon.disableUI(this,"everything");elon.elon.setInfMsg("Please wait while SmartServer is rebooting ...");this.m_id="volatile"}elon.UtilObject.getInstance().fireDelayedFunction(this.m_pingAndRelaunch,120000,this)},checkLonNet:function(b){if((b.url||this.getUrl()).match(new RegExp("/LnsProxy/LnsProxyService$"))){if(b.callback){b.callback(true)}return}var d=this.m_toItemArr(b);var e={};for(var a=0;a<d.length;a++){e[d[a].UCPTname.get().match(/^[^\/]+/)[0]]=true}var c=[];for(var a in e){c.push(a)}this.getRemocalItem(this.m_cpReqObj(b,{type:"LON_Network_Cfg",Item:c,id:"volatile",callback:this.m_GetLonNetsCB(b),returnArray:true}))},applyDpTemplates:function(a){this.getRemocalItem(this.m_cpReqObj(a,{callback:this.m_ApplyDpTemplates(a),returnArray:true}))},subscribe:function(a){this.getRemocalItem(this.m_cpReqObj(a,{subscribe:true}))},unsubscribe:function(b){var c=this.m_toItemArr(b);for(var a=0;a<c.length;a++){c[a].y_proxy_unsubscribe(b.callback)}},addSyncCB:function(a){this.m_syncPoll(a.url||this.m_url,a.id||this.m_id);Echelon.SoapServerObject.m_globals.polls[a.url||this.m_url].push(a.callback)},addChangeDbCb:function(b){var c=Echelon.SoapServerObject.m_globals.lns.changeCB;var a=b.url||this.m_url;if(!c[a]){c[a]={}}c[a][b.id||this.m_id]=b.callback},getActiveDB:function(){return Echelon.SoapServerObject.m_globals.lns.db[this.m_url]},poll:function(d){var e=this.m_toItemArr(d);for(var c=0;c<e.length;c++){if(elon.filter.webDp(e[c].UCPTname.get())){var f={};for(var b in d){f[b]=d[b]}f.Item=e[c];this.subscribe(f);continue}e[c].y_proxy_subscribe(d.callback,this.m_subscriptionId(d));if(e[c].r_proxy_fromIlon&&!d.noInitialCallback){elon.UtilObject.getInstance().fireQuickCallback(d.callback,this,e[c])}var a=this.m_cpReqObj(d,{Item:e[c]});delete a.callback;Echelon.SoapPollerObject.getInstance(d.url||this.m_url,this).add(a)}if(!e.length){Echelon.SoapPollerObject.getInstance(d.url||this.m_url,this).add(this.m_cpReqObj(d))}},stopPolling:function(b){var c=this.m_toItemArr(b);for(var a=0;a<c.length;a++){Echelon.SoapPollerObject.getInstance(b.url||this.m_url,this).del(c[a],this.m_id)}if(!c.length){Echelon.SoapPollerObject.getInstance(b.url||this.m_url,this).del(b.xSelect,this.m_id)}},convertFromSimple:function(b){if(b.mute){this.mute({type:b.type,Item:b.Item.UCPTname,id:b.id||this.m_id})}b=this.m_cpReqObj(b);if(b.unmanaged){var a=this.getItem(this.m_cpReqObj(b,{Item:b.Item.UCPTname})).m_proxy_convertFromSimple(b.Item,b.id||this.m_id,b.mute)}else{var a=this.m_factory.convertFromSimple(b.type,b.Item,b.url,b.id,b.mute)}if(b.mute){a.y_proxy_unmute()}if(b.fromScratch){a.r_proxy_fromScratch=true}if(b.noSubmit){a.m_proxy_noSubmit=true}return a},convertToSimple:function(a){return(this.m_toItem(a,arguments.caller)).m_proxy_convertToSimple()},convertFromXml:function(e){e=this.m_cpReqObj(e);var b={};var a=new Date().getTime();var d=Echelon.SoapFactoryObject.getInstance().getConstructor("Item_Coll");Echelon.SoapDenCoders.parseXmlComplex(Echelon.XmlParser.getInstance().xml2Dom(e.xml).firstChild,b,"iLonItem",null,{create:d},(e.unmanaged==true)?false:true,e.url,e.id,new Date().getTime());b=b.iLonItem;for(var c=0;c<b.Item.length;c++){if(elon.filter.webDp(b.Item[c].UCPTname.get())){b.Item[c].m_proxy_noSubmit=true}}return b},convertToXml:function(b){var a=this.m_toColl(b,"Item_Coll",arguments.caller).m_proxy_encode("iLonItem");a=a.replace(new RegExp("<iLonItem"),'<iLonItem xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"');return a},ILON_SOAP_ENDPOINT:"/WSDL/iLON100.WSDL",registerTmpObj:function(c){var a=this.m_toItemArr(c);for(var b=0;b<a.length;b++){Echelon.SoapServerObject.m_globals.tmpObj.add(a[b])}},TMP_SUFFIX:"__TEMP_OBJECT",tmpCopy:function(a){delete a.noSubmit;var b=this.m_toItem(a,arguments.caller);this.copy(this.m_cpReqObj(a,{Item:b,copy:{Item:b.UCPTname.get()+this.TMP_SUFFIX,noSubmit:true}}),arguments.caller)},acceptTmpCopy:function(a){var b=this.m_toItem(a,arguments.caller);this.copy(this.m_cpReqObj(a,{Item:b,copy:{Item:b.UCPTname.get().replace(this.TMP_SUFFIX,"")}}),arguments.caller)},copy:function(b,a){if(b.noPreprocessing){return this.m_cpColl(b)}this.getRemocalItem(this.m_cpReqObj(b,{local:true,callback:this.m_CpCB(b)}))},primeKey:function(a){var b=this.m_toItem(a,arguments.caller);return b[this.m_primeKey[b.r_proxy_type]||"UCPThandle"]},primeKeyName:function(a){var b=this.m_toItem(a,arguments.caller);return this.m_primeKey[b.r_proxy_type]||"UCPThandle"},rename:function(a){var b=this.m_toItem(a,arguments.caller);if(a.unmanaged){b.UCPTname.m_value=a.newName}else{this.m_factory.rename(b,a.newName,this.m_cpReqObj(a).id)}},markDeleted:function(c){var a=this.m_toItemArr(c);for(var b=0;b<a.length;b++){this.m_factory.markDeleted(a[b],c.includeLocal)}},clearRedirect:function(c){var a=this.m_toItemArr(c);for(var b=0;b<a.length;b++){this.m_factory.clearRedirect(a[b],c.includeLocal)}},visible:function(a){return this.m_factory.visible(this.m_toItem(a,arguments.caller))},preprocessType:function(b){if(!b){return b}var a=b.match(/[^\.]+$/);if(a){a=a[0]}if(b.match(/#\d+\[\d+\]\.\w+/)){a+="_Cfg"}return a},setId:function(a){this.m_id=a},getId:function(a){return this.m_id},register:function(c){var a=this.m_toItemArr(c);for(var b=0;b<a.length;b++){this.m_get(a[b].r_proxy_type,a[b].UCPTname.get(),c)}},unregister:function(c){var a=this.m_toItemArr(c);for(var b=0;b<a.length;b++){this.m_factory.unregister(a[b],(c.id||this.m_id).domObj)}},getItem:function(a){if((a.Item==null)&&(a.type!=null)){return this.m_get(a.type)}else{return this.m_toItem(a,arguments.caller)}},getDefaultItem:function(c){var b=this.preprocessType(c.type);if(!Echelon.DefaultItem[b]){if(elon.WSDLComplexTypes[b]){elon.elon.setErrMsg('Internal error: no Default values available for type "'+b+'", assuming Fb_Cfg')}var d=this.getItem(this.m_cpReqObj(c,{type:"Fb_Cfg",Item:c.Item,fromScratch:((c.fromScratch==false)?false:true)}));d.y_proxy_clear();if(c.mute){d.y_proxy_unmute()}}else{var e=Echelon.DefaultItem[b];e.UCPTname=(typeof(c.Item)=="string")?c.Item:c.Item.UCPTname.get();var d=this.convertFromSimple(this.m_cpReqObj(c,{type:b,Item:e,fromScratch:((c.fromScratch==false)?false:true)}));if(c.mute){d.y_proxy_mute(c.id)}var a=(c.id||this.m_id)&&(typeof(c.id||this.m_id)!="string");switch(b){case"UFPTalarmNotifier_Cfg":d.UCPTsumLogFileName.set("/"+e.UCPTname+"_Summary.csv");d.UCPThistLogFileName.set("/"+e.UCPTname+"_History.csv");d.UCPTlogFormat.set("LF_TEXT");d.UCPTlogFormat.LonFormat.set("UCPTlogFormat");break;case"UFPTdataLogger_Cfg":d.UCPTlogFileName.set("/"+e.UCPTname+".csv");d.UCPTlogFormat.set("LF_TEXT");d.UCPTlogFormat.LonFormat.set("UCPTlogFormat");break;case"UFPTscheduler_Cfg":if(!a){break}d.DayBased[0].UCPTdescription.set((c.id||this.m_id).translate("WEEKDAY"));d.DayBased[1].UCPTdescription.set((c.id||this.m_id).translate("WEEKEND"));break}delete e.UCPTname}if(c.mute){d.r_proxy_silentDefault=true}delete d.r_proxy_retrieving;return d},getRemocalItem:function(c){if(c.xSelect&&!c.Item){this.m_GetRemocalXselect(c,this);return}var f=(c.subscribe&&c.singular)?{callback:this.m_GetRemocalSubscribeSingularCB(c)}:null;c=this.m_cpReqObj(c,f);var d=this.m_toItemArr(c);var e=this.m_cpReqObj(c,{Item:[],retType:c.type});if(c.subscribe||c.acceptDefault){if(elon.SoapTemplateObject.isInherited({type:c.type},"Fb_Cfg")){e.acceptDefault=c.acceptDefault=true}if(c.acceptDefault){e.noErrMsg=true}e.callback=this.m_GetRemocalSubscribeCB(c);if(elon.SoapTemplateObject.isInherited({type:c.type},"Fb_Cfg")){e.acceptBase=true}}else{if(c.returnArray){var b=this.m_GetRemocalArrayCB(c.callback,d.length,{generalFb:1,Item:1}[c.type]);e.callback=b.callback}else{e.callback=this.m_GetRemocalCB(c.callback)}}if(e.type=="generalFb"){e.type="Item";e.retType="Fb_Cfg";e.acceptInherited=true}for(var a=0;a<d.length;a++){if(c.subscribe){d[a].y_proxy_subscribe(c.callback,this.m_subscriptionId(c))}if(!c.noInitialCallback){if(d[a].r_proxy_retrieving){if(!c.subscribe){d[a].y_proxy_subscribe(this.m_GetRemocalSyncCB(e),this.m_subscriptionId(c),c.acceptInherited?"children":null)}}else{if(d[a].r_proxy_fromIlon||d[a].r_proxy_tainted||d[a].r_proxy_fromScratch||elon.filter.webDp(d[a].UCPTname.get())||((d[a].r_proxy_type!="Item")&&this.getItem({type:"Item",Item:d[a],id:c.id}).r_proxy_fromScratch)||(e.type&&Echelon.WSDLInternalTypes[e.type])){if(c.returnArray){elon.UtilObject.getInstance().fireQuickCallback(e.callback,this,{Item:[d[a]]})}else{elon.UtilObject.getInstance().fireQuickCallback(c.callback,this,d[a])}}else{if(!e.m_retrieving){e.m_retrieving=[]}e.m_retrieving.push(d[a]);d[a].r_proxy_retrieving=true;e.Item.push(d[a].UCPTname.get())}}}}if(e.Item.length>0){if(b){b.expectSoapLength((c.type=="generalFb")?1:e.Item.length)}this.m_genericSoapCall(e,c.type||d[0].r_proxy_type)}},mute:function(a){this.m_toItemArr(this.m_cpReqObj(a,{mute:true}))},unmute:function(a){this.m_toItemArr(this.m_cpReqObj(a,{unmute:true}))},soapVersion:function(a){Echelon.SoapVersionDiscoveryObject.getInstance().discover(a.url,a.callback,a.timeout)},getUrl:function(){return this.m_url},getIp:function(){return elon.Url(this.m_url).ip()},getPort:function(){return elon.Url(this.m_url).port()},getPath:function(){return elon.Url(this.m_url).fullPath()},isDefaultPort:function(){return elon.Url(this.m_url).isDefaultPort()},setPath:function(a){this.m_url=this.m_url.replace(this.getPath(),a)},setIp:function(a){this.m_url=this.m_url.replace(this.getIp(),a)},setUrl:function(a){this.m_url=a},getTimezoneOffsetString:function(){return Echelon.SoapServerObject.m_globals.header[this.m_url]?Echelon.SoapServerObject.m_globals.header[this.m_url].UCPTtimeStamp.toFormattedString("%+%o2h:%o2m"):"+00:00"},getTimezoneOffset:function(){return Echelon.SoapServerObject.m_globals.header[this.m_url]?Echelon.SoapServerObject.m_globals.header[this.m_url].UCPTtimeStamp.getTimezoneOffset():0},getHeader:function(){return Echelon.SoapServerObject.m_globals.header[this.m_url]},getSoapOp:function(a){return((a=="Item")||(a=="Dp_Ref")||(a.search("_Cfg")!=-1))?"Get":"Read"},isAdmin:function(){return this.getPath()=="/EES/AdminService/v4.0/WSDL/Admin.wsdl"},isLnsProxy:function(){return this.getPath()=="/LnsProxy/LnsProxyService"},isIlon:function(){return this.getPath()=="/WSDL/iLON100.WSDL"},isAdminItem:function(a){var b=this.m_toItem(a,arguments.caller);return b.r_proxy_url.replace(/^[^\/]*/,"")=="/EES/AdminService/v4.0/WSDL/Admin.wsdl"},isIlonItem:function(a){var b=this.m_toItem(a,arguments.caller);return b.r_proxy_url.replace(/^[^\/]*/,"")=="/WSDL/iLON100.WSDL"},isLnsProxyItem:function(a){var b=this.m_toItem(a,arguments.caller);return b.r_proxy_url.replace(/^[^\/]*/,"")=="/LnsProxy/LnsProxyService"},distribute:function(d,f){if(!d.Item.length){return[d]}var b={};for(var c=0;c<d.Item.length;c++){if(!b[d.Item[c].r_proxy_url]){b[d.Item[c].r_proxy_url]={Item:[],url:d.Item[c].r_proxy_url};for(var a in d){if(a!="Item"){b[d.Item[c].r_proxy_url][a]=d[a]}}}b[d.Item[c].r_proxy_url].Item.push(d.Item[c])}var e=0;if(f){for(var c in b){this[f](b[c]);e++}}return e},submitQueueIsEmpty:function(a){return Echelon.SoapSubmitQueueObject.getInstance().isEmpty()},addSubmitCallback:function(a){Echelon.SoapSubmitQueueObject.getInstance().addCallback(a)},cancelSubmitCallback:function(a){Echelon.SoapSubmitQueueObject.getInstance().cancelCallback(a)},addSubmitOperation:function(a){Echelon.SoapSubmitQueueObject.getInstance().addSubmitOp(a)},cancelSubmitOperation:function(a){Echelon.SoapSubmitQueueObject.getInstance().cancelSubmitOp(a)},addPostSubmitCallback:function(a,b){Echelon.SoapSubmitQueueObject.getInstance().addPostSubmitCallback(a,b)},cancelPostSubmitCallback:function(a,b){Echelon.SoapSubmitQueueObject.getInstance().cancelPostSubmitCallback(a,b)},setSubmitRequired:function(a){Echelon.SoapSubmitQueueObject.getInstance().setSubmitRequired(a)},addSubmitDeletion:function(a){Echelon.SoapSubmitQueueObject.getInstance().addDeletion(this.m_toItemArr(a))},unsubmit:function(b){var a=this.m_toItemArr(b);Echelon.SoapSubmitQueueObject.getInstance().remove(a)},unsubmitFamily:function(b){var a=this.m_toItemArr(b);Echelon.SoapSubmitQueueObject.getInstance().purge(a)},autoSubmit:function(c,d,b){var a=Echelon.SoapSubmitQueueObject.getInstance();if(!a.isEmpty()){elon.Popup.getInstance({elon_url:elon.htmUrl("Submit.htm"),elon_no_scrolling:"true",elon_args_obj:{elon_lang:c,elon_name:"#Web/global/submitPopup"}});this.subscribe({type:"BoolItem",Item:"#Web/global/submitPopup",callback:this.m_SubmitPopupCB(d,b),noInitialCallback:true,mute:true,clear:true,unmute:true,singular:true})}else{if(d){d()}else{if(b){b()}}}},listSubmitQueue:function(a){return Echelon.SoapSubmitQueueObject.getInstance().List(a.url||this.m_url,a.xSelect)},submit:function(c,b){if(c){this.addPostSubmitCallback(c)}var a=Echelon.SoapSubmitQueueObject.getInstance();elon.UtilObject.getInstance().fireQuickCallback(a.submitAll,a,b)},unsubmitAll:function(){var a=Echelon.SoapSubmitQueueObject.getInstance();a.reset()},delFromCache:function(c){var a=this.m_toItemArr(this.m_cpReqObj(c));for(var b=0;b<a.length;b++){this.m_factory.delFromCache(a[b])}},purgeFromCache:function(c){var a=this.m_toItemArr(this.m_cpReqObj(c));for(var b=0;b<a.length;b++){this.m_factory.purgeFromCache(a[b])}},xSelGetFromCache:function(a){return this.m_factory.Get(a.url||this.m_url,a.xSelect)},resync:function(a){return this.m_factory.sync(this.m_toColl(a,"Item_Coll",arguments.caller),null,null,a.url||this.m_url)},createBinding:function(b){var a=this.m_cpReqObj(b);this.getItem(a.target).y_proxy_addBinding(a)},soapCall:function(a){if(!Echelon.SoapServerObject.m_globals.time[this.m_url]){Echelon.SoapServerObject.m_globals.time[this.m_url]={m_ilonSyncStart:new Date().getTime()}}Echelon.SoapMessageObject.getInstance().soapCall(this.m_cpReqObj(a))}}});Echelon.SoapServerObject.m_globals={delayedSoapCalls:{},clearingSoapQueue:{},soapQueue:{},msgPrinted:{},header:{},time:{},polls:{},tmpObj:Echelon.SoapObjCache.getInstance(),lns:{db:{},lastUpdate:{},changeCB:{}}};Echelon.SoapServerObject.clearTmpObj=function(){Echelon.SoapServerObject.m_globals.tmpObj.each(function(a){elon.elon.getTopLevelSSO().Delete({Item:a.UCPTname.get(),url:a.r_proxy_url,id:"volatile",unmanaged:true,callback:function(){}})});Echelon.SoapServerObject.m_globals.tmpObj.clear()};Echelon.SoapServerObject.getInstance=Echelon.SoapServerObject;Echelon.collectGarbage=function(){Echelon.removeOrphanedPolls();Echelon.SoapFactoryObject.getInstance().collectGarbage()};Echelon.removeOrphanedPolls=function(){for(var a in Echelon.SoapPollerObject.instances){Echelon.SoapPollerObject.instances[a].collectGarbage()}};Echelon.PollBase=elon.Class({constructor:function(b,a){this.m_exceptionHandler=elon.ExceptionHandler();this.m_maxAge=a.maxAge;this.f_empty=false;this.m_sso=b;if(!this.f_op){this.f_op=this.f_getOp(a)}this.f_fetch(a)},"public":{abort:function(){if(this.m_nextKey){elon.util.abortCallback(this.m_nextKey)}delete this.m_nextKey},trigger:function(){this.abort();this.f_poll()},empty:function(){return this.f_empty},isAlive:function(){for(var a=0;a<this.f_id.length;a++){try{if(this.f_id[a].domObj==true){continue}if(!elon.util.isAlive(this.f_id[a].domObj)){this.f_id.splice(a,1);a--}}catch(b){this.f_id.splice(a,1);a--}}if(!this.f_id.length){this.disable()}return this.f_id.length!=0},enable:function(){delete this.m_disabled;if(this.m_lastUpdate){this.f_poll()}},disable:function(){if(!this.m_disabled){this.abort()}this.m_disabled=true}},"protected":{f_rmId:function(c){var b=true;if(this.f_id&&this.f_id.length){for(var a=0;a<this.f_id.length;a++){if(!c||c==this.f_id[a]){this.f_id.splice(a--,1)}}if(this.f_id.length){b=false}}return b},f_refresh:function(a){this.m_maxAge=a.maxAge;this.abort();if(!elon.elon.getVal("BoolItem","disablePoll")&&!this.m_disabled){this.f_poll()}else{this.m_disabled=true}},f_fetch:function(a){if(!a.Item||!Echelon.PollBase.m_fetching.cached(a.Item)||a.forceFetch){a.forceFetch=false;if(a.Item||a.pollItem){if(!a.pollItem&&!a.xSelect&&a.Item&&a.Item.UCPTlastUpdate&&a.Item.UCPTlastUpdate.isInitialized()&&(!this.m_lastUpdate||(a.Item.y_proxy_age()<=a.Item.y_proxy_age(this.m_lastUpdate)))){this.m_FetchCB(a)({Item:[a.Item]});return}var b={Item:a.pollItem||a.Item.UCPTname.get(),callback:this.m_FetchCB(a),id:a.id,unmanaged:a.unmanaged};if(a.xSelect){b.xSelect=a.xSelect}this.m_sso[this.f_op](b);Echelon.PollBase.m_fetching.add(b.Item)}else{var c=a.xSelect;if(a.emptyFetch){c='//Item[UCPTname="#Web/global/emptyFetch"]'}if(a.fetchLastUpdate){c+='[UCPTlastUpdate>"'+a.fetchLastUpdate.toFormattedString(Echelon.DateTimeObject.isoUtcFormat)+'"]'}this.m_sso[a.List?"List":this.f_op]({xSelect:c,noErrMsg:true,callback:this.m_FetchCB(a),id:a.id,translator:a.translator,unmanaged:a.unmanaged})}}},"nest:f_Poll":elon.Class({constructor:function(b,a,c){this.m_reqObjs=b;this.m_lastPoll=new Date();this.m_key=this.parent.m_nextKey;a.callback=this.m_cb;this.parent.m_sso[c](a)},"private":{"callback:m_cb":function(f,c,g){if((c!=null)&&(this.m_reqObjs!=null)){for(var d=0;d<this.m_reqObjs.length;d++){this.parent.m_handleErr(this.m_reqObjs[d],c,g)}}else{this.parent.m_updateLastUpdate(g);for(var d=0;d<this.m_reqObjs.length;d++){var e=this.m_reqObjs[d];if(e.type&&e.Item){for(var b=0;b<f.Item.length;b++){if((f.Item[b].UCPTname.get()==e.Item.UCPTname.get())&&(f.Item[b].r_proxy_type!=e.type)&&(typeof(f.Item[b].fault)!="function")){this.parent.m_sso.mute({Item:e.Item});if(typeof(e.Item.fault)=="function"){e.Item.fault()}e.Item.fault.y_proxy_copy(f.Item[b].fault);this.parent.m_sso.unmute({Item:e.Item});e.Item.m_proxy_notify(c,g)}}}if(e.pollCallback){this.parent.m_exceptionHandler.call(e.pollCallback,[f,c,g])}else{if(f&&f.Item.length&&e.callback){this.parent.m_exceptionHandler.call(e.callback,[f,c,g])}}}}if(this.m_key==this.parent.m_nextKey){var a=this.parent.m_getDelay()*1000-(new Date().getTime()-this.m_lastPoll.getTime());if(elon.elon.getVal("BoolItem","disablePoll")){this.parent.m_disabled=true}else{if(!this.parent.m_disabled){if(a<=0){a=1}this.parent.m_nextKey=elon.util.fireDelayedFunction(this.parent.f_poll,a,this.parent)}}}}}}),f_getOp:function(a){return this.m_sso.getSoapOp((a.pollItem||a.Item).r_proxy_type)},f_getMaxAge:function(){return this.m_maxAge},f_getLastUpdateVal:function(){return this.m_lastUpdate},f_getLastUpdate:function(){return this.m_lastUpdate?('[UCPTlastUpdate>"'+this.m_lastUpdate.toFormattedString(Echelon.DateTimeObject.isoUtcFormat)+'"]'):""}},"private":{"static:m_fetching":Echelon.SoapObjCache.getInstance(),"nest:m_FetchCB":elon.Class({constructor:["m_reqObj"],closure:function(c,a,d){if((a!=null)&&(this.m_reqObj.Item!=null)){this.parent.m_handleErr(this.m_reqObj,a,d)}else{if(this.m_reqObj.pollCallback){this.parent.m_exceptionHandler.call(this.m_reqObj.pollCallback,[c,a,d])}}if(!c){return this.parent.del(this.m_reqObj.Item||this.m_reqObj.xSelect)}for(var b=0;b<c.Item.length;b++){Echelon.PollBase.m_fetching.del(c.Item[b])}if(this.parent.m_lastUpdate==null){this.parent.m_updateLastUpdate(d,c)}if((this.m_reqObj.Item==null)&&!this.m_reqObj.emptyFetch){this.parent.m_exceptionHandler.call(this.m_reqObj.callback,[c,a,d])}if(!this.parent.m_nextKey){this.parent.m_nextKey=elon.util.fireDelayedFunction(this.parent.f_poll,this.parent.m_getDelay(),this.parent)}}}),m_handleErr:function(b,a,c){if(b.Item){b.Item.m_proxy_notify(a,c)}if(b.pollCallback){this.m_exceptionHandler.call(b.pollCallback,[null,a,c])}},m_getDelay:function(){return(this.m_maxAge=="default")?elon.elon.getVal("IntItem","pollRate"):((this.m_maxAge=="sync")?(elon.elon.getVal("IntItem","pollRate")*10):this.m_maxAge)},m_updateLastUpdate:function(b,a){if(!b||!b.UCPTtimeStamp){if(!this.m_lastUpdate&&a.Item&&(a.Item.length==1)&&a.Item[0].UCPTlastUpdate.isInitialized()){this.m_lastUpdate=a.Item[0].UCPTlastUpdate.clone()}return}this.m_lastUpdate=b.UCPTtimeStamp.clone()}}});Echelon.ItemPoll=elon.Class({base:{m_PollBase:Echelon.PollBase},constructor:function(b,a){this.m_objs=Echelon.SoapObjCache.getInstance();this.m_objs.add(a.Item,{ro:a,id:[a.id]});this.m_PollBase(b,a)},"public":{pollRequest:function(a){if(a.xSelect){return}var b=this.m_objs.getData(a.Item);if(!b&&(a.maxAge==this.f_getMaxAge())&&(this.f_getOp(a)==this.f_op)){this.m_objs.add(a.Item,{ro:a,id:[a.id]});this.f_fetch(a);return true}else{if(!b){return false}}if(a.type=="Dp_Data"){if(a.pollItem&&b.ro){b.ro.pollItem=a.pollItem}if(a.forceFetch){this.f_fetch(a)}}if(this.m_maxAge<=a.maxAge){b.id.push(a.id)}else{if(this.m_objs.length==1){this.f_refresh(a)}else{elon.elon.setErrMsg("WebUI internal error: changing pollrate of one Item in pollgroup is not supported")}}return true},del:function(a,c){if(typeof(a)=="string"){return}var b=this.m_objs.getData(a);if(b){if(this.f_rmId(c)){this.m_objs.del(a);if(this.m_objs.isEmpty()){this.disable();this.f_empty=true}}return this.f_getLastUpdateVal()}return null},isAlive:function(){var a=[];this.m_objs.each(function(h,f){var d=[];for(var c=0;c<f.id.length;c++){try{if((f.id[c].domObj==true)||(elon.util.isAlive(f.id[c].domObj))){d.push(f.id[c])}}catch(g){}}f.id=d;if(!d.length){a.push(h)}});for(var b=0;b<a.length;b++){this.del(a[b])}if(this.m_objs.isEmpty()){this.disable()}return !this.m_objs.isEmpty()},adjustMaxAge:function(a){this.m_objs.each(function(c,b){if(c.r_proxy_type=="Dp_Data"&&b.ro.pollItem){b.ro.pollItem.UCPTmaxAge.set(b.ro.UCPTmaxAge!=null?b.ro.UCPTmaxAge:a)}})}},"protected":{"callback:f_poll":function(){var a=[];var b=[];this.m_objs.each(function(d,c){b.push(c.ro);a.push(c.ro.pollItem||this.m_sso.getItem({type:"Item",Item:c.ro.Item.UCPTname.get(),id:c.ro.id,unmanaged:c.ro.unmanaged}))},this);if(!b.length){return}this.f_Poll(b,{Item:a,xSelect:"//Item"+this.f_getLastUpdate(),id:b[b.length-1].id,unmanaged:b[b.length-1].unmanaged},this.f_op)}}});Echelon.XSelPoll=elon.Class({base:{m_PollBase:Echelon.PollBase},constructor:function(b,a){this.f_op=a.List?"List":((a.xSelect.search(/\[@xsi:type="([^_]+_)?[a-zA-Z]+_Cfg"]/)!=-1)?"Get":"Read");this.m_PollBase(b,a);this.m_reqObj=a;this.f_id=[a.id]},"public":{pollRequest:function(a){if(!a.Item&&!a.pollItem&&(this.m_reqObj.xSelect==a.xSelect)){this.f_id.push(a.id);if(this.m_reqObj.maxAge>=a.maxAge){this.f_refresh(a)}return true}return},del:function(a,b){if((typeof(a)=="string")&&(this.m_reqObj.xSelect==a)){if(this.f_rmId(b)){this.disable();this.f_empty=true}return this.f_getLastUpdateVal()}return null},adjustMaxAge:function(a){}},"protected":{"callback:f_poll":function(){this.f_Poll([this.m_reqObj],{xSelect:this.m_reqObj.xSelect+(this.m_reqObj.noLastUpdate?"":this.f_getLastUpdate()),id:this.m_reqObj.id,unmanaged:this.m_reqObj.unmanaged},this.f_op)}}});Echelon.CombiPoll=elon.Class({base:{m_PollBase:Echelon.PollBase},constructor:function(b,a){this.m_PollBase(b,a);this.m_reqObj=a;this.f_id=[a.id]},"public":{pollRequest:function(a){if(!(a.Item||a.pollItem)||!a.xSelect){return}else{if(a.xSelect!=this.m_reqObj.xSelect){return}else{if((a.pollItem||a.Item)!=(this.m_reqObj.pollItem||this.m_reqObj.Item)){return}}}this.f_id.push(a.id);if(this.m_reqObj.maxAge>=a.maxAge){this.f_refresh(a)}return true},del:function(a,b){if(a==this.m_reqObj.Item){if(this.f_rmId(b)){this.disable();this.f_empty=true}return this.f_getLastUpdateVal()}return null},adjustMaxAge:function(a){if(this.m_reqObj.Item.r_proxy_type=="Dp_Data"&&this.m_reqObj.pollItem){this.m_reqObj.pollItem.UCPTmaxAge.set(this.m_reqObj.UCPTmaxAge!=null?this.m_reqObj.UCPTmaxAge:a)}}},"protected":{"callback:f_poll":function(){var a=this.m_reqObj.pollItem||this.m_sso.getItem({type:"Item",Item:this.m_reqObj.Item.UCPTname.get(),id:this.m_reqObj.id,unmanaged:this.m_reqObj.unmanaged});this.f_Poll([this.m_reqObj],{Item:[a],xSelect:this.m_reqObj.xSelect+(this.m_reqObj.noLastUpdate?"":this.f_getLastUpdate()),id:this.m_reqObj.id,unmanaged:this.m_reqObj.unmanaged},this.f_op)}}});Echelon.PollFactory=function(b,a){if(a.xSelect&&(a.Item||a.pollItem)){return Echelon.CombiPoll(b,a)}else{if(a.Item){return Echelon.ItemPoll(b,a)}else{if(a.xSelect){return Echelon.XSelPoll(b,a)}else{elon.elon.setErrMsg("WebUI internal error: invalid poll request")}}}};Echelon.SoapPollerObject=elon.Class({instantiator:"perServer",constructor:function(a,b){this.m_sso=Echelon.SoapServerObject.getInstance(a);this.m_polls=[];this.m_maxAgeMode=null;this.m_maxAge=null;(b||elon.elon.getTopLevelSSO()).subscribe({type:"BoolItem",Item:"#Web/global/disablePoll",callback:this.m_enableCB,id:"persistent"});(b||elon.elon.getTopLevelSSO()).subscribe({type:"GlobalSettings_Communication",Item:"#Web/global/GlobalSettings_Communication",callback:this.m_maxAgeCB,id:"persistent"});this.m_disabled={}},"public":{triggerPoll:function(){this.m_each(function(a){a.trigger()})},add:function(b){var c;if(b.maxAge==null){b.maxAge="default"}for(var a=0;a<this.m_polls.length;a++){c=this.m_polls[a].pollRequest(b);if(c){break}}if(!c){this.m_polls.push(Echelon.PollFactory(this.m_sso,b))}},del:function(c,e){var d;for(var b=0;b<this.m_polls.length;b++){var a=this.m_polls[b].del(c,e);if(a){d=a}if(this.m_polls[b].empty()){this.m_polls.splice(b,1);b--}}return d},collectGarbage:function(){for(var a=0;a<this.m_polls.length;a++){if(!this.m_polls[a].isAlive()){this.m_polls.splice(a,1);a--}}}},"private":{m_each:function(b){for(var a=0;a<this.m_polls.length;a++){b.call(this,this.m_polls[a])}},"callback:m_enableCB":function(a){if(!a.value.get()){this.m_each(function(b){b.enable()})}else{this.m_each(function(b){b.disable()})}},"callback:m_maxAgeCB":function(a){this.m_maxAgeMode=a.maxAgeMode.get();if(this.m_maxAge==(this.m_maxAge=this.m_maxAgeMode=="MANUAL"?a.maxAge.get():null)){return}this.m_each(function(b){b.adjustMaxAge(this.m_maxAge)})}}});new elon.PerServerInstantiator(Echelon.SoapPollerObject);Echelon.SoapSubmitQueueObject=function(){var x=this;var n=Echelon.SoapServerObject.getInstance(elon.getSoapUrl({},EchelonTop.window));var w=n.getItem({Item:"#Web/global/submit",type:"FormObj_Data",id:"persistent"});w.style.push({field:"fontWeight",value:"normal"});var i=Echelon.SoapObjCache.getInstance();var j=Echelon.SoapObjCache.getInstance();var q=Echelon.SoapObjCache.getInstance();var r=Echelon.SmartServerSleuth();var m=true;var c=[];var z=[];var o=[];var a=[];var e=0;var b=0;var A=null;var s=function(H,G,F,C){if((w.value.get()=="true")&&m){w.value.set("false",this);return}j.each(function(N){i.purge(N);var M=i.List(N.r_proxy_url,'//Item[starts-with(UCPTname,"'+N.UCPTname.get()+'/")]');for(var L=0;L<M.length;L++){i.del(M[L])}});var D={out:{Drv_Dp_Cfg:{Set:{}},Drv:{Set:{}},Gen:{Set:{},Write:{},Delete:{}}},haveOut:{}};var J=[];i.each(function(M,O){if(!C&&(O!=null)){J.push(O.UCPTname.get())}var L="Gen";var N=(M.r_proxy_type.indexOf("_Data")!=-1)?"Write":"Set";if((N=="Set")&&M.r_proxy_type.match(/^\w+_\w+_\w+$/)){if(M.r_proxy_type.match(/^\w+_(Dp|File)_Cfg$/)){L="Drv_Dp_Cfg"}else{L="Drv"}}D.haveOut[L]=true;if(!D.out[L][N][M.r_proxy_type]){D.out[L][N][M.r_proxy_type]=[]}D.out[L][N][M.r_proxy_type].push(M)});if(J.length){var K;for(var E=0;E<w.m_proxy_subscribers.length;E++){try{if(w.m_proxy_subscribers[E][1].uiEvent){K=w.m_proxy_subscribers[E][1];break}}catch(I){}}if(K){var B=K.f_sso.getItem({type:"StringItem",Item:"#Web/global/overwriteIlonVersion"});B.value.set(elon.UtilObject.getInstance().substitutePlaceholders(K.translate("OVERWRITE_ILON_VERSION_MSG"),{update:J.join(", ")}));K.f_confirm(B,t(D),K.translate("OVERWRITE_ILON_VERSION_TITLE"))}else{if(!confirm(J.join(", ")+" was changed on the iLON while you started editing it in the web-interface. Are you sure you want to overwrite the changed version on the iLON? If you click OK, your version will overwrite the version on the iLON, if you click cancel all changes you made since the last submit will be abandoned.")){x.reset()}else{f(D)}}}else{f(D)}};var t=elon.Class({constructor:["m_submitInfo"],closure:function(B){if(B){f(this.m_submitInfo)}else{x.reset()}}});var f=function(F){v(F);if(F.out.Gen.Set.Dp_Cfg){var E={Dp_Cfg:F.out.Gen.Set.Dp_Cfg};for(var D in F.out.Gen.Set){if(D!="Dp_Cfg"){E[D]=F.out.Gen.Set[D]}}F.out.Gen.Set=E}for(var D in {Drv_Dp_Cfg:1,Drv:1}){for(var C in F.out[D].Set){for(var B=0;B<F.out[D].Set[C].length;B++){var G=F.out[D].Set[C][B];var H=i.get(G.r_proxy_url,G.r_proxy_type.match(/[^_]+_[^_]+$/)[0],G.UCPTname.get());if(H){H.UCPTannotation.set(elon.filter.imgToAnnotation(elon.filter.annotationToImg(G.UCPTannotation.get()),H.UCPTannotation.get()));H.UCPThidden.set(G.UCPThidden.get());if(H.UCPTformatDescription&&G.UCPTformatDescription){H.UCPTformatDescription.set(G.UCPTformatDescription.get())}if(H.UCPTlength&&G.UCPTlength){H.UCPTlength.set(G.UCPTlength.get())}if(H.UCPTdirection&&G.UCPTdirection){H.UCPTdirection.set(G.UCPTdirection.get())}break}}}}d(c,[true,u]);d(z,[true,u]);j.each(function(I){if(!F.out.Gen.Delete[I.r_proxy_type]){F.out.Gen.Delete[I.r_proxy_type]=[]}F.out.Gen.Delete[I.r_proxy_type].push(I);F.haveOut.Gen=true});A=[];for(var D in F.out){if(F.haveOut[D]){A.push(F.out[D])}}y()};var y=function(){e=0;b=0;var E=false;var G=A.shift();var B=A.length?true:null;for(var D in G){for(var C in G[D]){try{e+=n.distribute({Item:G[D][C],callback:u,id:"volatile",noSync:B},D)}catch(F){E=true;k(F)}}}if(E){e=0}if(e){elon.elon.disableUI(x,"everything")}else{if(!A){l()}}if(!A.length){l(true)}};var l=function(B){if(x.m_copiesCB){x.m_copiesCB.finish();delete x.m_copiesCB}p(B)};var k=function(B){elon.elon.setDbgMsg("SoapSubmitQueueObject caught an exception while trying to submit data:\n\n"+B.message)};var v=function(C){var H={};for(var B in {Drv_Dp_Cfg:1,Drv:1}){for(var I in C.out[B].Set){if(I.match(/LON_/)){for(var E=0;E<C.out[B].Set[I].length;E++){var K=C.out[B].Set[I][E];if(!H[I]){H[I]=[]}H[I].push(K)}}}}var G=C.out.Gen.Set.Dp_Ref;if(G){for(var E=0;E<G.length;E++){for(var D=0;D<G[E].DataPoint.length;D++){var J;if(G[E].DataPoint[D].UCPTserviceType.get().match(/^ST_LON/)){if(!H.LON_Dp_Cfg){H.LON_Dp_Cfg=[]}J=true;H.LON_Dp_Cfg.push(n.getItem({url:G[E].r_proxy_url,Item:G[E].DataPoint[D].UCPTname.get()}))}if(J){H.LON_Dp_Cfg.push(n.getItem({url:G[E].r_proxy_url,Item:G[E].UCPTname.get()}))}}}}for(var I in H){if(!x.m_LonCopiesCB){x.m_copiesCB=g()}r.listLonCopies(I,H[I],x.m_copiesCB.addLonCopyCB)}var F={};for(var I in C.out.Gen.Set){for(var E=0;E<C.out.Gen.Set[I].length;E++){var K=C.out.Gen.Set[I][E];if((elon.filter.nameToGenericType(K.UCPTname.get())=="Fb")||!((elon.filter.annotationType(K.UCPTannotation.get())||"").match(/^LON_/))){continue}if(!F[I]){F[I]=[]}F[I].push(K)}}for(var I in F){if(!x.m_LonCopiesCB){x.m_copiesCB=g()}r.listCopies(F[I],x.m_copiesCB.addCopyCB)}if(x.m_copiesCB){x.m_copiesCB.addOriginal(F)}};var g=elon.Class({constructor:function(){this.m_lon=[];this.m_gen=[]},"public":{"callback:addCopyCB":function(B){if(this.m_finished){this.m_distribute(B)}else{this.m_gen=this.m_gen.concat(B)}},"callback:addLonCopyCB":function(B){if(this.m_finished){this.m_sync(B)}else{this.m_lon=this.m_lon.concat(B)}},finish:function(){this.m_finished=true;this.m_sync(this.m_lon);this.m_distribute(this.m_gen)},addOriginal:function(D){this.m_ori={};for(var C in D){for(var B=0;B<D[C].length;B++){this.m_ori[D[C][B].UCPTname.get()]=D[C][B]}}}},"private":{m_sync:function(B){for(var C=0;C<B.length;C++){var D=n.getItem({url:B[C].r_proxy_url,type:"LON_Network_Command_Invoke",Item:B[C].UCPTname.get(),mute:true,"volatile":true,unmanaged:true});D.Command.set("Syncronize");D.UCPTannotation.set(';action="Sync"');B[C]=D}n.distribute({Item:B,callback:function(){}},"InvokeCmd")},m_distribute:function(B){for(var C=0;C<B.length;C++){n.copy({noPreprocessing:true,Item:this.m_ori[B[C].UCPTname.get()],copy:{Item:B[C],mute:true}})}n.distribute({Item:B,callback:function(){}},"Set")}}});this.remove=function(B){this.m_rmFromQueues(B,"del")};this.purge=function(B){this.m_rmFromQueues(B,"purge")};this.m_rmFromQueues=function(C,D){if(j.isEmpty()&&i.isEmpty()){return}for(var B=0;B<C.length;B++){delete C[B].r_proxy_tainted;i[D](C[B]);j[D](C[B])}if(h()){w.value.set("false",this);p(true)}};this.List=function(B,C){return i.List(B,C)};this.changeCB=function(B){if(B.m_proxy_noSubmit==true){return}if(B.m_proxy_noSubmitOnce==true){return delete B.m_proxy_noSubmitOnce}if(q.cached(B)){q.del(B);return}i.add(B);B.r_proxy_tainted=true;this.m_setSubmitRequired()};this.rename=function(C,B){if(i.del(C,B)){i.add(C)}};this.setSubmitRequired=function(B){if(B||!m){w.value.set("true",this);w.style[0].y_proxy_set({field:"fontWeight",value:"bold"},this)}else{w.value.set("false",this);w.style[0].y_proxy_set({field:"fontWeight",value:"normal"},this)}};this.m_setSubmitRequired=function(){if(!m){return}m=false;this.setSubmitRequired()};this.reset=function(){d(c,[false,u]);i.each(function(B,C){if(C){q.add(B);B.y_proxy_copy(C);delete B.r_proxy_tainted}else{n.purgeFromCache({Item:B})}});p(true)};this.submitAll=function(B){s(null,null,null,B)};var h=function(){return i.isEmpty()&&j.isEmpty()&&!z.length};var p=function(B){i=Echelon.SoapObjCache.getInstance();j=Echelon.SoapObjCache.getInstance();c=[];z=[];if(!B){o=[]}m=true;x.setSubmitRequired();Echelon.SoapServerObject.clearTmpObj()};this.isEmpty=function(){return m};this.addUpdate=function(B,C){i.add(B,C)};this.addCallback=function(B){c.push(B)};this.cancelSubmitCallback=function(B){for(var C=0;C<c.length;C++){if(c[C]==B){c.splice(C,1);break}}};this.addPostSubmitCallback=function(B,C){(C?a:o).push(B)};this.cancelPostSubmitCallback=function(B,E){var C=E?a:o;for(var D=0;D<C.length;D++){if(C[D]==B){C.splice(D,1);break}}};this.addSubmitOp=function(B){z.push(B);this.m_setSubmitRequired()};this.cancelSubmitOp=function(B){for(var C=0;C<z.length;C++){if(z[C]==B){z.splice(C,1);break}}if(h()){w.value.set("false",this);p(true)}};this.addDeletion=function(C){for(var B=0;B<C.length;B++){j.add(C[B])}this.m_setSubmitRequired()};this.queued=function(B){return i.cached(B)};this.deleted=function(B){return j.cached(B)};var u=function(C,B,D){b++;if(b<e){return}if(A.length){y()}else{d(o,[C,B,D]);a=d(a,[C,B,D]);elon.elon.enableUI(x,"everything");p()}};var d=function(D,C){var B=[];var F=elon.ExceptionHandler();for(var E=0;E<D.length;E++){if(F.call(D[E],C)){B.push(D[E])}}return B};n.subscribe({Item:w,callback:s,noInitialCallback:true,id:"persistent",subscriptionId:this})};Echelon.SoapSubmitQueueObject.getInstance=function(){if(Echelon.SoapSubmitQueueObject.instance==null){Echelon.SoapSubmitQueueObject.instance=new Echelon.SoapSubmitQueueObject()}return Echelon.SoapSubmitQueueObject.instance};Echelon.SoapSubmitQueueObject.instance=null;Echelon.SoapMessageObject=function(){this.soapCall=function(i){return Echelon.SoapInterface().call(a(i),"http://wsdl.echelon.com/web_services_ns/ilon100/v"+(i.version||"4.0")+"/action/"+i.method,elon.elon.httpS(i.url,i.ssl),(new l(i)).callback,i.translator||i.id,i.auth)};elon.WSDLComplexTypes.SoapMessage={type:"SoapMessage",attributes:[{min:"1",max:"1",name:"xmlns",type:"string",defaultVal:"http://schemas.xmlsoap.org/soap/envelope/"},{min:"1",max:"1",name:"xmlns:xsi",type:"string",defaultVal:"http://www.w3.org/2001/XMLSchema-instance"},{min:"1",max:"1",name:"encodingStyle",type:"string",defaultVal:"http://schemas.xmlsoap.org/soap/encoding/"}],content:[{min:"1",max:"1",name:"Header",type:{content:[{min:"1",max:"1",name:"messageProperties",type:"messageProperties"}]}},{min:"1",max:"1",name:"Body",type:{content:[{min:"0",max:"1",name:"Fault",type:{content:[{min:"1",max:"1",name:"faultcode",type:"int"},{min:"1",max:"1",name:"faultstring",type:"string"}]}}]}}]};var q={ilon:"http://wsdl.echelon.com/web_services_ns/ilon100/v4.0/message/",lnsInternal:"http://wsdl.echelon.com/ws/lnsProxyInternal/v4.0/",admin:"http://www.echelon.com/es/connman/ws/v4.0/message/",upgrade:"http://www.echelon.com/es/upgrade/ws/v4.0/message/",eesBase:"http://www.echelon.com/es/ws/v4.0/message/"};var h=function(t,i){elon.WSDLComplexTypes.SoapMessage.content[1].type.content.push({min:"0",max:"1",name:i[t+"Method"],type:{attributes:[{min:"1",max:"1",name:"xmlns",type:"string",defaultVal:q.ilon},{min:"0",max:"1",name:"xmlns:admin",type:"string"},{min:"0",max:"1",name:"xmlns:eesBase",type:"string"},{min:"0",max:"1",name:"xmlns:lnsInternal",type:"string"},{min:"0",max:"1",name:"xmlns:upgrade",type:"string"}],content:((i[t+"Name"]&&i[t+"Type"])?[{min:"0",max:"1",name:i[t+"Name"],type:i[t+"Type"]}]:null)}})};for(var o in elon.WSDLSoapCalls){for(var k in {request:1,response:1}){h(k,elon.WSDLSoapCalls[o])}}elon.WSDLComplexTypes.messageProperties.attributes=[{min:"1",max:"1",name:"xmlns",type:"string",defaultVal:q.ilon}];var f=Echelon.SoapFactoryObject.getInstance().getConstructor("SoapMessage");var s=new RegExp("Invoke|_Data$");var a=function(u){var y=new f().m_proxy_initAll();y.Header().messageProperties();if(u.properties){y.Header.messageProperties=u.properties}var t=elon.WSDLSoapCalls[u.method];var A=y.Body()[t.requestMethod]();if(u.Item!=null){if(u.Item.r_proxy_type==null){A[t.requestName].set(u.Item)}else{if(u.Item.Item&&Echelon.SoapSubmitQueueObject.instance){var x={};for(var w=0;w<u.Item.Item.length;w++){x[u.Item.Item[w].m_proxy_ns]=true;if(u.Item.Item[w].r_proxy_type.match(s)){Echelon.SoapSubmitQueueObject.instance.remove([u.Item.Item[w]])}}}A[t.requestName]=u.Item}}if(u.version){var v="http://wsdl.echelon.com/web_services_ns/ilon100/v"+u.version+"/message/";y.Header.messageProperties.xmlns.set(v);y.Body[u.method].xmlns.set(v)}if(u.namespace){if(!x){x={}}for(var w=0;w<u.namespace.length;w++){x[u.namespace[w]]=true}}if(x){delete x.ilon;if(x.admin||x.upgrade){x.eesBase=true}}for(var w in x){y.Body[u.method]["xmlns:"+w].set(q[w])}var z=y.m_proxy_encode("Envelope");return'<?xml version="1.0" encoding="utf-8" ?>'+z};var l=function(i){var t=i;this.callback=function(u,v){e(u,v,t)}};var r=[];r[401]="Unauthorized";r[404]="Not found";r[408]="Request Timeout";r[500]="Internal server error";r[501]="Not implemented";r[502]="Bad gateway";r[503]="Service unavailable";r[504]="Gateway timeout";r[505]="HTTP version not supported";r[12001]="out of handles";r[12002]="timeout";r[12003]="extended error";r[12004]="internal error";r[12005]="invalid URL";r[12006]="unrecognized scheme";r[12007]="name not resolved";r[12008]="protocol not found";r[12009]="invalid option";r[12010]="bad option length";r[12011]="option not settable";r[12012]="shotdown";r[12013]="incorrect user name";r[12014]="incorrect password";r[12015]="login failure";r[12016]="invalid operation";r[12017]="operation cancelled";r[12018]="incorrect handle type";r[12019]="incorrect handle state";r[12020]="not proxy request";r[12021]="registry value not found";r[12022]="bad registry parameter";r[12023]="no direct access";r[12024]="no context";r[12025]="no callback";r[12026]="request pending";r[12027]="incorrect format";r[12028]="item not found";r[12029]="cannot connect";r[12030]="connection aborted";r[12031]="connection reset";var e=function(x,F,w){if((F!=200)&&!w.noRetry){var A=F.faultCode?"m_soapMsgRetry":"m_soapMsgRetry2";var I="";var L=true;if(!w[A]){w[A]=0}var y=[];y[401]=r[401];y[404]=r[404];y[408]=r[408];y[503]=r[503];if(w[A]<((F.faultCode||(F&&y[F]))?2:100)){w[A]++;I="Retry: "+w[A]+"; "+(F.faultCode?2:100);if(F.faultCode){Echelon.SoapMessageObject.getInstance().soapCall(w)}else{var z=Echelon.SoapMessageObject.getInstance();elon.util.callback.fireDelayedFunction(z.soapCall,500,z,w)}}else{L=false;I="Giving up (You might have to refresh your browser before continuing).";delete w.m_soapMsgRetry;delete w.m_soapMsgRetry2}var u=F.faultString?F.faultString:F;var C="";if(!F.faultString){C=(u>=12000)?" - client side":" - server side"}if(r[u]){C+=": "+r[u]}if((w[A]<3)||!L){m("Http error ("+u+C+') in soap communication with "'+w.url+'". '+I,w,null,L)}return}else{delete w.m_soapMsgRetry;delete w.m_soapMsgRetry2}if(x){if(x.parseError&&(x.parseError.errorCode!=0)){m("Xml parse error in soap response, parse error code: "+x.parseError.errorCode,w);return}try{var E=elon.WSDLSoapCalls[w.method].responseMethod;var J=elon.WSDLSoapCalls[w.method].responseName}catch(M){throw new Error('Invalid soap call "'+w.method+'" in Echelon.SoapMessageObject.responseCB')}try{var B={};var v=new Date().getTime();Echelon.SoapDenCoders.parseXmlComplex(x.lastChild,B,"Envelope",null,{create:f},(w.unmanaged==true)?false:true,w.url,w.id,v);J=B.Envelope.Body[E][J];if(B.Envelope.Body.Fault.faultcode){m('WebService reports: "'+B.Envelope.Body.Fault.faultstring.get()+'"',w,B.Envelope.Body.Fault.faultcode.get());return}var H=B.Envelope.Header.messageProperties}catch(M){m("Invalid soap response or web UI internal error",w);return}if(!j[w.url]){p(x,w,E)}if(J&&J.fault&&J.fault.faultcode){var K=J.fault.faultcode.get();var t=J.fault.faultstring.get();if(K==22052&&t.search("Activate Enterprise Services")>-1&&!elon.lnsMissingLicenseMsgDisplayed){elon.lnsMissingLicenseMsgDisplayed=true;alert(t)}if((K!=12)&&(K!=14)&&(K!=22023)&&(K!=22040)&&(K!=22047)){m('WebService reports: "'+J.fault.faultstring.get()+'"',w,J.fault.faultcode.get());return}}if(J&&J.Item){var D=J.UCPTfaultCount.get();for(var G=0;G<J.Item.length;G++){J.Item[G].m_proxy_notify(null,H);if(D&&J.Item[G].fault.faultstring&&!{"14":1,"6":1}[J.Item[G].fault.faultcode.get()]){if((J.Item[G].fault.faultcode.get()=="44")&&w.id){J.Item[G].fault.faultstring.m_value=w.id.translate("ILON_FAULT_12")}d(J.Item[G].fault.faultstring.get(),w,J.Item[G],J.Item[G].fault.faultcode.faultType.get()=="_warning",J.Item[G].UCPTname.get())}delete J.Item[G].m_proxy_msg}}elon.ExceptionHandler().call(w.callback,[J,null,H],w);g(w)}else{if((elon.browser.IE6||elon.browser.IE7)&&!c){c=true;alert('The security preferences of this browser do not allow access to the SmartServer. To enable access, go to the Tools menu --> Internet Options --> Security Tab, and add the URL for the SmartServer as Trusted Sites. Also go to Tools menu --> Internet Options --> Security --> Custom Level --> Miscellaneous and set "Run ActiveX controls and plug-ins" and "Script ActiveX controls marked safe for scripting" to "Enable". Then refresh the browser (Press <F5>).')}}};var c=false;var j={};var p=function(w,y,t){var z;try{if(elon.browser.IE){z=w.xml.match(/xmlns(:\w+)?="(http:\/\/wsdl\.echelon\.com[^"]+)"/i)[2]}else{var u={Envelope:window.NodeFilter.FILTER_ACCEPT,Body:window.NodeFilter.FILTER_ACCEPT};u[t]=window.NodeFilter.FILTER_ACCEPT;var i=w.documentElement.ownerDocument.createTreeWalker(w,window.NodeFilter.SHOW_ELEMENT,{acceptNode:function(v){return u[v.localName]||window.NodeFilter.FILTER_REJECT}},false);for(o=0;o<3;o++){i.nextNode()}z=i.currentNode&&i.currentNode.namespaceURI}}catch(x){}if(!z){return n(z,y)}var A=/\/web_services_ns\/ilon100\/v(\d\.\d)\/message/i;var B=z.match(A);if(!z){return n(z,y)}B=B[1];if(!B){return n(z,y)}B=parseFloat(B,10);if(B<4){return n(z,y)}j[y.url]=B};var n=function(t,i){j[i.url]=false;elon.elon.setErrMsg(elon.Error.getInstance(elon.ErrorTable.getInstance().ERR_WARN_MESSAGE,{msg:'The soap destination "'+i.url+'" responds in an unsupported namespace "'+t+'"'}))};var b=function(i){if(!i.Item||(typeof(i.Item)=="string")){return null}return i.Item.length?i.Item:((i.Item.Item&&i.Item.Item.length)?i.Item.Item:null)};var g=function(t){var v=b(t);if(v&&(typeof(v)!="string")){for(var u=0;u<v.length;u++){delete v[u].m_proxy_msg}}};var d=function(C,B,z,A,t){if(typeof(z)!="string"){var x=b(B);if(z.m_proxy_msg){z=z.m_proxy_msg}else{if(x){for(var y=0;y<x.length;y++){if((x[y].UCPTname.get()==z.UCPTname.get())&&x[y].m_proxy_msg){z=x[y].m_proxy_msg;break}}}}}if(typeof(z)!="string"){z=""}var v=elon.ErrorTable.getInstance();var u=B.msg?[B.msg]:[];if(z){u.push(z)}u=u.join(", ");C=(t?("["+t+"] "):"")+(u?("Failed: "+u+". Reason: "):"")+C;var w=elon.Error.getInstance(A?v.ERR_WARN_MESSAGE:v.ERR_ERR_MESSAGE,{msg:C});if(!B.noErrMsg){elon.elon.setErrMsg(w)}return w};var m=function(x,t,w,A){var z=[];var y=b(t);if(y&&(typeof(y)!="string")){for(var u=0;u<y.length;u++){if(y[u].m_proxy_msg){z.push(y[u].m_proxy_msg);delete y[u].m_proxy_msg}}}z=z.join(", ");var v=d(x,t,z,A);if(!t.m_soapMsgRetry&&y&&(typeof(y)!="string")&&!t.noErr){for(var u=0;u<y.length;u++){y[u].m_proxy_notify(v,null)}}if(!t.m_soapMsgRetry&&!t.noErr&&!A){elon.ExceptionHandler().call(t.callback,[null,v,null],t)}g(t)}};Echelon.SoapMessageObject.getInstance=function(){if(Echelon.SoapMessageObject.instance==null){Echelon.SoapMessageObject.instance=new Echelon.SoapMessageObject()}return Echelon.SoapMessageObject.instance};Echelon.SoapMessageObject.instance=null;Echelon.SoapInterface=elon.Class({base:{m_xmlHttp:Echelon.XmlHttp},constructor:function(){this.m_xmlHttp("responseXML")},"public":{call:function(e,d,a,f,b,c){this.f_init(arguments,"POST",a,f,b)}},"protected":{f_call:function(f,d,a,h,b,c){try{this.f_xmlHttp.setRequestHeader("SOAPAction",d);this.f_xmlHttp.setRequestHeader("MessageType","CALL");this.f_xmlHttp.setRequestHeader("Content-Type","text/xml; charset=utf-8");if(c){this.f_xmlHttp.setRequestHeader("Authorization","Basic "+elon.util.encodeBase64(c.login+":"+c.password))}this.f_xmlHttp.send(f)}catch(g){this.f_cb(undefined,this.f_errObj("ERR_WSCLI_ACCESS_DENIED"))}return f}}});Echelon.XmlFetcher=elon.Class({base:{m_xmlHttp:Echelon.XmlHttp},constructor:function(){this.m_xmlHttp("responseXML")},"public":{get:function(a,b){this.f_init(arguments,"GET",a,b)}},"protected":{f_call:function(a,c){try{this.f_xmlHttp.setRequestHeader("Content-Type","text/xml; charset=utf-8");this.f_xmlHttp.send(null)}catch(b){this.f_cb(undefined,this.f_errObj("ERR_WSCLI_ACCESS_DENIED"))}}}});Echelon.getXmlFromServer=function(b,c,a){new Echelon.XmlFetcher().get(b,c,a)};elon.provide("soapProxy",document);