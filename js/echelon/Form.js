Echelon.viewValueProperties=elon.Class({constructor:function(a){this.m_obj=a;this.m_unitNode=a.argObj.unitNode;this.m_showUnit=a.argObj.elon_show_unit||a.argObj.unitNode||false;this.m_showValueDef=a.argObj.elon_show_value_def||false},"public":{showUnitAndValOrDef:function(g,a){var c="";var h=true;if(this.m_showValueDef&&!a.argObj.elon_local_value_defs&&!(this.m_obj.f_dpHandler&&this.m_obj.f_dpHandler.lonFormatRead&&this.m_obj.f_dpHandler.lonFormatRead.split(".").length>2)){c="UCPTvalueDef"}else{if(this.m_obj.f_dpHandler){c=this.m_obj.f_dpHandler.lonFormatRead;if(c){h=false}}}var b=elon.util.getUCPTvalueObj(g,c,h);if(b){var f=a.round(b.get());if(this.m_showUnit){this.unit=a.argObj.elon_unit||b.Unit.get()||"";if(this.m_unitNode){this.m_unitNode.innerHTML="&nbsp;"+this.unit}else{if(this.m_obj.viewObjType=="showvalue"){return f+"&nbsp;"+this.unit}else{if(a.argObj.unitNode!=false){try{this.m_unitNode=(this.m_obj.domObj.parentNode.lastChild.tagName=="SPAN")?this.m_obj.domObj.parentNode.lastChild:this.m_obj.domObj.parentNode.insertBefore(this.m_obj.domObj.ownerDocument.createElement("SPAN"),this.m_obj.domObj.nextSibling);this.m_unitNode.innerHTML="&nbsp;"+this.unit}catch(d){}}}}}return f}else{return"- - -"}}}});Echelon.Form=elon.Class({base:{m_view:elon.View},constructor:function(b,a){if(b.elon_disable_range==null){b.elon_disable_range="object"}this.m_view(b);b.domObj.tabIndex=1;if(this.f_modifyDomObj){this.f_modifyDomObj(b.domObj)}delete this.disableSpecifics;if(this.f_iconPlaceObj==null){this.f_iconPlaceObj=this.domObj}this.uiEvent=a;if(b.elon_local_value_defs&&b.elon_value_def_arr){b.elon_options=this.m_customValDefArrToOptions(b.elon_value_def_arr)}if(b.elon_options){this.m_parseOptions()}if(b.elon_name!=null||b.elon_alias_name!=null){this.f_dpHandler=Echelon.formObjectDpHandler(this,a)}else{if(b.elon_webdpname!=null){this.f_webHandler=Echelon.formObjWebDp(this,a)}}if(b.callback){this.addEvent(this.uiEvent,b.callback)}if(b.onchange){this.m_callback=b.onchange;this.addEvent(this.uiEvent,this.m_valueChangeCallback)}if(b.elon_value_type){this.setValueType(b.elon_value_type)}if(b.hasOwnProperty("value")){this.setValue(b.value)}},"public":{setOptions:function(a){this.f_options=this.m_options=a},getOptions:function(){return this.f_options},setValue:function(b,c){var d=b;if(this.argObj.elon_show_value_def&&this.m_options){for(var a in this.m_options){if(this.m_options[a]==d){d=a;break}}}this.f_setValue(d,c)},getValue:function(){var a=(this.m_options&&this.m_options[this.getText()])?this.m_options[this.getText()]:this.f_getValue();return a},"callback:m_valueChangeCallback":function(a){this.m_callback(this.getValue())},setClassName:function(a){this.domObj.className=a},disableSpecifics:function(a){},m_parseOptions:function(){var opts={};if(typeof(this.argObj.elon_options)=="string"){var eo=eval(this.argObj.elon_options);for(var i=0;i<eo.length;i++){opts[eo[i][0]]=eo[i][1]}}else{opts=this.argObj.elon_options}this.setOptions(opts)},setPointName:function(a){this.argObj.elon_name=a;if(!this.f_dpHandler){this.f_dpHandler=Echelon.formObjectDpHandler(this,this.uiEvent)}else{this.f_dpHandler.m_init()}},validate:function(){var b=elon.ValidationObject.getInstance();var a;var c=this.f_valueType;if(c=="doubleFloatPos"){a=b.validateDoubleFloatPos(this.getValue())}else{if(c=="doubleFloat"){a=b.validateDoubleFloat(this.getValue())}else{if(typeof(c)=="function"){a=c(this.getValue())}else{if(b["validate"+c]){a=b["validate"+c](this.getValue())}else{a=true}}}}if(a){this.clearError();this.callEventFunctions({type:"valueChange",viewObject:this});return true}else{this.setError();try{this.domObj.focus()}catch(d){}return false}},setError:function(){},clearError:function(){this.resetColor();this.domObj.defaultValue=this.getValue()},resetColor:function(){},f_setMultiple:function(a){this.setValue(a+" (Multiple)");this.domObj.style.color="gray"},f_resetMultiple:function(){this.domObj.style.color="black";this.setValue((this.getText()||"").replace(new RegExp(" \\(Multiple\\)$"),""),true)},setMultiple:function(b,a){if(!a){this.resetMultiple();this.setValue(this.round(b));return}this.f_setMultiple(b);this.m_multHandler=true;this.addEvent("f_resetMultipleEvent"||"click",this.resetMultiple)},"callback:resetMultiple":function(a){if(!this.m_multHandler){return}delete this.m_multHandler;this.f_resetMultiple();this.removeEvent("f_resetMultipleEvent"||"click",this.reseMultiple);if(a){this.callEventFunctions({type:this.uiEvent,viewObject:this})}},round:function(a){return(this.argObj.elon_precision!=null&&!isNaN(Number(a)))?Number(a).toFixed(this.argObj.elon_precision):a},focus:function(){try{this.domObj.focus()}catch(a){}},setStyle:function(b){for(var a in b){if(b[a]!=null){this.domObj.style[a]=b[a]}}},setValueType:function(a){this.f_valueType=a},triggerUiEvent:function(){this.callEventFunctions({type:this.uiEvent,viewObj:this,viewObject:this})}},"private":{m_customValDefArrToOptions:function(b){var a={};for(var c=0;c<b.length;c++){a[b[c].elon_key]=b[c].elon_value}return a}}});Echelon.Form.factory=function(b){if(b.domObj&&b.domObj.currentStyle&&b.domObj.currentStyle.backgroundColor){this.m_backgroundColor=b.domObj.currentStyle.backgroundColor}var a=(Echelon[b.type]||Echelon["view"+b.type+"Object"]).getInstance(b);if(b.options!=null){a.setOptions(b.options)}if(b.style){a.setStyle(b.style)}if(b.rows!=null){a.domObj.rows=b.rows}return a};Echelon.viewFormObject=new elon.Class.Backport(Echelon.Form);Echelon.formObjWebDp=elon.Class({constructor:function(b,d){this.m_formObj=b;b.f_sso.subscribe({Item:b.argObj.elon_webdpname,id:this.m_formObj,type:"FormObj_Cfg",callback:this.m_cfg,noInitialCallback:true});b.f_sso.subscribe({Item:b.argObj.elon_webdpname,id:this.m_formObj,type:"FormObj_Data",callback:this.m_data,noInitialCallback:b.argObj.elon_no_initial_callback});this.m_dat=b.f_sso.getItem({Item:b.argObj.elon_webdpname,type:"FormObj_Data"});if(b.argObj.elon_options){for(var c in b.argObj.elon_options){this.m_dat.value.set(b.argObj.elon_options[c],b.argObj.id);break}var a=b.f_sso.getItem({Item:b.argObj.elon_webdpname,type:"FormObj_Cfg"});for(var c in b.argObj.elon_options){a.option.push({label:c,value:b.argObj.elon_options[c]},this)}}b.addEvent(d,this.ui);if(d!="click"){b.addEvent("click",this.m_rmMulti)}},"public":{"callback:ui":function(){if(this.m_formObj.domObj.disabled){return}if(this.m_dat.value.multiple.get()){this.m_formObj.f_resetMultiple()}this.m_dat.value.set(this.m_formObj.getValue(true),this.m_formObj);if(this.m_dat.value.multiple.get()){this.m_dat.value.multiple.set(false)}}},"private":{"callback:m_rmMulti":function(){if(this.m_dat.value.multiple.get()){this.ui()}},"callback:m_cfg":function(b){var a=this.m_formObj.getValue(true);var g={};var e={};var c={};var f=false;for(var d=0;d<b.option.length;d++){g[b.option[d].label.get()]=b.option[d].value.get();if(a==b.option[d].value.get()){f=true}if(b.option[d].disabled.get()){e[b.option[d].value.get()]=true}if(b.option[d].img.get()){c[b.option[d].value.get()]=b.option[d].img.get()}}this.m_formObj.setOptions(g,e,c);this.m_formObj.setValue(a)},"callback:m_data":function(b){if(b.disabled.get()!=null){this.m_formObj.f_disableUI(b.disabled.get(),"FormObj_Data")}if(b.visible.get()!=null){if(b.visible.get()){this.m_formObj.show()}else{this.m_formObj.hide()}}if(b.valueType.get()!=null){this.m_formObj.setValueType=b.valueType.get()}if(b.className.get()!=null){this.m_formObj.domObj.className=b.className.get()}for(var a=0;a<b.style.length;a++){if(!this.m_formObj.argObj.fixedWidth||(b.style[a].field.get()!="width")){this.m_formObj.domObj.style[b.style[a].field.get()]=b.style[a].value.get()}}var c=b.value.get();if(c==null){c=this.m_formObj.argObj.defaultValue}if(c!=null){this.m_formObj.setMultiple(c,b.value.multiple.get())}else{this.m_formObj.clear()}if(b.error.get()!=null){this.m_formObj[b.error.get()?"setError":"resetColor"]()}}}});Echelon.formObjectDpHandler=elon.Class({constructor:function(a,b){a.setValue("- - -");this.m_almObj=null;this.m_prioObj=null;this.m_iconHandler=new this.m_iconCbHandler(this);this.m_iconLayout=a.argObj.elon_icon_layout||"hover";this.m_suspensionReasons={};this.readOnly=false;this.m_lastRead=false;this.m_lastCfg=false;this.lonFormatRead=null;this.m_lonformatWrite=null;this.dpConfig=null;this.m_formObj=a;a.addEvent(b,this.m_write);this.f_valueProps=new Echelon.viewValueProperties(a);this.m_formObj.f_disableUI(true,"Initialization");this.m_formObj.domObj.noSubmit=true;this.m_init()},"public":{m_init:function(){var c=elon.UtilObject.getInstance();var a=this.m_formObj.argObj;if(a.elon_lonformat){a.elon_lonformat=c.ensureLonFormatPrefix(a.elon_lonformat)}if(a.elon_feedback_lonformat){a.elon_feedback_lonformat=c.ensureLonFormatPrefix(a.elon_feedback_lonformat)}if(a.elon_readonly!=null){this.readOnly=a.elon_readonly}if(a.elon_feedback_name!=null||a.elon_feedback_alias_name!=null){if(a.elon_name!=null){this.outputDataPoint=a.elon_name;this.m_startPollingOutputDpData()}else{this.m_formObj.f_disableUI(true,"FeedbackAlias");this.m_formObj.f_sso.Get({xSelect:'//Item[@xsi:type="Dp_Cfg"][UCPTaliasName="'+a.elon_alias_name+'"]',callback:this.m_handleWriteDpCfg})}}this.priority=255;var b=a.elon_priority;if(b!=null&&b!=""){if(b=="adaptive"||b=="initial"){this.priority=b}else{this.priority=Number(a.elon_priority);if(isNaN(this.priority)){this.priority=255}else{if(this.priority<0){this.priority=0}else{if(this.priority>255){this.priority=255}}}}}if(this.readOnly){this.m_formObj.f_disableUI(true,"ReadOnly")}else{this.hasDPwriter=true}this.r_maxAge=a.elon_max_age;this.aliasName=a.elon_feedback_alias_name||a.elon_alias_name;this.pointName=a.elon_dptype?null:(a.elon_feedback_name||a.elon_name);this.lonFormatRead=a.elon_feedback_lonformat||a.elon_lonformat;this.m_lonformatWrite=a.elon_lonformat||"";if(this.dpConfig&&((this.aliasName&&this.dpConfig.UCPTaliasName.get()==this.aliasName)||this.dpConfig.UCPTname.get()==this.pointName)){this.m_config(this.dpConfig)}else{if(a.elon_dptype||a.elon_feedback_dptype){this.initialItemRequested=a.elon_name;this.m_formObj.f_sso.getRemocalItem({type:"generalFb",Item:a.elon_name,callback:this.m_handleInitialItem})}else{if(this.aliasName){this.initialItemRequested=this.aliasName;this.m_formObj.f_sso.List({xSelect:'//Item[@xsi:type="Dp_Cfg"][UCPTaliasName="'+this.aliasName+'"]',callback:this.m_handleInitialItem,noErrMsg:true})}else{this.m_startPollingDpData()}}}},cancelFocus:function(){if(this.m_newValue){this.m_read(this.m_newValue);this.m_newValue=null}},setPriority:function(a){this.priority=a;this.m_updatePrioIcon()},setConfigError:function(a){this.m_configError=a;this.m_updateAlarmIcon()},suspendUpdates:function(a){this.m_suspensionReasons[a]=true},continueUpdates:function(b,a){if(this.m_suspensionReasons[b]){delete this.m_suspensionReasons[b];if(a&&this.m_lastRead&&!elon.util.hasProps(this.m_suspensionReasons)){this.m_read(this.m_lastRead)}}}},"private":{"callback:m_handleInitialItem":function(a,d,h){var c;if(a){if(a.Item){if(a.Item.length){c=a.Item[0]}}else{c=a}}if(c){if(c.r_proxy_type.search("Cfg")>=0){var b=this.m_formObj.argObj.elon_feedback_dptype;var f=this.m_formObj.argObj.elon_dptype;for(var g=0;g<c.DataPoint.length;g++){var j=c.DataPoint[g].dpType.get();var e=c.DataPoint[g].UCPTname.get();if(b){if(j==b){this.pointName=e}if(j==f){this.outputDataPoint=e}}else{if(j==f){this.pointName=e}}}}else{this.pointName=c.UCPTname.get()}this.m_startPollingDpData()}else{if(!d){this.m_unknownDatapoint.call(this,this.initialItemRequested)}}},m_subscribeCfg:function(){this.m_formObj.f_sso.subscribe({type:"Dp_Cfg",Item:this.pointName,callback:this.m_config,maxAge:10})},"callback:m_handleWriteDpCfg":function(c,b,a){if(c&&c.Item&&c.Item.length){this.m_formObj.f_enableUI(true,"FeedbackAlias");this.outputDataPoint=c.Item[0].UCPTname.get();this.m_startPollingOutputDpData()}else{if(!b){this.m_unknownDatapoint.call(this,this.aliasName)}}},"callback:m_read":function(f,c){if(this.m_formObj.domObj.parentNode==null){return}if(f!=null){this.m_lastRead=f}this.updateIcons(f);if(!f){return}var a=this.m_formObj.argObj.elon_force_round_to_preset||!this.m_formObj.argObj.noOptionsRequired;if(!this.m_lastCfg&&a){this.m_subscribeCfg()}else{this.m_newValue=null;try{var b=this.m_formObj.domObj.ownerDocument.activeElement;if(!c&&b&&{textarea:1,text:1}[b.type]&&this.m_formObj.hasFocus()){this.m_newValue=f;return}}catch(d){}if(this.m_timeOfLastWrite){if(f.UCPTlastUpdate.getTime()>=this.m_timeOfLastWrite){this.m_stopWaitingForFeedback()}}if(elon.util.hasProps(this.m_suspensionReasons)){return}if(this.m_formObj.argObj.elon_force_round_to_preset){this.m_lastSetValue=this.m_roundToPreset(f)}else{this.m_lastSetValue=this.f_valueProps.showUnitAndValOrDef(f,this.m_formObj)}this.m_formObj.setValue(this.m_lastSetValue);if(!f.fault||!f.fault.faultcode||f.fault.faultcode.get()!=14){this.m_formObj.f_enableUI(true,"Initialization")}}},m_roundToPreset:function(e){var a=this.f_valueProps.showUnitAndValOrDef(e,this.m_formObj);var d;if(e){if(this.m_isValueDef(a)){return a}var c=Number(a);if(!isNaN(c)){if(this.m_formObj.argObj.elon_local_value_defs){d=this.m_getClosest(this.m_formObj.argObj.elon_value_def_arr||this.m_formObj.argObj.elon_img_arr,c,function(f){return Number(f.elon_value)},function(f){return f.elon_key||Number(f.elon_value)})}else{if(this.dpConfig&&elon.util.isScalar(this.dpConfig.UCPTbaseType.get())){for(var b=0;b<e.UCPTvalue.length;b++){if(e.UCPTvalue[b].LonFormat.get().replace(/#8000010128000000\[4\]\./,"")=="UCPTvalueDef"){return e.UCPTvalue[b].get()}}if(this.dpConfig.ValueDef&&this.dpConfig.ValueDef.length>0){d=this.m_getClosest(this.dpConfig.ValueDef,c,function(f){return f.UCPTvalue.get()},function(f){return f.UCPTname.get()})}}}}}return(d==null)?a:d},m_isValueDef:function(d){if(d==null){return false}var c=this.m_formObj.getOptions();if(c){for(var b in c){if(c[b]==d){return true}}}var a=this.m_formObj.argObj.elon_value_def_arr||this.m_formObj.argObj.elon_img_arr;if(a){for(var b=0;b<a.length;b++){if(d==a[b].elon_value_def){return true}}}return false},m_getClosest:function(d,b,a,h){var j=Number.MAX_VALUE;var g=null;var f,e;for(var c=0;c<d.length;c++){e=Number(a(d[c]));if(!isNaN(e)){f=Math.abs(e-b);if(f<j){j=f;g=c}}}return(g==null)?null:h(d[g])},m_toOptions:function(b){var a={};for(var c=0;c<b.length;c++){a[b[c].UCPTname.get()]=b[c].UCPTname.get()}return a},"callback:m_enumToOptions":function(g,d,c){var a=new Object();if(g&&g.Member&&g.Member.length){var h=g.Member;for(var b=0;b<h.length;b++){a[h[b].UCPTmemberName.get()]=h[b].UCPTmemberName.get()}}this.m_formObj.setOptions.call(this.m_formObj,a);try{if(this.m_lastSetValue){this.m_formObj.setValue(this.m_lastSetValue)}}catch(f){}},"callback:m_config":function(f,c,b){if(f){f=(f.Item&&f.Item.length)?f.Item[0]:f;if(f&&f.UCPTname&&f.UCPTname.get()!=null){if(f.UCPTaliasName){this.aliasName=f.UCPTaliasName.get()}this.pointName=f.UCPTname.get();this.dpConfig=f;this.m_lastCfg=true;if(!this.m_formObj.argObj.elon_options){var a=this.m_lonformatWrite.split(".");if(a.length>2||(f.UCPTbaseType.get()=="BT_ENUM"&&!f.ValueDef.length)){if(this.m_formObj.argObj.nvtCfg){this.m_handleNvtCfg(this.m_formObj.argObj.nvtCfg)}else{this.m_formObj.f_sso.getRemocalItem({type:"TemplateManager_Cfg",acceptInherited:true,Item:f.UCPTformatDescription.get(),callback:this.m_handleNvtCfg,local:true})}}else{this.m_formObj.setOptions(this.m_toOptions(f.ValueDef))}}if(this.m_formObj.handleConfig){this.m_formObj.handleConfig(f)}if(this.m_lastRead){this.m_read(this.m_lastRead)}return}}if(c&&c.faultCode==2099727){this.m_unknownDatapoint.call(this,this.pointName||this.aliasName)}if(this.aliasName){try{this.m_formObj.domObj.getAttribute("foo");if(!this.retryInterval){this.retryInterval=0}if(this.retryInterval<3600000){this.retryInterval+=Math.random()*(this.m_formObj.argObj.elon_poll_interval*10000||10000)}elon.util.fireDelayedFunction(this.m_init,this.retryInterval,this)}catch(d){}}},m_startPollingDpData:function(){elon.UtilObject.getInstance().pollDp({sso:this.m_formObj.f_sso,dpName:this.pointName,lonFormat:this.lonFormatRead,maxAge:this.r_maxAge,pollInterval:this.m_formObj.argObj.elon_poll_interval,callback:this.m_read,id:this.m_formObj})},m_startPollingOutputDpData:function(){elon.UtilObject.getInstance().pollDp({sso:this.m_formObj.f_sso,dpName:this.outputDataPoint,lonFormat:this.lonFormatRead,maxAge:this.r_maxAge,pollInterval:this.m_formObj.argObj.elon_poll_interval,callback:this.m_updatePrioIconCB,id:this.m_formObj})},"callback:m_handleNvtCfg":function(d,b,a){if(d){var c=this.m_lonformatWrite?elon.util.getNvtMember(d,this.m_lonformatWrite):d;if(c.enum_&&c.enum_.r_proxy_type){this.m_formObj.f_sso.getRemocalItem({type:"TemplateManager_ENUM_Cfg",xSelect:'//Item[@xsi:type="TemplateManager_ENUM_Cfg"]',Item:c.enum_.UCPTreference.get(),callback:this.m_enumToOptions})}}},m_unknownDatapoint:function(a){if(!this.m_almObj){this.m_addIconObjs()}if(this.m_almObj){this.m_showAlarmIcon(this.m_almObj,"ICON_BUG","Unknown Data Point:\n"+(a))}},"callback:m_write":function(h){if(this.readOnly||this.m_formObj.domObj.disabled){return}var c=this.m_formObj.getValue(true);if((c==null)||((this.outputDataPoint==null)&&(this.pointName==null))){return}var b=elon.UtilObject.getInstance();var f=this.m_formObj.f_sso.getItem({type:"Dp_Data",Item:(this.outputDataPoint||this.pointName)});this.writeDp=this.m_formObj.f_sso.getItem({type:"Dp_Data",Item:(this.outputDataPoint||this.pointName),unmanaged:true,mute:true});this.writeDp.UCPTvalue.clear();var a=this.writeDp.UCPTvalue.push();a.LonFormat.set(this.m_lonformatWrite||"");a.set(c);if(this.m_lonformatWrite.split(".").length<=2){var j=this.writeDp.UCPTvalue.push();j.LonFormat.set("UCPTvalueDef");j.set(c)}var d=false;if(this.dpConfig){if(this.dpConfig.ValueDef){for(var e=0;e<this.dpConfig.ValueDef.length;e++){var g=this.dpConfig.ValueDef[e];if(g.UCPTname.get()==c){d=g;break}}}}if(d){a.set(d.UCPTvalue.get());a.LonFormat.set(d.UCPTvalue.LonFormat.get())}if((c==this.m_lastSetValue)||((d!=false)&&(d==this.m_lastSetValue))){return}this.writeDp.UCPTpriority.set(this.priority=="adaptive"?f.UCPTpriority.get():this.priority);this.m_formObj.f_disableUI(true,"Write");this.suspendUpdates("Write");this.m_newValue=null;this.m_attachConstants();this.m_formObj.f_sso.Write({Item:this.writeDp,callback:this.m_handleWrite,unmanaged:true})},m_attachConstants:function(){var c=this.m_formObj.argObj.elon_write_constant_arr;if(c){for(var b=0;b<c.length;b++){var a=this.writeDp.UCPTvalue.push();a.LonFormat.set(c[b].elon_format);a.set(c[b].elon_value)}}else{c=this.m_formObj.argObj.elon_write_constant_obj;if(c){for(var d in c){var a=this.writeDp.UCPTvalue.push();a.LonFormat.set(d.slice(5));a.set(c[d])}}}},"callback:m_handleWrite":function(a,d,k){this.m_formObj.f_enableUI(true,"Write");if(a&&a.UCPTfaultCount&&a.Item){if(a.UCPTfaultCount.get()>0||a.Item.length==0){this.continueUpdates("Write",true);if(this.outputDataPoint){if(a.Item.length&&a.Item[0].fault&&a.Item[0].fault.faultstring&&a.Item[0].fault.faultcode.get()==43){this.m_showAlarmIcon(this.m_prioObj,"ICON_HAND_RED","Data point has high priority");this.m_showIcon(this.m_prioObj)}else{this.m_hideIcon(this.m_prioObj)}}else{this.updateIcons((a.Item&&a.Item.length)?a.Item[0]:null)}}else{this.continueUpdates("Write",false);var m=a.Item[0];var b=elon.UtilObject.getInstance();var h=a.Item[0].UCPTname.get();var l=this.m_formObj.f_sso.getItem({type:"Dp_Data",Item:h});this.m_formObj.f_sso.mute({Item:l});var c;for(var g=0;g<m.UCPTvalue.length;g++){var f=m.UCPTvalue[g].LonFormat.get();if(f.replace(/#8000010128000000\[4\]\./,"")=="UCPTvalueDef"){c=g}var j=b.getUCPTvalueObj(l,f,false);if(j){j.set(m.UCPTvalue[g].get())}}for(var g=0;g<l.UCPTvalue.length;g++){if(l.UCPTvalue[g].LonFormat.get().replace(/#8000010128000000\[4\]\./,"")=="UCPTvalueDef"){var e=g;break}}if((c!=null)&&(e==null)){l.UCPTvalue.push(m.UCPTvalue[c].get());l.UCPTvalue[l.UCPTvalue.length-1].LonFormat.set("UCPTvalueDef")}else{if((c==null)&&(e!=null)){l.UCPTvalue.remove(e)}}this.m_formObj.f_sso.unmute({Item:l});if(this.pointName==h){this.m_read(l)}else{this.m_timeOfLastWrite=k.UCPTtimeStamp.getTime();this.suspendUpdates("WaitForFeedback");this.m_formObj.f_disableUI(true,"WaitForFeedback");elon.util.fireDelayedFunction(this.m_feedbackTimeout,20000,this,this.m_timeOfLastWrite)}elon.elon.setInfMsg("")}}else{this.continueUpdates("Write",true)}},m_stopWaitingForFeedback:function(){this.m_formObj.f_enableUI(true,"WaitForFeedback");this.m_timeOfLastWrite=null;this.continueUpdates("WaitForFeedback",false)},m_feedbackTimeout:function(a){if(a!=this.m_timeOfLastWrite){return}this.m_stopWaitingForFeedback();this.m_read(this.m_lastRead)},m_iconCbHandler:function(b){var a=b;this.showInfo=function(){return a.m_showDPInfo()};this.hideInfo=function(){return window.status=""};this.resetPrio=function(c){return a.m_resetPrioByHand(c)}},m_addIconObjs:function(a){this.m_almObj=this.m_createIcon(this.placeIconCenter?false:true);this.m_prioObj=this.m_createIcon(true)},updateIcons:function(b){if(!this.m_almObj){this.m_addIconObjs()}this.m_updateAlarmIcon();if(this.m_respObjSmelly(b)){if(this.m_almObj){var a="Error getting data point information";if(b&&(!b.UCPTvalue||b.UCPTvalue.length==0)){a="No UCPTvalue in soap response"}if(b&&b.fault&&b.fault.faultstring){a=b.fault.faultstring.get()}this.m_showAlarmIcon(this.m_almObj,"ICON_BUG",a)}}if(b&&b.UCPTpriority&&this.hasDPwriter&&!this.outputDataPoint){this.m_updatePrioIcon()}},m_respObjSmelly:function(a){return !a||!a.UCPTvalue||a.UCPTvalue.length==0||(a.fault&&a.fault.faultstring&&a.fault.faultstring.get())},m_createIcon:function(f){var a=this.m_formObj.f_iconPlaceObj.parentNode.getElementsByTagName("IMG");for(var c=0;c<a.length;c++){if(a[c].m_iconPlaceObj){return a[c]}}var b=this.m_formObj.domObj.ownerDocument.createElement("IMG");var e;b.style.border="0px";b.style.width="16px";b.style.height="16px";if(this.m_iconLayout=="hover"){var d=this.m_formObj.domObj.ownerDocument.createElement("DIV");d.style.position="absolute";d.style.left="0px";d.style.top="0px";d.style.zIndex=0;d.style.display="none";d.style.width="16px";d.style.height="16px";d.placeLeft=f;this.m_formObj.domObj.ownerDocument.body.appendChild(d);d.appendChild(b);this.m_placeIconObj(d,0);e=d}else{this.m_placeIconObj(null,0);e=b}e.shown=false;elon.UtilObject.getInstance().addEvent(this.m_formObj.domObj,"mouseover",this.m_iconHandler.showInfo,false);elon.UtilObject.getInstance().addEvent(this.m_formObj.domObj,"mouseout",function(){window.status=""},false);this.m_hideIcon(e);e.m_iconPlaceObj=true;return e},m_placeIconObj:function(g,b){var a=this.m_formObj.f_iconPlaceObj;if(this.m_iconLayout=="fixed"){if(!this.m_iconSpan){this.m_iconSpan=a.parentNode.insertBefore(this.m_formObj.doc.createElement("span"),a);this.m_iconSpan.style.whiteSpace="nowrap"}if(!this.m_prioObjInserted&&this.m_prioObj){this.m_iconSpan.insertBefore(this.m_prioObj,a.firstChild);this.m_prioObjInserted=true}if(!this.m_almObjInserted&&this.m_almObj){this.m_iconSpan.appendChild(this.m_almObj);this.m_almObjInserted=true}return}var d=0;var c=0;var h=0;var l=undefined;var f=false;var i=elon.util.pxToNum(g.style.width);var k=elon.util.pxToNum(g.style.height);var m=a.clientWidth;var n=a.clientHeight;var o=elon.dom;try{h=o.getAbsoluteXOffset(a,true);c=o.getAbsoluteYOffset(a,true)}catch(j){}if(g.placeLeft||(m<(2*i))||(n<(2*k))){h-=i}else{if(a.style.width&&a.style.height){h=Math.round(h+(0.5*m)-(0.5*i));c=Math.round(c+(0.5*n)-(0.5*k))}}h=h+b*i;g.style.left=elon.util.addPx((h<0)?0:h);g.style.top=elon.util.addPx((c<0)?0:c);if(l!==undefined){g.style.zIndex=l}},m_showDPInfo:function(){var b=((this.m_formObj.argObj.elon_alias_name||this.m_formObj.argObj.elon_feedback_alias_name)?this.aliasName:this.pointName);var a=this.m_formObj.argObj.elon_feedback_alias_name||this.m_formObj.argObj.elon_feedback_name;if(a){b+=" -> "+a}b+=" -- ";if(this.m_lastRead&&this.m_lastRead.r_proxy_type=="Dp_Data"){b+=this.m_formObj.translate("STATUS")+": "+this.m_lastRead.UCPTpointStatus.get();b+=" "+this.m_formObj.translate("VALUE")+": "+elon.UtilObject.getInstance().getUCPTvalue(this.m_lastRead);if(elon.UtilObject.getInstance().getUCPTvalue(this.m_lastRead,"UCPTvalueDef")){b+=" ("+elon.UtilObject.getInstance().getUCPTvalue(this.m_lastRead,"UCPTvalueDef")+")"}b+=" "+this.m_formObj.translate("PRIORITY")+": "+(!this.outputDataPoint?this.m_lastRead.UCPTpriority.get():(this.outputDpPriority?this.outputDpPriority:this.m_formObj.translate("UNKNOWN")))}else{b+=" ["+this.m_formObj.translate("CANNOT_GET_DP_INFORMATION")+"]"}window.status=b},m_setPriority:function(a){this.priority=a;if(this.m_dpHandlerCfg){this.m_dpHandlerCfg.elon_priority.set(a)}},m_hideIcon:function(a){if(this.m_iconLayout=="hover"){a.style.display="none"}else{a.style.visibility="hidden"}a.shown=false},m_showIcon:function(a){if(this.m_iconLayout=="hover"){a.style.display=""}else{a.style.visibility="visible"}a.shown=true},m_resetPrioByHand:function(a){if(a==null){return}if(this.disabled||a.cancelBubble){return}elon.UtilObject.getInstance().catchEvent(a);var c=this.outputDataPoint?this.outputDataPoint:this.pointName;var b=this.m_formObj.f_sso.getItem({type:"Dp_ResetPrio_Invoke",Item:c,unmanaged:true});b.y_proxy_mute();b.UCPTpriority.set(this.priority);b.y_proxy_unmute();this.m_formObj.f_sso.InvokeCmd({Item:b,callback:function(){},unmanaged:true});return false},m_updatePrioIcon:function(a){if(this.m_formObj.viewObjType=="showvalue"){return}if(!this.m_prioObj){this.m_addIconObjs()}if((!this.m_lastRead&&!a)||(!a&&this.outputDataPoint)){return}if(this.readOnly==false){var b=(a||this.m_lastRead).UCPTpriority.get();if(this.priority=="initial"){this.m_setPriority(b)}if(b!=null){if(this.priority!="adaptive"&&(b<this.priority)){this.m_showAlarmIcon(this.m_prioObj,"ICON_HAND_RED","Data point has high priority")}else{if(b<255){this.m_showAlarmIcon(this.m_prioObj,"ICON_HAND_GREEN","Data point is in manual override mode. Click to reset.",this.m_iconHandler.resetPrio)}else{this.m_hideIcon(this.m_prioObj)}}}else{this.m_hideIcon(this.m_prioObj)}}else{this.m_hideIcon(this.m_prioObj)}this.m_formObj.f_disableUI((this.priority!="adaptive"&&b!=null&&b<this.priority),"Priority")},"callback:m_updatePrioIconCB":function(a){if(!this.m_respObjSmelly(a)){this.m_updatePrioIcon(a)}},m_updateAlarmIcon:function(){if(!this.m_almObj){return}if(this.m_configError){this.m_showAlarmIcon(this.m_almObj,"ICON_BUG",this.m_configError)}else{if(this.m_lastRead&&this.m_lastRead.r_proxy_type=="Dp_Data"&&this.m_lastRead.UCPTpointStatus.get()){var a=this.m_lastRead.UCPTpointStatus.get();switch(a){case"AL_NO_CONDITION":case"AL_CONSTANT":case"AL_NUL":this.m_hideIcon(this.m_almObj);break;case"AL_OFFLINE":this.m_showAlarmIcon(this.m_almObj,"ICON_OFFLINE","Data point is offline");break;case"AL_LOW_LMT_ALM_1":case"AL_HIGH_LMT_ALM_1":this.m_showAlarmIcon(this.m_almObj,"ICON_BELL_ORANGE","Data point has alarm status: "+a);break;default:this.m_showAlarmIcon(this.m_almObj,"ICON_BELL_RED","Data point has alarm status: "+a);break}}}},m_showAlarmIcon:function(a,c,e,d){var b=a;if(this.m_iconLayout=="hover"&&a.firstChild){b=a.firstChild}b.src=elon.elon.iconsArr[c];b.title=e;if(d!=null){a.style.cursor="pointer";elon.UtilObject.getInstance().addEvent(a,"click",d,false)}if(a==this.m_almObj){this.m_placeIconObj(this.m_almObj,(this.m_almObj.placeLeft&&this.m_prioObj.shown)?-1:0)}else{if(this.m_almObj.placeLeft&&this.m_almObj.shown){this.m_placeIconObj(this.m_almObj,-1)}this.m_placeIconObj(this.m_prioObj,0)}this.m_showIcon(a)}}});Echelon.viewShowValueObject=elon.Class({base:{m_formObj:Echelon.Form},constructor:function(a){a.noOptionsRequired=true;this.viewObjType="showvalue";this.m_formObj(a);if(this.argObj.elon_url&&this.argObj.elon_url.href){if(a.elon_url&&a.elon_url.href){this.m_displayAsHyperlink=true;this.addEvent("click",function(b){elon.util.catchEvent(b);this.f_followLink(a);return false})}}},"public":{createDomObj:function(a){return a.createElement("span")},setOptions:function(a){this.f_options=a;this.m_valTxt={};this.m_txtVal={};for(var b in a){this.m_valTxt[a[b]]=b;this.m_txtVal[b]=a[b]}},clear:function(a){this.domObj.innerHTML=""},setValue:function(b){var a="";var c="";if(this.m_displayAsHyperlink){a='<a href="'+(this.argObj.elon_url.href||this.argObj.elon_url)+'">';c="</a>"}if(this.m_valTxt&&(this.m_valTxt[b]!=null)){this.domObj.innerHTML=a+this.m_valTxt[b]+c}else{this.domObj.innerHTML=a+b+c}},getValue:function(){return this.m_txtVal?this.m_txtVal[this.domObj.innerHTML]:this.domObj.innerHTML},getText:function(){return this.domObj.innerHTML}}});Echelon.viewButtonObject=elon.Class({base:{m_form:Echelon.Form},constructor:function(a){this.m_options=[];this.m_current=0;this.m_form(a,"click");this.addEvent("click",this.m_click)},"public":{"callback:m_click":function(){if(this.m_options.length==0){return}this.m_current++;if(this.m_current>=this.m_options.length){this.m_current=0}this.setValue(this.m_options[this.m_current][1]);if(this.f_webHandler){this.f_webHandler.ui()}},setLabel:function(a){this.domObj.innerHTML=a},detachLableFromValue:function(){this.m_detachedLableFromValue=true},createDomObj:function(a){return a.createElement("button")},setOptions:function(a){this.f_options=a;this.m_options=[];for(var b in a){this.m_options.push([b,a[b]])}this.setLabel(this.m_options[0][0]);this.m_current=0},clear:function(){if(this.m_options.length){this.setLabel("");this.m_current=-1}},getText:function(){return this.m_options[this.m_current][0]},getValue:function(){if(this.m_options.length&&this.m_current>=0){return this.m_options[this.m_current][1]}else{if(this.f_webHandler!=null){return !this.f_webHandler.m_dat.value.get()}else{return true}}},setValue:function(b){if(this.m_detachedLableFromValue){return}this.setLabel(b);this.m_current=-1;for(var a=0;a<this.m_options.length;a++){if(this.m_options[a][1]==b){this.setLabel(this.m_options[a][0]);this.m_current=a;break}}}}});Echelon.viewImageObject=elon.Class({base:{m_form:Echelon.Form},constructor:function(a){this.m_form(a,"click")},"public":{createDomObj:function(a){return a.createElement("img")},setOptions:function(a){this.f_options=this.m_options=a},setValue:function(a){this.domObj.src=a},getValue:function(){return this.domObj.src},getText:function(){for(var a in this.m_options){if(this.m_options[a]==this.domObj.src){return a}}},clear:function(){this.domObj.src=""}}});Echelon.ClassNameSwitcher=elon.Class({base:{m_form:Echelon.Form},constructor:function(a){this.m_form(a,"click")},"public":{createDomObj:function(a){return a.createElement("div")},setOptions:function(a){this.f_options=this.m_options=a},setValue:function(b){if(this.m_options){for(var a in this.m_options){if(this.m_options[a]==b){b=a;break}}}this.domObj.className=b},m_val:function(){return this.domObj.className},getValue:function(){return this.m_options?this.m_options[this.m_val()]:this.m_val()},getText:function(){for(var a in this.m_options){if(this.m_options[a]==this.getValue()){return a}}},clear:function(){this.domObj.className=""}}});Echelon.viewIpEntryObject=elon.Class({base:{m_form:Echelon.Form},constructor:function(a){this.m_txt=[];this.m_form(a,"change")},"public":{"nest:m_Change":elon.Class({constructor:["m_txt"],closure:function(){this.parent.callEventFunctions({type:"change",viewObject:this})}}),m_txtField:function(){var a=Echelon.viewTextfieldObject.getInstance({parentDomObj:this.domObj,elon_value_type:"IpSegment",elon_highlight_submit:true});a.domObj.size=3;a.domObj.maxLength=3;a.addEvent("valueChange",this.m_Change(a));this.m_txt.push(a)},createDomObj:function(b){this.domObj=b.createElement("SPAN");for(var a=0;a<3;a++){this.m_txtField();this.domObj.appendChild(b.createTextNode("."))}this.m_txtField();return this.domObj},setValue:function(c,b){if(this.f_hasFocus&&!b){return}c=c.split(".");for(var a=0;a<this.m_txt.length;a++){this.m_txt[a].setValue(c[a])}},disableSpecifics:function(a){for(var b=0;b<this.m_txt.length;b++){this.m_txt[b].setDisabled(a)}},clear:function(){this.setValue("...")},getValue:function(){var b=[];for(var a=0;a<this.m_txt.length;a++){b.push(this.m_txt[a].getValue())}return b.join(".")}}});Echelon.viewValueDefObject=elon.Class({base:{m_viewFormObj:Echelon.Form},constructor:function(b,a){b.elon_show_value_def=true;this.m_viewFormObj(b,a)}});Echelon.viewCheckboxObject=elon.Class({base:{m_valDef:Echelon.viewValueDefObject},constructor:function(a){this.m_checked=[["false",a.elon_value_def_name_unchecked||"false"],["true",a.elon_value_def_name_checked||"true"]];this.m_valDef(a,"click")},"public":{createDomObj:function(a){var b=a.createElement("input");b.type="checkbox";return b},f_modifyDomObj:function(a){if(a.nodeName!="INPUT"){for(var b=0;b<a.childNodes.length;b++){if(a.childNodes[b].nodeName=="INPUT"){this.domObj=a.childNodes[b];return}}}},setOptions:function(a){this.f_options=a;if(this.argObj.elon_value_def_name_checked||this.argObj.elon_value_def_name_unchecked){return}this.m_checked=[];for(var b in a){this.m_checked.push([b,a[b]])}},clear:function(){this.domObj.checked=false},setValue:function(a){this.domObj.checked=(this.m_checked[1][1]==a)},getValue:function(){return(this.domObj.checked?this.m_checked[1]:this.m_checked[0])[1]},getText:function(){return(this.domObj.checked?this.m_checked[1]:this.m_checked[0])[0]}}});Echelon.MultiOptionMethods=elon.Class({"protected":{f_setMultiple:function(b){if(this.m_multiOpt){return}(this.f_multiObj||this.domObj).style.color="gray";var a=this.f_createOpts();this.m_multiOpt={key:b+" (Multiple)",val:b};a[this.m_multiOpt.key]="(Multiple)";this.setOptions(a,this.m_disabled);this.setValue("(Multiple)")},f_resetMultiple:function(b){if(!this.m_multiOpt){return}(this.f_multiObj||this.domObj).style.color="black";var a=this.f_createOpts();delete a[this.m_multiOpt.key];this.setOptions(a,this.m_disabled);this.setValue(this.m_multiOpt.val);delete this.m_multiOpt}}});Echelon.viewRadiobuttonObject=elon.Class({base:{m_valDef:Echelon.viewValueDefObject,m_mixin:Echelon.MultiOptionMethods},constructor:function(a){a.elon_force_round_to_preset=true;this.m_separator=a.elon_inline?"&nbsp;":"<br>";this.m_maxElements=a.elon_max_elements;this.m_space=(a.elon_space!=null)?a.elon_space:1;this.m_radioName="RADIO-"+Echelon.viewRadiobuttonObject.id++;this.m_valDef(a,"click");this.domObj.style.textAlign=a.elon_inline?"center":"left"},"public":{setChecked:function(a){this.domObj.firstChild.checked=a},createDomObj:function(a){return a.createElement("span")},setOptions:function(a,e){this.f_options=a;var d="";for(var c=0;c<this.m_space;c++){d+=this.m_separator}var b="";var f=0;this.m_options={};for(var c in a){b+="<label><input "+(f==0?('id="'+this.m_radioName+'" '):"")+'noSubmit=true type="radio" value="'+a[c]+'" name="'+this.m_radioName+'"/>'+c+"</label>"+d;this.m_options[a[c]]=c;f++;if(this.m_maxElements&&(f==this.m_maxElements)){break}}this.domObj.innerHTML=b;this.f_iconPlaceObj=this.domObj.ownerDocument.getElementById(this.m_radioName);if(e){this.m_disabled={};for(var c in e){this.m_disabled[c]=e[c]}elon.UtilObject.getInstance().fireQuickCallback(this.m_each,this,function(g){if(e[g.value]){g.disabled=g.parentNode.disabled=true}})}this.setValue(this.getValue())},f_createOpts:function(){var b={};for(var a in this.m_options){b[this.m_options[a]]=a}return b},m_each:function(b){var c=this.domObj.ownerDocument.getElementsByName(this.m_radioName);for(var a=0;a<c.length;a++){b.call(this,c[a])}},clear:function(){this.m_each(function(a){a.checked=false})},setValue:function(a){this.m_each(function(b){b.checked=b.value==a})},getValue:function(){var a;this.m_each(function(b){if(b.checked){a=b.value}});return a},getText:function(){return this.m_options[this.getValue()]}}});Echelon.viewRadiobuttonObject.id=0;Echelon.viewSelectionObject=elon.Class({base:{m_valDef:Echelon.viewValueDefObject,m_mixin:Echelon.MultiOptionMethods},constructor:function(a){if(a.domObj&&a.domObj.currentStyle){this.m_backgroundColor=a.domObj.currentStyle.backgroundColor}this.m_valDef(a,"change");if(a.elon_name||a.elon_alias_name!=null){this.domObj.style.textAlign="right"}},"public":{getText:function(){return(this.domObj.selectedIndex!=-1)?this.domObj.options[this.domObj.selectedIndex].text:null},m_collect:function(b){var c=new Array();for(var a=0;a<this.domObj.options.length;a++){if(this.domObj.options[a].selected){c.push(b.call(this,a))}}return c},getSelectedIndexes:function(){this.m_collect(function(a){return a})},getSelectedValues:function(){this.m_collect(function(a){return this.domObj.options[a].value})},clear:function(){for(var a=0;a<this.domObj.options.length;a++){this.domObj.options[a].selected=false}this.setValue("")},createDomObj:function(a){return a.createElement("select")},setOptions:function(b){this.f_options=b;var a=this.getValue();this.domObj.options.length=0;for(var c in b){if(elon.util.countProps(b[c])>2){this.domObj.add(b[c],undefined)}else{this.domObj.add(new Option(c,b[c]),undefined)}}delete this.m_emptyOption;if(a!=null){this.setValue(a)}},f_createOpts:function(){var b={};for(var a=0;a<this.domObj.options.length;a++){b[this.domObj.options[a].text]=this.domObj.options[a].value}return b},f_resetMultipleEvent:"change",setValue:function(c){var b=false;delete this.m_value;for(var a=0;a<this.domObj.options.length;a++){this.domObj.options[a].selected=(this.domObj.options[a].value==c);if(this.domObj.options[a].selected){b=true}}if(!b){if(!this.m_emptyOption){this.domObj.add(new Option("",null),undefined);this.m_emptyOption=true}this.domObj.options[this.domObj.options.length-1].selected=true;this.m_value=c}this.domObj.value=c},getValue:function(){return(this.domObj.selectedIndex==-1)?this.m_value:(this.domObj.options[this.domObj.selectedIndex]&&this.domObj.options[this.domObj.selectedIndex].value)}}});Echelon.viewImageSwapperObject=elon.Class({base:{m_valDef:Echelon.viewValueDefObject},constructor:function(a){this.placeIconCenter=true;this.m_imgArr=new Array();if(a.domObj==null){this.f_createDomObj(a)}if(a.elon_name||a.elon_alias_name){this.m_init(a)}this.m_valDef(a,"click")},"public":{createDomObj:function(a){return a.createElement("img")},setOptions:function(b){this.f_options=b;if(this.argObj.elon_local_value_defs){return}var a="";for(var c=0;c<this.m_imgArr.length;c++){if(b[this.m_imgArr[c].elon_value_def]){this.m_imgArr[c].UCPTvalue=b[c]}else{a+=("\n"+this.m_imgArr[c].elon_value_def)}}if(this.f_dpHandler){this.f_dpHandler.setConfigError(a?"Missing Value Defs:"+a:false)}},setValue:function(d){this.m_imgAvailable=false;for(var b=0;b<this.m_imgArr.length;b++){if(this.m_imgArr[b]&&this.m_imgArr[b].elon_src){var e=this.m_imgArr[b].elon_value;var c=(this.argObj.elon_local_value_defs&&(d==e||d==Number(e)));var a=(!this.argObj.elon_local_value_defs&&d==this.m_imgArr[b].elon_value_def);if(a||c){this.img.src=this.m_imgArr[b].elon_src;this.m_currImgIdx=parseInt(b,10);this.m_imgAvailable=true;break}}}if(!this.m_imgAvailable){if(this.defaultImg!=null){this.img.src=this.defaultImg}}},m_currentImg:function(){var d=this.argObj.elon_local_value_defs?"elon_value":"elon_value_def";if(this.m_imgAvailable){var a=this.m_currImgIdx;var c=a+1;if(c>(this.m_imgArr.length-1)){c=0}for(var b=c;b<this.m_imgArr.length;b++){if(this.m_imgArr[b]&&this.m_imgArr[b].elon_value_def!=null){c=b;break}}return(this.m_imgArr[c])?this.m_imgArr[c][d]:""}else{return this.defaultNext}},getValue:function(){return this.m_currentImg()},getText:function(){return this.m_currentImg()},clear:function(){},m_findImageSrc:function(g,f){var a="";if(!g||g.match(/\/$/)){return a}if(g.substring(0,"local:".length)=="local:"){var c=g.substring("local:".length);if(!c){return a}var e=f.document||f.parentDomObj.ownerDocument||f.domObj.ownerDocument;var d=e.getElementById(c);if(!d){return a}for(var b=0;b<d.childNodes.length;b++){if(d.childNodes[b].src){return d.childNodes[b].src}}return a}else{return g}},disableSpecifics:function(a){if(!this.argObj.elon_readonly&&this.img){var b=this.img.style;b.opacity=a?"0.4":"1";b.filter="alpha(opacity="+(a?"40":"100")+")";b.color=a?"#888888":"#000000";this.img.style.cursor=a?"":"pointer"}},m_init:function(b){if(!this.img){this.img=b.domObj;if(b.domObj.nodeName=="DIV"){this.f_iconPlaceObj=this.img=b.domObj.appendChild(b.domObj.ownerDocument.createElement("img"))}}this.defaultImg=this.m_findImageSrc(b.elon_default_img,b);this.defaultNext=b.elon_default_next;this.m_imgArr=b.elon_img_arr||new Array();for(var a=0;a<this.m_imgArr.length;a++){this.m_imgArr[a].elon_src=this.m_findImageSrc(this.m_imgArr[a].elon_src,b);if(!this.defaultImg){this.defaultImg=this.m_imgArr[a].elon_src}if(!this.defaultNext){this.defaultNext=this.m_imgArr[a][b.elon_local_value_defs?"elon_value":"elon_value_def"]}}if(!b.elon_readonly){this.img.style.cursor="pointer"}}}});Echelon.TextForm=elon.Class({base:{m_form:Echelon.Form},constructor:function(a,b){if(a.noOptionsRequired==null){a.noOptionsRequired=true}this.m_form(a,b)},"public":{iniValidators:function(){elon.UtilObject.getInstance().addEvent(this.domObj,"focus",this.fixColor,false);elon.UtilObject.getInstance().addEvent(this.domObj,"click",this.fixColor,false)},validate2:function(){var a=null;if((this.m_validationMethod!=null)&&(typeof(this.m_validationMethod)=="function")){a=this.m_validationMethod(this.getValue())}if(a!=null){this.setError();elon.elon.setErrMsg(elon.Error.getInstance(elon.ErrorTable.getInstance().ERR_VAL_FIELDS_MARKED))}else{this.resetColor()}return a},setError:function(){this.domObj.style.backgroundColor="red"},resetColor:function(){if(this.domObj.className!="DPText"){this.domObj.style.backgroundColor="white"}},setText:function(a){this.domObj.value=a;this.domObj.defaultValue=a},appendText:function(a){this.domObj.value=this.domObj.value+a},setValidationMethod:function(a){this.m_validationMethod=a},"callback:fixColor":function(){if(this.domObj.style.backgroundColor=="red"){this.domObj.style.backgroundColor="lightpink"}},iniSubmitButtonHighlighters:function(a){if(a.elon_name!=null||a.elon_alias_name){this.domObj.style.textAlign="right"}this.resetColor();this.addEvent("blur",this.m_valueChange);this.addEvent("focus",this.m_focus);if(this.argObj.elon_highlight_submit!=false&&(this.argObj.elon_webdpname||this.argObj.elon_highlight_submit)){this.addEvent("keydown",this.m_keyHandler)}},"callback:m_valueChange":function(a){delete this.f_hasFocus;if(this.argObj.elon_webdpname||this.argObj.elon_highlight_submit){this.f_sso.setSubmitRequired(false)}if(this.getValue()==this.domObj.defaultValue){this.resetColor();if(this.f_dpHandler){this.f_dpHandler.cancelFocus()}return}if(this.argObj.rewriter){var b=this.getValue();var c=this.argObj.rewriter(b);if(c!=b){this.setValue(c)}}if(!this.f_valueType){this.domObj.defaultValue=this.getValue();this.callEventFunctions({type:"valueChange",viewObject:this})}else{this.validate(a)}},m_ignoredKeys:[9,27,45],m_unignoredCtrlKeys:[86,88],m_ignoredKeyRanges:[[16,20],[33,44],[91,93],[112,123],[144,145]],"callback:m_keyHandler":function(a){a=(a)?a:window.event;var d=(a.target)?a.target:a.srcElement;if(a.altKey){return}if(a.ctrlKey){for(var c=0;c<this.m_unignoredCtrlKeys.length;c++){if(a.keyCode==this.m_unignoredCtrlKeys[c]&&!d.readOnly){this.f_sso.setSubmitRequired(true)}}return}for(var c=0;c<this.m_ignoredKeys.length;c++){if(a.keyCode==this.m_ignoredKeys[c]){return}}for(var c=0;c<this.m_ignoredKeyRanges.length;c++){for(var b=this.m_ignoredKeyRanges[c][0];b<=this.m_ignoredKeyRanges[c][1];b++){if(a.keyCode==b){return}}}if(!d.readOnly){this.f_sso.setSubmitRequired(true)}},"callback:m_focus":function(){this.f_hasFocus=true},clear:function(){this.setValue("")},getText:function(){return this.getValue()},disableSpecifics:function(a){this.domObj.style.backgroundColor=a?"lightgrey":"white";this.domObj.disabled=a}},"private":{f_setValue:function(b,a){if(this.f_hasFocus&&!a){return}this.domObj.value=b;this.domObj.defaultValue=b}}});Echelon.viewTextfieldObject=elon.Class({base:{m_textForm:Echelon.TextForm},constructor:function(a){if(a.domObj&&a.domObj.currentStyle){this.m_backgroundColor=a.domObj.currentStyle.backgroundColor}this.m_textForm(a,"valueChange");this.addEvent("keydown",this.m_txtBaseBlur);this.iniSubmitButtonHighlighters(a)},"public":{"callback:m_txtBaseBlur":function(a){if(a.keyCode==13){this.domObj.blur()}},createDomObj:function(b){var a=b.createElement("input");return a},getText:function(){return this.f_getValue()}},"protected":{f_setValue:function(b,a){if(!this.f_hasFocus||a){this.domObj.value=b;this.domObj.defaultValue=b}},f_getValue:function(a){return this.domObj.value}}});Echelon.viewPasswordfieldObject=elon.Class({base:{m_textfield:Echelon.viewTextfieldObject},constructor:function(a){this.m_textfield(a)},"public":{createDomObj:function(b){var a=b.createElement("input");a.type="password";return a}}});Echelon.viewTextareaObject=elon.Class({base:{m_textForm:Echelon.TextForm},constructor:function(a){this.m_append=a.elon_append||false;this.m_prepend=a.elon_prepend||false;this.m_lastVal=null;this.m_textForm(a,"valueChange");this.iniSubmitButtonHighlighters(a)},"public":{createDomObj:function(a){return a.createElement("textarea")},m_addLine:function(b){var a=this.domObj.value.split("\n");if((a.length+1)==this.domObj.rows){this.m_append?a.shift():a.pop()}return this.m_append?a.concat([b]).join("\n"):[b].concat(a).join("\n")},getText:function(){return this.f_getValue}},"protected":{f_setValue:function(b,a){if(this.f_hasFocus&&!a){return}if(b!=this.m_lastVal||a){this.domObj.value=(this.m_append||this.m_prepend)?this.m_addLine(b):b}this.m_lastVal=b},f_getValue:function(){var a=this.domObj.value;return this.m_append?a.split("\n").shift():(this.m_prepend?a.split("\n").pop():a)}}});Echelon.viewImageSelectionObject=elon.Class({base:{m_form:Echelon.Form},constructor:function(a){this.m_form(a,"click")},"public":{createDomObj:function(d,e){var h=(e.parentDomObj)?e.parentDomObj:d.createElement("div");var g=h.appendChild(d.createElement("TABLE"));g.cellSpacing=g.cellPadding=0;var b=g.insertRow(g.rows.length);var a=b.insertCell(b.cells.length);a.style.padding=a.style.margin="0px 0px 0px 0px";this.m_img=a.appendChild(d.createElement("img"));this.m_img.style.height="16px";this.m_img.style.width="16px";this.f_iconPlaceObj=this.m_img;a=b.insertCell(b.cells.length);a.style.padding="0px 0px 0px 0px";a.style.margin="0px 0px 0px 0px";var c=d.createElement("button");c.style.height="100%";var f="";if(!(elon.browser.FF||elon.browser.IE67)){f="position: relative; left: "+(elon.browser.IE?-5:-3)+"px"}c.innerHTML="<span style='vertical-align:middle; color: black; font-size: 10px; margin-top: 2px; margin-bottom: 2px; padding: 0px 0px 2px; width: 10px; height: 11px; overflow: hidden; "+f+"'>&#9660</span>";c.style.textAlign="center";c.style.width="20px";c.style.cursor="default";this.m_trigger=a.appendChild(c);elon.UtilObject.getInstance().addEvent(this.m_trigger,"click",this.f_showSelectElement,false);this.m_select=new Echelon.viewImageSelectMenuObject({domObj:this.m_trigger,event:"none"},this);this.selectObj=this.m_select;return h},f_createDomObj:function(a){if(a.parentDomObj){a.domObj=this.createDomObj(a.parentDomObj.ownerDocument,a)}},setOptions:function(a){this.f_options=this.m_options=a;this.m_select.setOptions(a)},setValue:function(a){this.m_img.value=a;this.m_select.setValue(a)},getValue:function(){return this.m_img.value},onValueChange:function(a){this.m_callback=a},"callback:f_showSelectElement":function(a){a.cancelBubble=true;if(this.m_select.isOpen==true){this.m_select.hide();return}if(!this.m_trigger.isDisabled){if(this.m_select.options.length>0){elon.elon.click(a);this.m_select.show(a)}}},m_triggerEvent:function(a){try{if(this.onchange){this.callEventFunctions({type:"change",viewObj:this})}if(this.m_callback){this.m_callback(a)}this.callEventFunctions({type:"valueChange",viewObject:this})}catch(b){}}}});Echelon.viewImageSelectMenuObject=function(c,a){c.relocateViaDomObj=true;this.f_menuAlignmentNode=a.m_img;elon.ViewMenuObject.call(this,c);var b=this;this.m_domObj=this.getTableObj();this.m_selectedIndex=0;this.m_sel=a;this.m_bs=elon.dom;this.m_followScroll=!elon.browser.IE;this.options=new Array();this.f_getMenuAlignmentNode=function(){return this.m_sel.m_img},this.init=function(){this.m_buildMenu();if(this.m_followScroll){this.Obj.echelon_master=this}this.resize()};this.resize=function(){this.m_domObj.style.width="43px"};this.getSelectedIndex=function(){return this.m_selectedIndex};this.getValue=function(){return this.options[this.m_selectedIndex]&&this.options[this.m_selectedIndex].value};this.setValue=function(e){var f=false;for(var d=0;d<this.options.length;d++){if(this.options[d].value==e){this.m_selectedIndex=d;this.m_sel.m_img.src=this.options[this.m_selectedIndex].text;return d}}};this.setSelectedIndex=function(d){if((d!=null)&&(d<this.options.length)){this.m_selectedIndex=d}else{this.m_selectedIndex=0}this.m_sel.m_img.src=this.options[this.m_selectedIndex].text;this.m_sel.m_img.value=this.options[this.m_selectedIndex].value};this.setOptions=function(d,f,g){this.f_options=d;for(var e in d){this.options.push(new Option(e,d[e]))}this.init()};this.m_buildMenu=function(){this.clearMenu();if(!this.options.length){return}var e=new elon.CallbackHandler(this,this.f_cellClicked).method;for(var d=0;d<this.options.length;d++){this.addMenuEntry("",e,true,null,this.options[d].text)}};this.add=function(f,d){if((d!=null)&&(d>=0)){if(d<this.options.length){this.options[e]=new Array();for(var e=this.options.length;e>d;e--){this.options[e].text=this.options[e-1].text;this.options[e].value=this.options[e-1].value}this.options[d].text=f.text;this.options[d].value=f.value}else{if(d>=this.options.length){d=this.options.length;this.options[d]=new Array();this.options[d].text=f.text;this.options[d].value=f.value}}}else{d=this.options.length;this.options[d]=new Array();this.options[d].text=f.text;this.options[d].value=f.value}if(this.options.length==1){this.m_sel.m_img.src=f.text;this.setSelectedIndex(0)}this.init()};this.remove=function(d){if((d!=null)&&(d>=0)&&(d<this.options.length)){if(this.m_selectedIndex!=0){this.setSelectedIndex(--this.m_selectedIndex)}else{if(this.options.length==0){this.setSelectedIndex(-1)}}this.options.splice(d,1)}else{alert("Can't remove specified Item!")}this.init()};this.f_cellClicked=function(d){d=(d)?d:window.event;var f=(d.target)?d.target:d.srcElement;for(var e=0;e<b.m_domObj.rows.length;e++){if(b.m_domObj.rows[e].cells[0]==f||b.m_domObj.rows[e].cells[0]==f.parentNode){b.setSelectedIndex(e);b.m_sel.m_triggerEvent(b.options[b.m_selectedIndex].value);break}}b.hide()}};Echelon.viewImageSelectMenuObject.getInstance=function(a){return new Echelon.viewImageSelectMenuObject(a)};Echelon.viewComboBoxObject=elon.Class({base:{m_textForm:Echelon.TextForm},constructor:function(d){if(d.domObj&&d.domObj.currentStyle){this.m_backgroundColor=d.domObj.currentStyle.backgroundColor}var b=d.domObj;if(b){this.m_oldStyle=new Object();var a=elon.browser.IE?b.currentStyle:elon.dom.getDefaultView(b).getComputedStyle(b,"");for(var c in a){this.m_oldStyle[c]=elon.browser.IE?a[c]:a.getPropertyValue(c)}if(b.style.minWidth){this.m_oldStyle.minWidth=b.style.minWidth;this.m_oldStyle.width=b.style.width}}d.parentDomObj=d.parentDomObj||d.domObj;this.f_createDomObj(d);if(b){b.parentNode.replaceChild(d.domObj,b)}d.noOptionsRequired=false;this.m_textForm(d,"change");d.domObj.tabIndex=0;this.removeEvent(this.uiEvent,this.m_valueChangeCallback);this.iniValidators();if(d.mode!=null){this.m_init()}},"public":{init:function(b,a){if(b!=this.argObj.mode||a!=this.argObj.elon_name){this.argObj.mode=b;this.argObj.elon_name=a;this.m_init();this.textfieldObj.Obj.value="- - -"}},m_init:function(){if(this.argObj.mode!=null){this.mode=this.argObj.mode.toUpperCase()}else{this.mode="OVW"}this.selectObj=this.m_select;if(!this.argObj.selectOnly&&this.argObj.elon_highlight_submit!=false&&(this.argObj.elon_webdpname||this.argObj.elon_highlight_submit)){this.addEvent("keydown",this.textfieldObj.m_keyHandler)}if(this.argObj.elon_name!=null){var c=null;var a=(this.m_oldStyle&&this.m_oldStyle.width)?this.m_oldStyle.width:100;for(var b in this.m_oldStyle){if(this.textfieldObj.domObj.style[b]){this.textfieldObj.domObj.style[b]=this.m_oldStyle[b]}}if(this.argObj.elon_size!=null){a=this.argObj.elon_size;if(isNaN(a)||a<=0){a="100%"}}this.setWidth(a);if(this.argObj.elon_edit_mode!=null){c=this.argObj.elon_edit_mode}if(this.f_dpHandler==null){this.f_dpHandler=Echelon.formObjectDpHandler(this,"change")}}elon.util.addEvent(this.m_textfield,"blur",this.m_elemBlured,false);if(!elon.util.isSafe(c)){c="VALUE"}if(!this.argObj.selectOnly){switch(c){case"PRESET":this.m_textfield.readOnly=true;elon.util.addEvent(this.m_textfield,"click",this.m_select.hide,false);break;case"VALUE":this.m_textfield.readOnly=false;elon.util.addEvent(this.m_textfield,"keypress",this.m_keyPressed,false);elon.util.addEvent(this.m_textfield,"click",this.m_select.hide,false);break}}else{this.m_textfield.style.cursor="default";this.textfieldObj.addEvent("click",this.m_rerouteClick)}},createDomObj:function(b,d){if(d.domHook){this.m_div=d.domHook}else{this.m_div=b.createElement("span");var c=null;if(d.elon_icon_layout=="fixed"){c=this.m_div.appendChild(b.createElement("span"));c.style.display="none"}}this.m_div.style.whiteSpace="nowrap";this.m_textfield=this.m_div.appendChild(b.createElement("input"));this.m_textfield.name="comboTextField";this.f_iconPlaceObj=c||this.m_textfield;this.m_textfield.value="- - -";if(this.m_backgroundColor){this.m_textfield.style.backgroundColor=this.m_backgroundColor}if(d.selectOnly){this.m_textfield.readOnly=true}var a={domObj:this.m_textfield,elon_highlight_submit:d.elon_highlight_submit};this.textfieldObj=Echelon.viewTextfieldObject.getInstance(a);this.textfieldObj.validate=this.validate;this.textfieldObj.addEvent("blur",this.restoreUpdateDuringFocus);this.f_multiObj=this.textfieldObj.Obj;this.m_select=Echelon[(d.lazy?"Lazy":"")+"MenuButton"]({parentDomObj:this.m_div,optionsCB:d.optionsCB,event:"none",combo:this});this.m_select.setTextfield(this.textfieldObj);this.selectObj=this.m_select;return this.m_div},setWidth:function(a){try{a=(a&&a.match&&!a.match(/%$/))?elon.util.addPx(a):a;this.m_div.style.width=this.textfieldObj.domObj.style.width=a;this.m_select.resize()}catch(b){elon.elon.setDbgMsg(b.toString())}},m_triggerEvent:function(a){this.f_sso.setSubmitRequired(false);try{if(!this.domObj.defaultValue||this.domObj.defaultValue!=a){this.domObj.defaultValue=a;if(this.onchange){this.callEventFunctions({type:"change",viewObj:this,viewObject:this})}if(this.m_callback){this.m_callback(a)}this.callEventFunctions({type:"valueChange",viewObject:this})}}catch(b){}},onValueChange:function(a){this.m_callback=a},clear:function(){this.setValue("")},setOptions:function(a,b,c){return this.selectObj.setOptions(this.f_options=a,b,c)},getValue:function(a){return a?((this.selectObj.getText()==this.textfieldObj.getText())?this.selectObj.getValue():this.textfieldObj.getValue()):this.selectObj.getValue()},setValue:function(a){this.domObj.defaultValue=a;return this.selectObj.setValue(a)},getText:function(a){return this.textfieldObj.getText(a)},f_setMultiple:function(a){this.setValue(a+" (Multiple)");this.m_textfield.style.color="gray"},f_resetMultiple:function(){this.m_textfield.style.color="black";this.setValue((this.getText()||"").replace(new RegExp(" \\(Multiple\\)$"),""),true)},setText:function(a){this.domObj.defaultValue=a;this.selectObj.setText(a);return this.textfieldObj.setText(a)},setError:function(){this.textfieldObj.setError()},focus:function(){try{this.textfieldObj.domObj.focus()}catch(a){}},setValueType:function(a){this.textfieldObj.setValueType(a)},setStyle:function(a){if(a.width){this.setWidth(a.width);delete a.width}this.textfieldObj.setStyle(a)},resetColor:function(){this.textfieldObj.resetColor()},"callback:restoreUpdateDuringFocus":function(a){if((this.getValue(true)==this.domObj.defaultValue)&&this.f_dpHandler){this.f_dpHandler.cancelFocus()}},"callback:validate":function(a){if(a&&!this.m_evtOutside(a)&&(!this.m_select.isOpen)){this.textfieldObj.resetColor();return}else{var b=Echelon.Form.elonClass.prototype.validate.call(this.textfieldObj);if(b){this.callEventFunctions({type:"valueChange",viewObject:this})}return b}},disableSpecifics:function(a){this.m_select.disableSpecifics(a);this.m_textfield.disabled=a;if(!this.argObj.selectOnly){this.m_textfield.style.backgroundColor=a?"lightgrey":"white"}},f_createOpts:function(){return this.selectObj.createOpts()},"callback:m_rerouteClick":function(a){this.m_select.click();return elon.util.catchEvent(a)},"callback:m_keyPressed":function(a){a=(a)?a:window.event;switch(this.mode){case"OVW":if(a.keyCode==13){this.m_textfield.blur()}break;case"ADD":if(a.keyCode==13){this.m_textfield.blur()}break;case"DP":if(a.keyCode==13){this.m_triggerEvent(this.textfieldObj.getValue())}break}},m_evtOutside:function(a){a=(a)?a:window.event;var b=(a.target)?a.target:a.srcElement;if(elon.browser.IE){return(a.offsetY<0)||(a.offsetY>(b.clientHeight+b.clientTop))||(a.offsetX-(b.clientWidth+b.clientLeft)<0)||(a.offsetX-(b.clientWidth+b.clientLeft)>25)}else{return a.explicitOriginalTarget!=this.m_select.m_trigger}},"callback:m_elemBlured":function(b){if(this.m_evtOutside(b)&&(!this.m_select.isOpen)){switch(this.mode){case"OVW":var a=this.m_select.getSelectedIndex();if((a>=0)&&(a<this.m_select.options.length)){this.m_select.options[a].text=this.textfieldObj.getValue();this.m_select.init()}this.m_triggerEvent(this.textfieldObj.getValue());break;case"ADD":this.m_select.options[this.m_select.options.length]=new Option(this.textfieldObj.getValue(),this.m_select.options.length,false,false);this.m_select.init();this.m_triggerEvent(this.textfieldObj.getValue());break;case"DP":this.m_triggerEvent(this.textfieldObj.getValue());break}}}}});Echelon.MenuButton=Echelon.Class({base:{m_menu:elon.Menu},constructor:function(c,b){var a=c.parentDomObj.ownerDocument;this.m_trigger=c.parentDomObj.appendChild(a.createElement("button"));var d="";if(!(elon.browser.FF||elon.browser.IE67)){d="position: relative; left: "+(elon.browser.IE?-5:-3)+"px"}this.m_trigger.innerHTML="<span style='vertical-align:middle; color: black; font-size: 10px; margin-top: 2px; margin-bottom: 2px; padding: 0px 0px 2px; width: 10px; height: 11px; overflow: hidden; "+d+"'>&#9660</span>";this.m_trigger.style.textAlign="center";this.m_trigger.style.width="20px";this.m_trigger.style.cursor="default";elon.util.addEvent(this.m_trigger,"click",this.f_showSelectElement,false);if(c.elon_disable_range==null){c.elon_disable_range="object"}c.domObj=this.m_trigger;c.relocateViaDomObj=true;this.m_menu(c);this.m_domObj=this.getTableObj();this.m_selectedIndex=0;this.m_combo=c.combo;this.m_bs=elon.dom;this.m_followScroll=!elon.browser.IE;this.options=new Array()},"public":{init:function(a){this.m_buildMenu();if(this.m_followScroll){this.Obj.echelon_master=this}this.resize(a)},disableSpecifics:function(a){this.m_trigger.disabled=a},disabled:function(){return this.m_trigger.isDisabled},click:function(){this.m_trigger.click()},resize:function(a){a=(a)?parseInt(a,10):20;this.m_domObj.style.width=elon.util.addPx(this.m_textfield.domObj.scrollWidth+a+4)},f_getMenuAlignmentNode:function(){return this.m_textfield.domObj},setTextfield:function(a){this.m_textfield=a},getSelectedIndex:function(){return this.m_selectedIndex},getValue:function(){return this.options[this.m_selectedIndex]&&this.options[this.m_selectedIndex].value},setValue:function(b){var c=false;for(var a=0;a<this.options.length;a++){if(this.options[a].value==b){this.m_selectedIndex=a;this.m_textfield.setValue(this.options[this.m_selectedIndex].text);c=true}}if(!c){this.m_textfield.setValue(b)}},getText:function(){return this.options[this.m_selectedIndex]&&this.options[this.m_selectedIndex].text},setText:function(b){var c=false;for(var a=0;a<this.options.length;a++){if(this.options[a].text==b){this.m_selectedIndex=a;this.m_textfield.setValue(this.options[this.m_selectedIndex].text);c=true;break}}if(!c){this.m_textfield.setValue(b)}},setSelectedIndex:function(a){if((a!=null)&&(a<this.options.length)){this.m_selectedIndex=a}else{this.m_selectedIndex=0}this.m_textfield.setValue(this.options[this.m_selectedIndex].text,true)},buildFromValueDefs:function(a){var c={};for(var b=0;b<a.length;b++){c[a[b].UCPTname.get()]=a[b].UCPTvalue.get()}this.setOptions(c)},f_createOpts:function(){var b={};for(var a=0;a<this.options.length;a++){b[this.options[a].text]=this.options[a].value}return b},setOptions:function(a,c,d){this.options.length=0;this.m_imgs=d;for(var b in a){this.options.push(new Option(b,a[b]));if(c&&c[a[b]]){this.options[this.options.length-1].disabled=true}}this.m_buildMenu()},m_buildMenu:function(){this.clearMenu();if(!this.options.length){return}for(var a=0;a<this.options.length;a++){this.addMenuEntry(this.options[a].text,this.f_cellClicked,!this.options[a].disabled,null,this.m_imgs&&this.m_imgs[this.options[a].value])}},add:function(c,a){if((a!=null)&&(a>=0)){if(a<this.options.length){this.options[b]=new Array();for(var b=this.options.length;b>a;b--){this.options[b].text=this.options[b-1].text;this.options[b].value=this.options[b-1].value}this.options[a].text=c.text;this.options[a].value=c.value}else{if(a>=this.options.length){a=this.options.length;this.options[a]=new Array();this.options[a].text=c.text;this.options[a].value=c.value}}}else{a=this.options.length;this.options[a]=new Array();this.options[a].text=c.text;this.options[a].value=c.value}if(this.options.length==1){this.m_textfield.setValue(c.text);this.setSelectedIndex(0)}this.init()},remove:function(a){if((a!=null)&&(a>=0)&&(a<this.options.length)){if(this.m_selectedIndex!=0){this.setSelectedIndex(--this.m_selectedIndex)}else{if(this.options.length==0){this.setSelectedIndex(-1)}}this.options.splice(a,1)}else{alert("Can't remove specified Item!")}this.init()},"callback:f_cellClicked":function(a){a=(a)?a:window.event;var c=(a.target)?a.target:a.srcElement;for(var b=0;b<this.m_domObj.rows.length;b++){if((this.m_domObj.rows[b].cells[0]===c)||(this.m_domObj.rows[b].cells[0]===c.parentNode)){this.setSelectedIndex(b);this.m_combo.m_triggerEvent(this.options[this.m_selectedIndex].text);break}}this.hide()},"callback:f_showSelectElement":function(a){a.cancelBubble=true;if(this.isOpen==true){this.hide();try{this.m_combo.m_textfield.focus()}catch(b){}return}if(!this.disabled()){if(this.options.length>0){elon.elon.click(a);this.show(a)}else{this.m_combo.m_textfield.focus()}}},m_getLongest:function(){var b=0;for(var a=0;a<this.options.length;a++){if(this.options[a].text.length>b){b=this.options[a].text.length}}return b}}});Echelon.LazyMenuButton=elon.Class({base:{m_menuButton:Echelon.MenuButton},constructor:function(a){this.m_menuButton(a);this.m_createOptions=a.optionsCB},"public":{"callback:f_showSelectElement":function(a){this.m_evt=elon.browser.IE678?this.domObj.ownerDocument.createEventObject(a):a;this.m_createOptions(this.m_updateLazyOptions);if(!this.m_calledUpdateLazyOptions){this.f_disableUI();this.m_updateEnablesUI=true}else{delete this.m_calledUpdateLazyOptions}return elon.UtilObject.getInstance().catchEvent(a)},"callback:m_updateLazyOptions":function(c,b,a){this.setOptions(c,b,a);if(this.m_updateEnablesUI){this.f_enableUI();delete this.m_updateEnablesUI}else{this.m_calledUpdateLazyOptions=true}this.m_menuButton.f_showSelectElement.call(this,this.m_evt);delete this.m_evt}}});Echelon.viewLazyComboBoxObject=elon.Class({base:{m_combo:Echelon.viewComboBoxObject},constructor:function(a){a.lazy=true;this.m_combo(a)}});Echelon.viewLazySelectionObject=elon.Class({base:{m_lCombo:Echelon.viewLazyComboBoxObject},constructor:function(a){a.selectOnly=true;this.m_lCombo(a)}});Echelon.WebDpMixin=elon.Class({"public":{setValue:function(a){return this.m_value().set(a,this)},getValue:function(){return this.m_value().get()},clear:function(){this.m_value().set(null,this)},f_setMultiple:function(a){this.m_value().multiple.set(true,this.argObj.id||this)},f_resetMultiple:function(){this.m_value().multiple.set(false,this.argObj.id||this)},setError:function(){this.m_data().error.set(true,this.argObj.id||this)},resetColor:function(){this.m_data().error.set(this.argObj.id||this)},setValueType:function(a){this.m_data().valueType.set(a,this)},setText:function(a){return this.m_value().set(this.m_optIter(a,"label","value"),this.argObj.id||this)},getText:function(){return this.m_optIter(this.m_value().get(),"value","label")},setOptions:function(b,d,e){this.f_options=b;var a=[];d=d||{};e=e||{};for(var c in b){a.push({label:c,value:b[c],img:e[c],disabled:d[c]})}this.m_cfg().option.y_proxy_set(a,this.argObj.id||this)},setStyle:function(c){var a=[];for(var b in c){a.push({field:b,value:c[b]})}if(this.setWidth&&c.width){this.setWidth(c.width)}this.m_data().style.y_proxy_set(a,this.argObj.id||this)}},"private":{m_optIter:function(e,b,a){var d=this.m_cfg().option;for(var c=0;c<d.length;c++){if(d[c][b].get()==e){return d[c][a].get()}}return e},m_dataCfg:function(a){return this.f_sso.getItem({type:"FormObj_"+a,Item:this.argObj.elon_webdpname})},m_data:function(){return this.m_dataCfg("Data")},m_cfg:function(){return this.m_dataCfg("Cfg")},m_value:function(){return this.m_data().value}}});Echelon.ComboForm=elon.Class({base:{m_form:Echelon.Form,m_webDpMixin:Echelon.WebDpMixin},constructor:function(b){this.m_form(b,"valueChange");for(var a in this.argObj.children){this.f_children[a].f_dpHandler=this.f_dpHandler;this.f_children[a].argObj.elon_name=this.argObj.elon_name}},"public":{setWidth:function(a){try{if(this.m_div){this.m_div.style.width=elon.util.addPx(a)}}catch(b){}},createDomObj:function(a,b){return this.m_span=a.createElement("span")},f_modifyDomObj:function(a){if(!this.argObj.elon_webdpname){this.argObj.elon_webdpname=this.webDpName("this","ComboForm")}this.f_children={};var d=a.ownerDocument;this.m_span.style.whiteSpace="nowrap";var e=null;if(this.argObj.elon_icon_layout=="fixed"){e=this.m_span.appendChild(d.createElement("span"));e.style.display="none"}this.f_iconPlaceObj=e||this.m_span;var c=this.m_span;for(var b in this.argObj.children){this.argObj.children[b].elon_webdpname=this.argObj.elon_webdpname;delete this.argObj.children[b].elon_name;this.argObj.children[b].parentDomObj=this.m_span;this.argObj.children[b].domHook=c;this.f_children[b]=Echelon.Form.factory(this.argObj.children[b]);this.f_children[b].f_iconPlaceObj=this.f_iconPlaceObj;this.f_children[b].addEvent(this.f_children[b].uiEvent,this.m_evt)}}},"protected":{f_addChildren:function(d,c){for(var b in d){if(b!="type"){for(var a in c){c[a][b]=d[b]}}}if(c.button){delete c.button.style}d.children=c}},"private":{"callback:m_evt":function(a){if(!a||!a.viewObject){return}var b=a.viewObject.getValue(true);if(this.m_lastSet==b){return}this.m_lastSet=b;this.setValue(b,this);this.callEventFunctions({type:"valueChange",viewObject:this})}}});Echelon.PopupButton=elon.Class({base:{m_form:Echelon.Form,m_webDpMixin:Echelon.WebDpMixin},constructor:function(a){a.fixedWidth=true;this.m_form(a,"valueChange");this.f_sso.subscribe({type:"FormObj_Data",Item:this.argObj.elon_webdpname,callback:this.m_popupCB,noInitialCallback:true})},"public":{m_blur:function(a){if(a.keyCode==13){this.domObj.blur()}},createDomObj:function(b,c){var a=b.createElement("button");var d="";if(!(elon.browser.FF||elon.browser.IE67)){d="position: relative; left: "+(elon.browser.IE?-5:-3)+"px"}a.innerHTML="<span style='vertical-align:middle; color: black; font-size: 10px; margin-top: 2px; margin-bottom: 2px; padding: 0px 0px 2px; width: 10px; height: 11px; overflow: hidden; "+d+"'>...</span>";a.style.textAlign="center";a.style.width="20px";a.style.cursor="default";elon.util.addEvent(a,"click",this.m_click);return a},"callback:m_popupCB":function(){this.callEventFunctions({type:"valueChange",viewObject:this})},"callback:m_click":function(a){if(typeof(this.argObj.popupStarter)=="function"){this.argObj.popupStarter(this.argObj.elon_webdpname)}else{this.argObj.popupStarter.elon_args_obj.elon_webdpname=this.argObj.elon_webdpname;this.f_createPopup(this.argObj.popupStarter)}}}});Echelon.viewPopupSelectorObject=elon.Class({base:{m_cForm:Echelon.ComboForm},constructor:function(a){this.f_addChildren(a,{textfield:{type:"Textfield"},button:{type:"PopupButton"}});this.m_cForm(a)}});Echelon.ComboBoxPopup=elon.Class({base:{m_cForm:Echelon.ComboForm},constructor:function(a){this.f_addChildren(a,{combo:{type:"ComboBox"},button:{type:"PopupButton"}});this.m_cForm(a)}});Echelon.viewDpValueTextfieldObject=elon.Class({base:{m_pop:Echelon.viewPopupSelectorObject},constructor:function(b){for(var a in this.m_webDp){if(b["elon_"+a+"_web_dp"]){b.elon_highlight_submit=true;break}}b.popupStarter=this.m_click;this.m_pop(b);if(b.domObj){b.domObj.tabIndex=0}if(this.argObj.elon_format_web_dp){this.f_sso.subscribe({type:"FormObj_Data",Item:this.argObj.elon_format_web_dp,callback:this.m_format,noInitialCallback:true})}},"public":{"callback:m_click":function(a){a.cancelBubble=true;var b={elon_pt_name:this.argObj.elon_pt_format,elon_vd_name:this.argObj.elon_vd_name,elon_mode:this.argObj.elon_mode,elon_title:this.argObj.elon_title,elon_symbol:elon.filter.qualifierToMediumIcon(this.argObj.elon_annotation,"Dp"),elon_pt_format:this.argObj.elon_pt_format,elon_value:this.argObj.elon_value,elon_soap_url:this.argObj.elon_soap_url};for(var c in this.m_webDp){if(this.argObj["elon_"+c+"_web_dp"]){b[this.m_webDp[c]]=this.m_getWebDp(c)}}if(this.argObj.elon_annotation_web_dp){b.elon_symbol=elon.filter.qualifierToMediumIcon(b.elon_symbol,"Dp")}this.f_createPopup({elon_url:"/user/shared/DataPointValueDefinition.htm",elon_args_obj:b});this.f_sso.subscribe({type:"StringItem",Item:this.webDpName("global","handleFieldValue"),callback:this.m_handleFieldValue,clear:this,singular:true,noInitialCallback:true})},m_webDp:{name:"elon_pt_name",annotation:"elon_symbol",format:"elon_pt_format",value:"elon_value",vd_name:"elon_vd_name",soap_url:"elon_soap_url"},m_getWebDp:function(a){return this.f_sso.getItem({type:"FormObj_Data",Item:this.argObj["elon_"+a+"_web_dp"]}).value.get()},"callback:m_handleFieldValue":function(a){if((a!=null)&&(a.value.get()!=null)){this.setValue(a.value.get());this.callEventFunctions({type:"valueChange",viewObject:this})}},"callback:m_format":function(a){this.setDisabled(a.value.multiple.get())}}});Echelon.EditValuePopupButton=elon.Class({base:{m_popBut:Echelon.PopupButton},constructor:function(a){a.popupStarter=this.m_ButtonCallback();this.m_popBut(a);this.m_prioDpName=this.webDpName("this","EditValue-Priority")},"public":{"nest:m_ButtonCallback":elon.Class({closure:function(a){a.cancelBubble=true;if(this.parent.domObj.disabled){return}if(!isNaN(this.parent.f_dpHandler.priority)){this.parent.f_sso.getItem({type:"IntItem",Item:this.parent.m_prioDpName}).value.set(this.parent.f_dpHandler.priority)}this.parent.f_createPopup({elon_url:this.parent.argObj.elon_popup||"/user/shared/EditValue.htm",elon_args_obj:{elon_pt_name:this.parent.argObj.elon_name,elon_mode:"value",elon_title:this.parent.argObj.nls.EDIT_VALUE,elon_symbol:elon.imgUrl("app/Dp_In_Out.gif"),elon_pt_format:this.parent.f_dpHandler.dpConfig.UCPTformatDescription.get(),elon_priority_dp:this.parent.m_prioDpName}});this.parent.f_sso.subscribe({type:"StringItem",Item:this.parent.webDpName("global","handleFieldValue"),callback:this.parent.m_HandleFieldValue(),singular:true,noInitialCallback:true,clear:this});this.parent.f_sso.subscribe({type:"StringItem",Item:this.parent.webDpName("global","handleFieldAction"),callback:this.parent.m_HandleFieldAction(),singular:true,noInitialCallback:true,clear:this})}}),"nest:m_HandleFieldValue":elon.Class({closure:function(b){if(b.value.get()){var e=this.parent.f_sso;var d=e.getItem({type:"IntItem",Item:this.parent.m_prioDpName}).value.get();var a=e.getItem({type:"Dp_Data",Item:this.parent.argObj.elon_name,unmanaged:true});var c=a.UCPTvalue.push();c.LonFormat.set("");c.set(b.value.get());this.parent.f_dpHandler.setPriority(d);a.UCPTpriority.set(d);e.Write({Item:a,callback:function(){},unmanaged:true})}}}),m_HandleFieldAction:elon.Class({closure:function(a){}})}});Echelon.viewEditValueObject=elon.Class({base:{m_cForm:Echelon.ComboForm},constructor:function(a){a.elon_show_value_def=a.elon_lonformat?false:a.elon_show_value_def;a.mode="DP";this.f_addChildren(a,{combo:{type:"ComboBox"},button:{type:"EditValuePopupButton"}});this.m_cForm(a)}});Echelon.viewBitfieldBaseObject=elon.Class({base:{m_form:Echelon.Form},constructor:function(c){this.m_displaySize=16;this.m_form(c,"change");var a=new elon.EventManager(this);this.addEvent("click",a.create("m_handleClick"));this.addEvent("mouseout",a.create("m_handleMouseout"));this.addEvent("mouseover",a.create("f_handleMouseover"));this.m_bitfieldArr=new Array();for(var b=0;b<this.m_displaySize;b++){this.m_bitfieldArr[b]=0}},"public":{clear:function(){this.setValue(0)},setValue:function(a){this.m_handleClick({cellIndex:a,bitfieldInternal:true})},createDomObj:function(e,f){this.domObj=e.createElement("TABLE");this.domObj.style.border="0px";this.domObj.style.borderColor="black";this.domObj.cellPadding=0;this.domObj.cellSpacing=0;var c=this.domObj.insertRow(0);for(var a=0;a<this.m_displaySize;a++){var b=c.insertCell(a);b.className="bitfieldTable";b.style.cursor=f.elon_non_interactive?"default":"pointer";b.style.width="15px";b.style.height="20px";if((a%4)==0){b.style.borderLeft="solid 2px black"}if((a%4)==3){b.style.borderRight="solid 2px black"}var d=e.createTextNode("0");b.appendChild(d)}return this.domObj},f_handleMouseover:function(a){if(this.argObj.elon_non_interactive){return}a.style.backgroundColor="silver";a.innerHTML=(this.argObj.elon_only_set||(this.m_bitfieldArr[a.cellIndex]!=1))?"1":"0"},m_handleMouseout:function(a){a.style.backgroundColor="white";a.innerHTML=(this.m_bitfieldArr[a.cellIndex]==1)?"1":"0"},m_set:function(a,b){this.m_bitfieldArr[a]=b||"0";this.domObj.rows[0].cells[a].innerHTML=this.m_bitfieldArr[a]}}});Echelon.viewBitfieldStartObject=elon.Class({base:{m_bit:Echelon.viewBitfieldBaseObject},construct:function(a){this.m_bit(a)},"public":{getValue:function(){for(var a=0;a<this.m_displaySize;a++){if(this.m_bitfieldArr[a]==1){return a}}return null},m_handleClick:function(a){var c=0;for(var b=0;b<this.m_displaySize;b++){if((b)==a.cellIndex){c=1}this.domObj.rows[0].cells[b].innerHTML=c;this.m_bitfieldArr[b]=c}if(this.onchange&&!a.bitfieldInternal){this.callEventFunctions({type:"change",viewObject:this})}}}});Echelon.viewBitfieldStopObject=elon.Class({base:{m_bit:Echelon.viewBitfieldBaseObject},construct:function(a){this.m_bit(a)},"public":{getValue:function(){for(var a=0;a<this.m_displaySize;a++){if(this.m_bitfieldArr[a]==0){return a}}return null},m_handleClick:function(a){if(!a.bitfieldInternal){return}var c=1;for(var b=0;b<this.m_displaySize;b++){if((b)==a.cellIndex){c=0}this.domObj.rows[0].cells[b].innerHTML=c;this.m_bitfieldArr[b]=c}if(this.onchange&&!a.bitfieldInternal){this.callEventFunctions({type:"change",viewObject:this})}},f_handleMouseover:function(a){}}});Echelon.viewBitfieldObject=elon.Class({base:{m_bit:Echelon.viewBitfieldBaseObject},constructor:function(a){this.m_bit(a)},"public":{setValue:function(b){b=parseInt(b,10).toString(2);var c=this.m_displaySize-b.length;for(var a=0;a<c;a++){this.m_set(a)}for(var a=c;a<this.m_displaySize;a++){this.m_set(a,b.charAt(a-c))}},getValue:function(){return parseInt(this.m_bitfieldArr.join(""),2)},m_handleClick:function(b){if(this.argObj.elon_non_interactive&&!b.bitfieldInternal){return}var a=b.cellIndex;if(this.argObj.elon_one_bit){var d=parseInt(this.m_bitfieldArr[a],10);for(var c=0;c<this.m_displaySize;c++){this.m_set(c,0)}if(!d||this.argObj.elon_only_set){this.m_set(a,1)}}else{this.m_set(a,(this.m_bitfieldArr[a]==0)?1:0)}if(this.onchange){this.callEventFunctions({type:"change",viewObject:this})}}}});Echelon.UnitTextfield=elon.Class({base:{m_form:Echelon.Form},constructor:function(a){this.m_form(a,"valueChange");this.selection.addEvent(this.selection.uiEvent,this.m_updateSel);this.textfield.addEvent(this.textfield.uiEvent,this.m_updateVal)},"public":{createDomObj:function(a,b){return a.createElement("SPAN")},f_modifyDomObj:function(){this.textfield=Echelon.Form.factory({type:"Textfield",parentDomObj:this.argObj.domObj,elon_highlight_submit:this.argObj.elon_highlight_submit});this.selection=Echelon.Form.factory({type:"ComboBox",parentDomObj:this.argObj.domObj,selectOnly:true,elon_options:this.argObj.elon_options,mode:"DP",elon_highlight_submit:this.argObj.elon_highlight_submit});this.selection.domObj.style.verticalAlign="bottom"},resetColor:function(){this.textfield.resetColor();this.selection.resetColor()},disableSpecifics:function(a){this.textfield.disableSpecifics(a);this.selection.disableSpecifics(a)},clear:function(){this.textfield.setValue(0)},setValue:function(c){var b=[];for(var a in this.argObj.elon_options){b.push(this.argObj.elon_options[a])}b.sort(function(e,d){return e>d});for(var a=b.length-1;a>=0;a--){if(!a||(c>b[a])){this.m_lastFactor=b[a];this.textfield.setValue(c/b[a]);this.selection.setValue(b[a]);break}}},setOptions:function(a,b){this.selection.setOptions(this.f_options=this.argObj.elon_options=a,b)},getValue:function(){return this.textfield.getValue()*this.selection.getValue()},getText:function(){return this.getValue()}},"private":{"callback:m_updateVal":function(){this.callEventFunctions({type:"valueChange",viewObject:this})},"callback:m_updateSel":function(){this.textfield.setValue((this.textfield.getValue()*this.m_lastFactor)/this.selection.getValue());this.m_lastFactor=this.selection.getValue()}}});