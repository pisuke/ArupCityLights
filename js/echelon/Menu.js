Echelon.Menu=elon.Class({base:{m_view:elon.View},constructor:function(c){elon.include("echelon/Menu",c.domObj.ownerDocument,"STYLE");this.m_view(c);if(c.event){c.elon_event=c.event}else{if(c.elon_version_number){c.elon_event="static"}}this.m_pageIsTopLevel=(EchelonTop.document==c.domObj.ownerDocument);this.f_placeOnTopLevel=(c.elon_event!="static"&&EchelonTop.document.body.tagName=="BODY"&&!this.m_pageIsTopLevel);this.m_doc=(this.f_placeOnTopLevel?EchelonTop.document:c.domObj.ownerDocument);this.m_getEventOffsetX=this.f_placeOnTopLevel?elon.dom.getEventOffsetX:elon.dom.pageX;this.m_getEventOffsetY=this.f_placeOnTopLevel?elon.dom.getEventOffsetY:elon.dom.pageY;this.f_relocate=c.relocateViaDomObj?this.m_relocateViaDomObj:this.m_relocateViaEvent;if(this.m_doc==null){alert("ViewMenuObject: caller did not provide a document, and EchelonTop.document.body is null.")}this.m_tableObj=this.m_doc.createElement("TABLE");this.m_deco=this.m_doc.createElement("DIV");this.m_deco.style.position="absolute";this.m_deco.style.zIndex=205;if(!elon.browser.IE678&&(c.elon_event!="static")){elon.MenuShadow(this.m_deco)}this.m_div=this.m_deco.appendChild(this.m_doc.createElement("DIV"));this.m_div.style.overflow="auto";this.m_div.style.position="relative";this.m_div.appendChild(this.m_tableObj);this.m_tableObj.cellSpacing=1;this.m_tableObj.cellPadding=0;elon.util.addEvent(this.m_tableObj,"mouseover",elon.util.catchEvent,false);elon.util.addEvent(this.m_tableObj,"mouseout",elon.util.catchEvent,false);this.m_tableObj.className=c.elon_class?c.elon_class:"EchelonContextMenu";this.m_ieBugShield=elon.browser.IE678?this.m_createIEBugShield():null;this.m_context=null;if(c.elon_entry_arr!=null){for(var a=0;a<c.elon_entry_arr.length;a++){var b=c.elon_entry_arr[a];if(b==null){continue}if(b.elon_entry_arr){b.subMenu=this.addSubMenu(b)}if(b.elon_line==true){this.addLine(b.enableCB)}else{this.addEntry(b)}}}if(c.elon_event=="static"){this.m_deco.style.width=this.m_div.style.width=this.m_tableObj.style.width="100%";this.m_deco.style.height=this.m_div.style.height=this.m_tableObj.style.height="100%";c.domObj.appendChild(this.m_deco)}else{if(c.parentMenu==null&&c.elon_event!="none"){elon.util.addEvent(c.domObj,c.elon_event!=null?c.elon_event:"contextmenu",this.show)}}},"public":{init:function(){this.clearMenu()},disableCell:function(a){a.style.display="none"},enableCell:function(a){a.style.display=""},"callback:cellEntered":function(b){if(!document.body.disabled){b=(b)?b:window.event;var c=(b.target)?b.target:b.srcElement;var a=(c.tagName.toUpperCase()=="TD")?c:elon.util.getParent(c,"TD");a.defaultClass=(a.defaultClass)?a.defaultClass:a.className;a.className="On";if(a.echelonSubMenu!=null){if(typeof(a.echelonSubMenu)=="function"){a.echelonSubMenu(b,this.m_context)}else{a.echelonSubMenu.show(b,this.m_context)}}else{if(this.activeSubMenu!=null){this.activeSubMenu.hide()}}}},m_getHeight:function(){return this.m_tableObj.clientHeight},m_getWidth:function(){return this.m_tableObj.clientWidth},m_relocateViaDomObj:function(j){var f=elon.util.evt.sourceObj(j);var d=0;var c=0;if(j.type=="scroll"){if(this.domObj.echelon_master!=this){if(this.m_followScroll){elon.util.removeEvent(window,"scroll",this.f_relocate)}return true}}else{this.init(f.tagName.toUpperCase=="BUTTON"?f.offsetWidth:null);d=this.f_placeOnTopLevel?this.m_bs.getDocumentOffsetX(this.f_getMenuAlignmentNode().ownerDocument):0;c=this.f_placeOnTopLevel?this.m_bs.getDocumentOffsetY(this.f_getMenuAlignmentNode().ownerDocument):0;if(this.m_followScroll){elon.util.addEvent(window,"scroll",this.f_relocate)}}var h=this.m_bs.getAbsoluteXOffset(this.f_getMenuAlignmentNode(),!this.f_placeOnTopLevel)+d;var g=this.m_bs.getAbsoluteYOffset(this.f_getMenuAlignmentNode(),!this.f_placeOnTopLevel)+c+20;var b=this.m_domObj.clientHeight;var a=(g+b)>this.m_doc.body.clientHeight;if(a&&(g>(this.m_doc.body.clientHeight/2))){if((elon.util.isSafePath(this.m_doc,"parentWindow.frameElement.id"))&&(this.m_doc.parentWindow.frameElement.id=="id_popupContentFrame")){var e=this.m_doc.parentWindow.frameElement.offsetHeight;var i=this.m_doc.parentWindow.frameElement.offsetParent;while(elon.util.isSafe(i.offsetParent)){i=i.offsetParent;e+=i.offsetHeight}if((g+b)>(this.m_doc.body.clientHeight+e)){g-=(b+parseInt(this.f_getMenuAlignmentNode().clientHeight,10)+10)}}else{g-=(b+parseInt(this.f_getMenuAlignmentNode().clientHeight,10)+10);if(g<0){g=0;this.f_setScrollHeight(this.m_bs.getAbsoluteYOffset(this.f_getMenuAlignmentNode())+c)}}}else{if(a&&((this.m_doc.body.clientHeight-g-b)<0)){this.f_setScrollHeight(this.m_doc.body.clientHeight-g)}}g=g+5;this.moveTo(h,g)},m_relocateViaEvent:function(n){n=(n)?n:window.event;var g=(n.target)?n.target:n.srcElement;var o=(g.tagName.toUpperCase()=="TD")?g:elon.util.getParent(g,"TD");var d,c,k,a;var b=this.m_getHeight();var f=this.m_getWidth();if(this.argObj.parentMenu==null){if(this.argObj.elon_event=="click"||this.argObj.elon_event=="mouseover"){var m=this.m_getEventOffsetX(n);var j=this.m_getEventOffsetY(n);d=elon.dom.getBrowserX(this.domObj);c=elon.dom.getBrowserY(this.domObj)+this.domObj.clientHeight;k=f-this.domObj.clientWidth;a=b+this.domObj.clientHeight;window.status="dom="+elon.dom.getAbsoluteYOffset(this.domObj)+" doc="+elon.dom.getDocumentOffsetY(this.domObj.ownerDocument)}else{d=this.m_getEventOffsetX(n);c=this.m_getEventOffsetY(n);k=f;a=b}}else{var e=this.argObj.parentMenu.m_getHeight();var p=this.argObj.parentMenu.m_getWidth();if(this.argObj.parentMenu.argObj.elon_orientation=="horizontal"){d=elon.dom.getBrowserX(o)-2;c=elon.dom.getBrowserY(o)+e-3;k=f-o.clientWidth+1;a=b+e+3}else{d=elon.dom.getBrowserX(o)+p-2;c=elon.dom.getBrowserY(o);k=f+p-3;a=b-o.clientHeight}}if(this.argObj.elon_shift_y){c+=Number(this.argObj.elon_shift_y)}var l,i;var h=this.m_doc.body.clientWidth;var q=elon.dom.getBodyClientHeight(this.m_doc);i=c;if((c+b)>q){if((c-a)>0){i=c-a;if(this.argObj.elon_shift_y){i-=2*Number(this.argObj.elon_shift_y)}}else{i=0;if(b>q){this.m_div.style.overflowX="auto";this.m_div.style.overflowY="scroll";this.m_div.style.height=elon.util.addPx(q)}}}if((d+f)>h){if((d-k)<0){l=d}else{l=d-k}}else{l=d}this.moveTo(l,i)},f_setScrollHeight:function(a){this.m_div.style.height=elon.util.addPx(a)},cellExited:function(b){b=(b)?b:window.event;var c=(b.target)?b.target:b.srcElement;var a=(c.tagName.toUpperCase()=="TD")?c:elon.util.getParent(c,"TD");a.className=""},"callback:show":function(a,c){if(!a.echelonIgnore&&this.m_tableObj.rows.length){this.m_div.style.height="";if(this.argObj.elon_event=="static"){return}if(this.argObj.parentMenu!=null){if(this.argObj.parentMenu.activeSubMenu!=null){this.argObj.parentMenu.activeSubMenu.hide()}this.argObj.parentMenu.activeSubMenu=this}else{Echelon.ViewMenuObject.hideAll()}if(c){this.m_context=c}Echelon.ViewMenuObject.instances.push(this);this.m_doc.body.appendChild(this.m_deco);if(this.m_getArg("elon_event")=="static"){elon.elon.addEventToAllBodies("mouseover",this.hide)}if(this.m_disableCBs){for(var b=0;b<this.m_disableCBs.length;b++){if(this.m_disableCBs[b].callback(a,c,this.m_DisableCB(this.m_disableCBs[b].cellObj))){this.disableCell(this.m_disableCBs[b].cellObj)}else{this.enableCell(this.m_disableCBs[b].cellObj)}}}if(this.m_ieBugShield){this.m_doc.body.appendChild(this.m_ieBugShield)}this.f_relocate(a);this.isOpen=true;this.m_resize()}return elon.util.catchEvent(a)},moveTo:function(a,b){if(this.m_ieBugShield){this.m_ieBugShield.style.height=elon.util.addPx(this.m_tableObj.clientHeight+2);this.m_ieBugShield.style.width=elon.util.addPx(this.m_tableObj.clientWidth+2);this.m_ieBugShield.style.left=elon.util.addPx(a);this.m_ieBugShield.style.top=elon.util.addPx(b)}this.m_deco.style.left=elon.util.addPx(a);this.m_deco.style.top=elon.util.addPx(b)},"callback:hide":function(i){this.m_context=null;if(i!=null&&i.type=="mouseover"){var j=this.argObj.rootMenu.getTableObj();var f=i.clientX;var d=i.clientY;var c=elon.dom.getAbsoluteXOffset(j);var b=elon.dom.getAbsoluteYOffset(j);var h=this.argObj.elon_shift_x?Math.abs(this.argObj.elon_shift_x)+1:2;var a=this.argObj.elon_shift_y?Math.abs(this.argObj.elon_shift_y)+1:2;if(!(f<(c-h)||f>(c+j.clientWidth+h)||d<(b-a)||d>(b+j.clientHeight+a))){return}}elon.elon.removeEventFromAllBodies("mouseover",this.hide);if(this.activeSubMenu!=null){this.activeSubMenu.hide()}if(this.argObj.parentMenu){this.argObj.parentMenu.activeSubMenu=null}try{this.m_doc.body.removeChild(this.m_deco);if(this.m_ieBugShield){this.m_doc.body.removeChild(this.m_ieBugShield)}}catch(g){}this.isOpen=false},clearMenu:function(){while(this.m_tableObj.rows.length>0){this.m_tableObj.deleteRow(0)}this.m_tableObj.style.width="1px";return this},addMenuEntry:function(d,e,c,a,b){return this.addEntry({elon_label:d,elon_callback:e,enabled:c,idx:a,elon_img:b})},addEntry:function(f){if(f.idx==null){f.idx=this.m_tableObj.rows.length}if(f.enabled==null){f.enabled=true}var d=this.argObj.elon_orientation=="horizontal"?this.m_tableObj.rows[0]:null;if(d==null){d=this.m_tableObj.insertRow(f.idx)}var c=d.insertCell(d.cells.length);if(f.enableCB||f.disableCB){if(!this.m_disableCBs){this.m_disableCBs=[]}this.m_disableCBs.push({cellObj:c,callback:f.disableCB?f.disableCB:this.m_Not(f.enableCB)})}if(f.elon_line==true){c.className="ContextLine ContextLine"+((elon.browser.IE6||elon.browser.IE7)?"IE":"FF");return c}c.style.whiteSpace="nowrap";c.style.position="relative";var b;if(f.elon_img||f.elon_icon){b=c.appendChild(c.ownerDocument.createElement("img"));b.src=f.elon_img||f.elon_icon;b.argObj=f;b.verticalAlign="middle";b.style.width="16px";b.style.height="16px";c.appendChild(c.ownerDocument.createTextNode(" "))}var e=c.appendChild(c.ownerDocument.createElement("SPAN"));e.style.verticalAlign="middle";e.appendChild(c.ownerDocument.createTextNode((f.elon_label!=null)?f.elon_label:""));if(f.subMenu!=null&&this.argObj.elon_event!="static"){b=c.appendChild(c.ownerDocument.createElement("img"));b.src=elon.imgUrl("arrowhide.gif");b.style.width="13px";b.style.height="15px";b.style.position="absolute";b.style.right="0px";b.argObj=f;e.style.marginRight="15px"}c.name=(f.elon_label!=null)?f.elon_label:"";c.echelonSubMenu=f.subMenu;c.argObj=f;if(f.enabled){elon.util.addEvent(c,"click",this.f_cellClicked,false);elon.util.addEvent(c,"mousedown",this.catchEvent,false);elon.util.addEvent(c,"mouseover",this.cellEntered,false);elon.util.addEvent(c,"mouseout",this.cellExited,false);c.className="ContextMenu"}else{c.className="ContextMenuDisabled"}var a=elon.util.addPx((parseInt(this.m_div.style.width,10)<parseInt(c.scrollWidth,10))?c.scrollWidth:this.m_div.style.width);this.m_div.style.width=this.m_tableObj.style.width=a;this.m_div.style.overflowX="hidden";if(this.m_div.clientWidth<75){this.m_div.style.width=this.m_tableObj.style.width="75px"}return c},m_Not:elon.Class({constructor:["m_cb"],closure:function(){return !this.m_cb.apply(this,arguments)}}),addSubMenu:function(a){if(!a){a=new Object()}a.domObj=this.argObj.domObj;a.parentMenu=this;a.rootMenu=this.argObj.parentMenu?this.argObj.parentMenu:this;return Echelon.ViewMenuObject.getInstance(a)},addLabel:function(e,a){var d=parseInt(a,10);d=(d)?d:-1;var c=this.m_tableObj.insertRow(d);var b=c.insertCell(0);b.innerHTML=e;b.name=e;b.style.height="12px";this.m_tableObj.style.width=elon.util.addPx((parseInt(this.m_tableObj.style.width,10)<parseInt(b.scrollWidth,10))?b.scrollWidth:this.m_tableObj.style.width);b.className="ContextLabel"},addLine:function(a){this.addEntry({elon_line:true,enableCB:a})},getTableObj:function(){return this.m_tableObj}},"protected":{"callback:f_cellClicked":function(b){var d=false;var c=(b.target)?b.target:b.srcElement;var a=(c.tagName.toUpperCase()=="TD")?c:elon.util.getParent(c,"TD");if(a.argObj.elon_url!=null){if(a.argObj.elon_target==null){a.argObj.elon_target=this.m_getArg("elon_target")}if(a.argObj.elon_args_obj==null||a.argObj.elon_args_obj.elon_lang==null){if(a.argObj.elon_args_obj==null){a.argObj.elon_args_obj=new Object()}a.argObj.elon_args_obj.elon_lang=this.m_getArg("elon_lang")}this.f_followLink(a.argObj);d=true}else{if(a.argObj.elon_callback!=null){a.argObj.elon_callback(b,this.m_context||this.domObj);this.m_context=null;d=true}}a.className="";if(d){Echelon.ViewMenuObject.hideAll()}}},"private":{"nest:m_DisableCB":elon.Class({constructor:["m_cell"],closure:function(a){this.parent[(a?"dis":"en")+"ableCell"](this.m_cell);this.parent.m_resize(true)}}),m_resize:function(a){if(!this.m_div.style.height||a){this.m_div.style.height=elon.util.addPx(this.m_tableObj.offsetHeight);this.m_div.style.width=elon.util.addPx(this.m_tableObj.offsetWidth)}else{this.m_div.style.width=elon.util.addPx(this.m_tableObj.offsetWidth+18)}},m_getArg:function(b){var a=this;while(a!=null){if(a.argObj[b]!=null){return a.argObj[b]}a=a.argObj.parentMenu}return null},m_createIEBugShield:function(){var b=this.m_doc.createElement("div");b.style.position="absolute";b.overflow="hidden";b.style.zIndex="204";var a=this.m_doc.createElement("iframe");a.frameborder="0";a.scrolling="no";a.style.textAlign="left";a.src=elon.imgUrl("clear.gif");a.style.height="100%";a.style.width="100%";a.style.position="absolute";a.style.overflow="hidden";b.appendChild(a);return b}}});Echelon.ViewMenuObject=new elon.Class.Backport(Echelon.Menu);Echelon.ViewMenuObject.hideAll=function(a){if(a==null||a.cancelBubble!=true){var f;for(var c=0;c<Echelon.ViewMenuObject.instances.length;c++){f=Echelon.ViewMenuObject.instances[c];try{var b=f.domObj.ownerDocument;if(f.isOpen==true&&f.argObj.elon_event!="static"){f.hide()}}catch(d){Echelon.ViewMenuObject.instances.splice(c--,1)}}}};Echelon.ViewMenuObject.instances=new Array();Echelon.ViewMenuObject.getInstance=Echelon.Menu;elon.provide("Menu",document);