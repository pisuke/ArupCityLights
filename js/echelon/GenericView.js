Echelon.GenericView=elon.Class({base:{m_view:Echelon.View},constructor:function(b){this.m_view(b);elon.include(this.argObj.elon_javascript_class,this.doc);elon.includeCB(this.m_includeCb,this.doc);this.m_keyLookup={};var a=elon.dom.getDefaultView(this.domObj);a.Echelon.CustomJavascript={}},"public":{"callback:m_update":function(d,c,a){if(d){if(typeof(this.m_myInstance.update)=="object"){var b=this.m_myInstance.update["ELON_DP_KEY:"+this.m_keyLookup[d.UCPTname.get()]];if(b){b.call(this.m_myInstance,d.r_proxy_type,this.m_private2custom(d))}}else{this.m_myInstance.update.call(this.m_myInstance,d.r_proxy_type,this.m_private2custom(d),this.m_keyLookup[d.UCPTname.get()])}this.f_resize()}},"callback:m_custom_write":function(a,b){this.f_sso.Write({Item:this.m_custom2private(a),callback:b||function(){}})}},"private":{"callback:m_includeCb":function(){var a=elon.dom.getDefaultView(this.domObj);var d=this.argObj.elon_javascript_class.split("/");var e=d[d.length-1];this.m_lonFormatMap=new Object();var c=a.Echelon.CustomJavascript[e]||a[e]||EchelonTop.window[e];this.m_myInstance=new c({domObj:this.domObj,sso:{Write:this.m_custom_write},customArgs:this.m_getCustomArgs(this.argObj.elon_custom_args_arr)});this.m_dpType=new Array();if(this.argObj.elon_name_arr){for(var b=0;b<this.argObj.elon_name_arr.length;b++){this.m_requestItem(this.argObj.elon_name_arr[b])}}else{this.m_requestItem(this.argObj.elon_name_obj||this.argObj)}if(elon.util.hasProps(this.m_dpType)){this.f_sso.getRemocalItem({type:"generalFb",Item:this.argObj.elon_name,callback:this.m_pollViaDpType()})}},m_getCustomArgs:function(a){var c={};if(a){for(var b=0;b<a.length;b++){c[a[b].elon_key]=a[b].elon_value}}return c},m_requestItem:function(a){if(a){if(a.elon_dptype){this.m_dpType[a.elon_dptype]=a}else{if(a.elon_lonformat){a.elon_lonformat=elon.util.ensureLonFormatPrefix(a.elon_lonformat)}if(a.elon_name){this.m_poll(a)}else{if(a.elon_alias_name){this.f_sso.Get({type:"Dp_Cfg",xSelect:'//Item[@xsi:type="Dp_Cfg"][UCPTaliasName="'+a.elon_alias_name+'"]',callback:this.m_pollViaAliasName(a)})}}}}},m_propFunc:function(b){this.set=function(c){a=c};this.get=function(){return a};var a=b},m_private2custom:function(g){var f=new Object();f.UCPTname=new this.m_propFunc(g.UCPTname.get());f.UCPTpriority=new this.m_propFunc(g.UCPTpriority.get());f.UCPTpointStatus=new this.m_propFunc(g.UCPTpointStatus.get());f.UCPTvalue=new Array();var d=this.m_lonFormatMap[g.UCPTname.get()];var c=d?g.UCPTvalue.length:Math.min(g.UCPTvalue.length,2);for(var b=0;b<c;b++){var e=g.UCPTvalue[b];if(d&&d!=e.LonFormat.get()){continue}var a=new this.m_propFunc(e.get());a.LonFormat=new this.m_propFunc(e.LonFormat.get());a.Unit=new this.m_propFunc(e.Unit.get());f.UCPTvalue.push(a)}return f},m_custom2private:function(e){var d=this.f_sso.getItem({type:"Dp_Data",Item:e.UCPTname.get(),unmanaged:true});d.UCPTpriority.set(e.UCPTpriority.get());for(var b=0;b<e.UCPTvalue.length;b++){var a=e.UCPTvalue[b];var c=d.UCPTvalue.push();c.LonFormat.set(a.LonFormat.get()||"");c.set(a.get())}return d},m_poll:function(a){if(a.elon_name){if(a.elon_key){this.m_keyLookup[a.elon_name]=a.elon_key}if(a.elon_lonformat&&a.elon_lonformat.split(".").length>2){this.m_lonFormatMap[a.elon_name]=a.elon_lonformat}elon.util.pollDp({sso:this.f_sso,dpName:a.elon_name,lonFormat:a.elon_lonformat,maxAge:a.elon_max_age,pollInterval:(a.elon_poll_interval!=null)?a.elon_poll_interval:this.argObj.elon_poll_interval,id:this,callback:this.m_update})}},"nest:m_pollViaDpType":elon.Class({closure:function(e,d,c){if(e&&e.DataPoint&&e.DataPoint.length){for(var b=0;b<e.DataPoint.length;b++){for(var a in this.parent.m_dpType){if(e.DataPoint[b].dpType.get()==a){this.parent.m_dpType[a].elon_name=e.DataPoint[b].UCPTname.get();this.parent.m_poll.call(this.parent,this.parent.m_dpType[a])}}}}}}),"nest:m_pollViaAliasName":elon.Class({constructor:["m_pointObj"],closure:function(c,b,a){if(c&&c.Item&&c.Item.length){this.m_pointObj.elon_name=c.Item[0].UCPTname.get();this.parent.m_poll.call(this.parent,this.m_pointObj)}}})}});