elon.Popup=elon.Class({constructor:function(a){this.m_closeCB=a.closeCB;this.m_fixedWidth=a.elon_popup_width;this.m_fixedHeight=a.elon_popup_height;if(!a){a=new Object()}if(a.elon_modal==null){a.elon_modal=true}this.argObj=a;this.m_activeStyle=a.ignoreDisableLayer?"PopupIgnoreDisabledActive":"PopupActive";this.m_inactiveStyle=a.ignoreDisableLayer?"PopupIgnoreDisabled":(a.elon_modal?"PopupModal":"PopupNonModal");if(a.elon_url){this.m_open(elon.elon.assembleURL(a))}elon.Popup.instances.push(this)},"public":{"callback:adjust":function(){if(!this.m_manuallyResized){this.m_setSize()}if(!this.m_manuallyMoved){this.m_frame.center()}},"callback:show":function(){delete this.m_hidden;this.m_frame.center()},"callback:hide":function(){this.m_hidden=true;if(!this.m_frame){return}this.m_frame.hide()},"callback:center":function(){this.m_frame.center()},"callback:getIframe":function(){return this.m_iframe},"callback:registerAutoScroller":function(a){this.autoScroller=a},"callback:close":function(){var c=false;try{if(this.m_closed){return}if(elon.Popup.onTop==this.m_frame.container){var a=true;elon.Popup.onTop=null}this.m_closed=true;elon.util.removeEvent(this.m_iframe,"load",this.m_waitForEchelonInit);elon.util.removeEvent(EchelonTop.window,"resize",this.adjust);if(elon.util.hasClassName("PopupModal",this.m_frame.container)||elon.util.hasClassName(this.m_activeStyle,this.m_frame.container)){var d=elon.Popup.m_modalQueue;if(d.length>0){if(a){elon.Popup.placeOnTop(d.pop())}else{for(var b=0;b<d.length;b++){if(d[b]==this.m_frame.container){d.splice(b,1);break}}}}else{elon.LayerManager().enableSubjacent()}}this.m_iframe.contentWindow.close();delete this.m_iframe}catch(f){c=true}if(elon.browser.IE9){this.m_frame.destroy()}else{try{this.m_frame.destroy()}catch(f){c=true}}try{delete this.m_frame;elon.UtilObject.getInstance().fireQuickCallback(elon.removeOrphanedPolls);elon.elon.click();if(this.m_closeCB){this.m_closeCB()}}catch(f){c=true}if(c){alert("Serious browser issue, please refresh page (F5)!")}},requestHeight:function(b){var e=this.m_getPopBody();var d=EchelonTop.document.body.clientHeight*elon.Popup.MAX_WINDOW_FRACTION;var a=elon.dom.docClientHeight(e)+elon.dom.scrollBarHeight(e);var c=d-a;var f=Math.min(c,b);this.m_iframe.style.height=elon.util.addPx(a+f);if(f>1){this.m_frame.centerY()}return f},requestWidth:function(b){var e=this.m_getPopBody();var d=EchelonTop.document.body.clientWidth*elon.Popup.MAX_WINDOW_FRACTION;var a=elon.dom.docClientWidth(e)+elon.dom.scrollBarWidth(e);var c=d-a;var f=Math.min(c,b);this.m_iframe.style.width=elon.util.addPx(a+f);if(f>1){this.m_frame.centerX()}return f}},"private":{m_setSize:function(){var e=this.m_getPopBody();var d=EchelonTop.document.body.clientWidth*elon.Popup.MAX_WINDOW_FRACTION;var c=elon.dom.getBodyClientHeight()*elon.Popup.MAX_WINDOW_FRACTION;var a=this.m_fixedWidth;var b=this.m_fixedHeight;if(e){a=a||(elon.dom.docScrollWidth(e)+elon.dom.scrollBarWidth(e));b=b||(elon.dom.docScrollHeight(e)+elon.dom.scrollBarHeight(e))}a=Math.min(a,d);b=Math.min(b,c);this.m_iframe.style.height=elon.util.addPx(b);this.m_iframe.style.width=elon.util.addPx(a);this.m_autoscroll()},"callback:m_autoscroll":function(){if(this.autoScroller){elon.util.fireDelayedFunction(this.autoScroller.m_resize,10,this)}},"callback:m_autoscrollCB":function(){this.m_manuallyResized=true;this.m_autoscroll()},"callback:m_mvCB":function(){this.m_manuallyMoved=true},m_getPopBody:function(){var a=null;try{a=this.m_iframe.contentWindow.document.body}catch(b){}return a},"callback:m_waitForEchelonInit":function(){var c=this.m_iframe.contentWindow;try{var a=c.Echelon}catch(b){}if(a){if(!c.echelonInitComplete){return elon.util.fireDelayedFunction(this.m_waitForEchelonInit,100)}this.adjust()}else{this.m_fixedWidth=this.m_fixedWidth||300;this.m_fixedHeight=this.m_fixedHeight||200;this.adjust()}if(!this.m_hidden&&(!elon.Popup.onTop||(elon.Popup.onTop==this.m_frame.container||elon.Popup.onTop.echelonModal!="extended"))){this.show()}},m_open:function(b){elon.elon.click();b=b.href||b;var c=EchelonTop.document;this.m_iframe=c.createElement("iframe");var a=c.createElement("button");a.targetUrl=b;elon.util.addClassName("PopupHelp",a);elon.util.addEvent(a,"mousedown",elon.elon.showPopupHelp);var d=c.createElement("button");elon.util.addClassName("PopupClose",d);elon.util.addEvent(d,"mousedown",this.close);this.m_frame=elon.PopupFrame({content:this.m_iframe,resizeCB:this.m_autoscrollCB,headerDom:[a,d],moveCB:this.m_mvCB});this.m_frame.hide();elon.util.addClassName(this.m_inactiveStyle,this.m_frame.container);this.m_frame.container.echelonModal=this.argObj.elon_modal;this.m_frame.container.echelonActiveStyle=this.m_activeStyle;this.m_frame.container.echelonInactiveStyle=this.m_inactiveStyle;this.m_iframe.scrolling="no";elon.util.addClassName("PopupIframe",this.m_iframe);this.m_iframe.src=b;this.m_iframe.name="EchelonPopup";this.m_iframe.style.height=this.m_iframe.style.width="1px";elon.util.addEvent(this.m_iframe,"load",this.m_waitForEchelonInit);elon.util.addEvent(EchelonTop.window,"resize",this.adjust);elon.Popup.placeOnTop(this.m_frame.container)},"callback:m_closeWithNotify":function(){return this.closeCb?this.closeCb():this.close()}}});elon.Popup.onTop=null;elon.Popup.Z_INDEX_MODAL=201;elon.Popup.Z_INDEX_NONMODAL=197;elon.Popup.m_modalQueue=new Array();elon.Popup.MAX_WINDOW_FRACTION=0.9;elon.Popup.instances=new Array();elon.Popup.m_getInstanceIdx=function(c){for(var a=0;a<elon.Popup.instances.length;a++){try{if(elon.Popup.instances[a].getIframe().contentWindow.document==c){return a}}catch(b){}}};elon.Popup.getExistingInstance=function(b){var a=elon.Popup.m_getInstanceIdx(b);return a!=null?elon.Popup.instances[a]:null};elon.Popup.getExistingInstanceFromUrl=function(a){for(var b=0;b<elon.Popup.instances.length;b++){try{if(elon.Popup.instances[b].getIframe().contentWindow.location.pathname==a){return elon.Popup.instances[b]}}catch(c){}}};elon.Popup.close=function(c){var b=elon.Popup.m_getInstanceIdx(c);if(b!=null){var a=elon.Popup.instances[b];elon.util.fireQuickCallback(elon.Popup.instances.splice(b,1)[0].close)}};elon.Popup.placeOnTop=function(c){try{if(c){var a=elon.Popup.onTop;if(a&&c.echelonModal){if(a.echelonModal=="extended"){if(c.echelonModal){elon.Popup.m_modalQueue.push(c)}return}if(a.echelonModal){elon.Popup.m_modalQueue.push(a)}elon.util.replaceClassName(a.echelonActiveStyle,a.echelonInactiveStyle,a)}elon.Popup.onTop=c;if(c.echelonModal){elon.LayerManager().disableSubjacent()}elon.util.replaceClassName(c.echelonInactiveStyle,c.echelonActiveStyle,c)}else{if(elon.Popup.onTop){elon.Popup.onTop.style.left=elon.util.addPx(Number(elon.Popup.onTop.offsetLeft)+1)}}}catch(b){}};elon.Popup.StyleCB=elon.Class({constructor:function(b,a){this.m_doc=b;this.m_href=a;this.m_count=0;elon.util.callback.fireDelayedFunction(this.m_cb,100,this)},"private":{m_cb:function(){try{for(var b=0;b<this.m_doc.styleSheets.length;b++){var a=this.m_doc.styleSheets[b];if((a.href==this.m_href)&&a.cssRules.length){return elon.Popup.getExistingInstance(this.m_doc).adjust()}}}catch(c){}this.m_count++;if(this.m_count<600){elon.util.callback.fireDelayedFunction(this.m_cb,100,this)}}}});elon.provide("Popup",document);